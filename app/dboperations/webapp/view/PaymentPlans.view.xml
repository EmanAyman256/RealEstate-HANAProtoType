<mvc:View
    controllerName="dboperations.controller.PaymentPlans"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    displayBlock="true">

    <Page id="_IDGenPage1" title="Payment Plans">
        <headerContent>
            <Button
                id="btnAddPaymentPlan"
                icon="sap-icon://add"
                tooltip="Add"
                text="New Payment Plan"
                press="onAddPlan"
            />
        </headerContent>

        <content>
            <!-- ðŸ”¹ ScrollContainer for horizontal scroll -->
            <ScrollContainer
                horizontal="true"
                vertical="false"
                width="100%"
                height="100%"
                focusable="true"
                class="noPaddingScroll">

                <Table
                    id="plansTable"
                    items="{plans>/}"
                    mode="SingleSelectMaster"
                    width="120%"
                    inset="false"
                    class="noPaddingTable">

                    <columns>
                        <Column><Text text="Plan ID"/></Column>
                        <Column><Text text="Description"/></Column>
                        <Column><Text text="Company Code"/></Column>
                        <Column><Text text="Years"/></Column>
                        <Column><Text text="Valid From"/></Column>
                        <Column><Text text="Valid To"/></Column>
                        <Column><Text text="Status"/></Column>
                        <Column><Text text="Actions"/></Column>
                    </columns>

                    <items>
                        <ColumnListItem>
                            <cells>
                                <Text text="{plans>paymentPlanId}"/>
                                <Text text="{plans>description}"/>
                                <Text text="{plans>companyCodeId}"/>
                                <Text text="{plans>planYears}"/>
                                <Text text="{plans>validFrom}"/>
                                <Text text="{plans>validTo}"/>
                                <Text text="{plans>planStatus}"/>
                                <HBox>
                                    <Button icon="sap-icon://information" tooltip="Details" press="onShowPlanDetails"/>
                                    <Button icon="sap-icon://edit" tooltip="Edit" press="onEditPlan"/>
                                    <Button icon="sap-icon://delete" type="Reject" tooltip="Delete" press="onDeletePlan"/>
                                </HBox>
                            </cells>
                        </ColumnListItem>
                    </items>
                </Table>
            </ScrollContainer>
        </content>
    </Page>

    <!-- âœ… Dialog left unchanged -->
    <Dialog id="planDialog" title="Add / Edit Payment Plan" stretchOnPhone="true">
        <content>
            <VBox class="sapUiSmallMargin">
                <Label text="Company Code ID"/>
                <Input value="{local>/companyCodeId}" placeholder="e.g. 0001"/>

                <Label text="Description"/>
                <Input value="{local>/description}"/>

                <Label text="Plan Years"/>
                <Input value="{local>/planYears}" type="Number"/>

                <Label text="Valid From"/>
                <DatePicker value="{local>/validFrom}" displayFormat="yyyy-MM-dd" valueFormat="yyyy-MM-dd"/>

                <Label text="Valid To"/>
                <DatePicker value="{local>/validTo}" displayFormat="yyyy-MM-dd" valueFormat="yyyy-MM-dd"/>

                <Label text="Plan Status"/>
                <Input value="{local>/planStatus}" placeholder="A / I"/>

                <Title text="Schedules" level="H3"/>
                <Toolbar>
                    <Button text="Add Row" icon="sap-icon://add" press="onAddScheduleRow"/>
                    <Button text="Delete Row" icon="sap-icon://delete" press="onDeleteScheduleRow"/>
                </Toolbar>

                <Table id="scheduleTable" items="{path: 'local>/schedules'}" inset="false">
                    <columns>
                        <Column><Text text="Condition Type"/></Column>
                        <Column><Text text="Base Price"/></Column>
                        <Column><Text text="Calc. Method"/></Column>
                        <Column><Text text="Frequency"/></Column>
                        <Column><Text text="%"/></Column>
                        <Column><Text text="Due (Months)"/></Column>
                        <Column><Text text="Installments"/></Column>
                        <Column><Text text="Years"/></Column>
                    </columns>

                    <items>
                        <ColumnListItem>
                            <cells>
                                <Input value="{local>conditionType}" width="100%"/>
                                <Input value="{local>basePrice}" width="100%"/>
                                <Input value="{local>calculationMethod}" width="100%"/>
                                <Input value="{local>frequency}" width="100%"/>
                                <Input value="{local>percentage}" type="Number"/>
                                <Input value="{local>dueInMonth}" type="Number"/>
                                <Input value="{local>numberOfInstallments}" type="Number"/>
                                <Input value="{local>numberOfYears}" type="Number"/>
                            </cells>
                        </ColumnListItem>
                    </items>
                </Table>

                <Title text="Assigned Projects" level="H3"/>
                <Toolbar>
                    <Button text="Add Project" icon="sap-icon://add" press="onAddProjectRow"/>
                    <Button text="Delete" icon="sap-icon://delete" press="onDeleteProjectRow"/>
                </Toolbar>

                <Table id="projectsTable" items="{path: 'local>/projects'}">
                    <columns>
                        <Column><Text text="Project ID"/></Column>
                        <Column><Text text="Project Description"/></Column>
                    </columns>

                    <items>
                        <ColumnListItem>
                            <cells>
                                <Input value="{local>projectId}"/>
                                <Input value="{local>projectDescription}"/>
                            </cells>
                        </ColumnListItem>
                    </items>
                </Table>
            </VBox>
        </content>

        <beginButton>
            <Button text="Save" type="Emphasized" press="onSavePlan"/>
        </beginButton>
        <endButton>
            <Button text="Cancel" press="onCancelPlan"/>
        </endButton>
    </Dialog>
</mvc:View>
