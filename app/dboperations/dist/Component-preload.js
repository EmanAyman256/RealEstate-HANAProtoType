//@ui5-bundle dboperations/Component-preload.js
sap.ui.predefine("dboperations/Component", ["sap/ui/core/UIComponent","dboperations/model/models"],(e,t)=>{"use strict";return e.extend("dboperations.Component",{metadata:{manifest:"json",interfaces:["sap.ui.core.IAsyncContentCreation"]},init(){e.prototype.init.apply(this,arguments);this.setModel(t.createDeviceModel(),"device");this.getRouter().initialize()}})});
sap.ui.predefine("dboperations/controller/App.controller", ["sap/ui/core/mvc/Controller"],e=>{"use strict";return e.extend("dboperations.controller.App",{onInit(){}})});
sap.ui.predefine("dboperations/controller/BasePrices.controller", ["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel"],function(e,o,s,t){"use strict";return e.extend("dboperations.controller.BasePrices",{onInit:function(){this._loadBasePrices()},_loadBasePrices:function(){fetch("./odata/v4/real-estate/BasePrices").then(e=>e.json()).then(e=>{this.getView().setModel(new t(e.value||[]),"basePrices")}).catch(e=>console.error("Failed to load BasePrices:",e))},onAddBasePrice:function(){this._openBasePriceDialog({})},onEditBasePrice:function(e){const o=e.getSource().getBindingContext("basePrices");const s=o.getObject();this._openBasePriceDialog(s)},_openBasePriceDialog:function(e){if(!this._oDialog){this._oDialog=this.getView().byId("basePriceDialog")}const o=new t({code:e.code||"",description:e.description||"",isEdit:!!e.code});this._oDialog.setModel(o,"local");this._oDialog.open()},onSaveBasePrice:async function(){const e=this._oDialog;const t=e.getModel("local");const i=t.getData();if(!i.code||!i.description){s.error("Code and Description are required.");return}try{const s=i.isEdit?"PUT":"POST";const t=i.isEdit?`./odata/v4/real-estate/BasePrices(code='${i.code}')`:`./odata/v4/real-estate/BasePrices`;const c=await fetch(t,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify({code:i.code,description:i.description})});if(!c.ok)throw new Error("Failed to save BasePrice");o.show("BasePrice saved successfully!");e.close();this._loadBasePrices()}catch(e){s.error("Error: "+e.message)}},onCancelBasePrice:function(){this._oDialog.close()},onDeleteBasePrice:function(e){const t=e.getSource().getBindingContext("basePrices");const i=t.getObject();s.confirm(`Delete BasePrice ${i.code}?`,{onClose:async e=>{if(e==="OK"){try{const e=await fetch(`./odata/v4/real-estate/BasePrices(code='${i.code}')`,{method:"DELETE"});if(!e.ok)throw new Error("Delete failed");o.show("Deleted successfully");this._loadBasePrices()}catch(e){s.error(e.message)}}}})}})});
sap.ui.predefine("dboperations/controller/Buildings.controller", ["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/Dialog","sap/m/Input","sap/m/Button","sap/m/Label","sap/m/Text","sap/m/TextArea","sap/m/VBox","sap/m/DatePicker","sap/m/Table","sap/m/Column","sap/m/ColumnListItem","sap/ui/model/json/JSONModel","sap/m/Title","sap/m/IconTabBar","sap/m/IconTabFilter","sap/ui/layout/form/SimpleForm","sap/m/MessageToast","sap/ui/model/json/JSONModel"],(e,t,n,i,a,o,s,l,d,r,p,u,m,c,g,w,x,b,D)=>{"use strict";return e.extend("dboperations.controller.Buildings",{onInit(){this.getOwnerComponent().getRouter().getRoute("Buildings").attachPatternMatched(this._onRouteMatched,this);var e=new sap.ui.model.json.JSONModel({Buildings:[],Projects:[]});this.getView().setModel(e,"view");var e=new c;fetch("./odata/v4/real-estate/Buildings").then(e=>e.json()).then(t=>{e.setData({Buildings:t.value});this.getView().byId("buildingsTable").setModel(e)}).catch(e=>{console.error("Error fetching Buildings",e)});fetch("./odata/v4/real-estate/Projects").then(e=>e.json()).then(t=>{e.setData({Projects:t.value})}).catch(e=>{console.error("Error fetching Buildings",e)})},_onRouteMatched:function(){this._loadBuildings()},_loadBuildings:function(){var e=new sap.ui.model.json.JSONModel;fetch("./odata/v4/real-estate/Buildings").then(e=>e.json()).then(t=>{e.setData({Buildings:t.value});this.getView().byId("buildingsTable").setModel(e)}).catch(e=>{console.error("Error fetching Buildings ",e)})},_loadUnits:function(){const e=new c;fetch("./odata/v4/real-estate/Units?$expand=measurements,conditions").then(e=>{if(!e.ok)throw new Error("Failed to load Units");return e.json()}).then(t=>{e.setData({Units:t.value||[]});this.getView().byId("unitsTable").setModel(e)}).catch(e=>{console.error("Error loading Units:",e);t.error("Error loading Units: "+e.message)})},onStatusSelectionChange:function(e){const t=e.getSource().getSelectedKeys();const n=this.byId("unitsTable");const i=n.getBinding("items");if(!t.length){i.filter([]);return}const a=t.map(e=>new sap.ui.model.Filter("unitStatusDescription",sap.ui.model.FilterOperator.EQ,e));console.log(a);i.filter(new sap.ui.model.Filter({filters:a,and:false}))},onAddBuilding:function(){if(this._oAddBuildingDialog){this._oAddBuildingDialog.destroy();this._oAddBuildingDialog=null}var e=new sap.ui.model.json.JSONModel({buildingId:"",buildingDescription:"",buildingOldCode:"",projectId:"",projectDescription:"",companyCodeId:"",companyCodeDescription:"",validFrom:"",validTo:"",location:"",businessArea:"",profitCenter:"",functionalArea:""});var t=this;this._oAddBuildingDialog=new sap.m.Dialog({title:"Add New Building",contentWidth:"80%",content:new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:"Building ID"}),new sap.m.Input({value:"{/buildingId}",required:true}),new sap.m.Label({text:"Building Description"}),new sap.m.Input({value:"{/buildingDescription}",required:true}),new sap.m.Label({text:"Building Old Code"}),new sap.m.Input({value:"{/buildingOldCode}"}),new sap.m.Label({text:"Project ID"}),new sap.m.Input({value:"{/projectId}",required:true}),new sap.m.Label({text:"Project Description"}),new sap.m.Input({value:"{/projectDescription}",required:true}),new sap.m.Label({text:"Company Code"}),new sap.m.Input({value:"{/companyCodeId}",required:true}),new sap.m.Label({text:"Company Code Description"}),new sap.m.Input({value:"{/companyCodeDescription}",required:true}),new sap.m.Label({text:"Valid From"}),new sap.m.DatePicker({value:"{/validFrom}",required:true}),new sap.m.Label({text:"Valid To"}),new sap.m.DatePicker({value:"{/validTo}"}),new sap.m.Label({text:"Location"}),new sap.m.Input({value:"{/location}",required:true}),new sap.m.Label({text:"Business Area"}),new sap.m.Input({value:"{/businessArea}",required:true}),new sap.m.Label({text:"Profit Center"}),new sap.m.Input({value:"{/profitCenter}",required:true}),new sap.m.Label({text:"Functional Area"}),new sap.m.Input({value:"{/functionalArea}",required:true})]}),beginButton:new sap.m.Button({text:"Save",type:"Emphasized",press:function(){var e=t._oAddBuildingDialog.getModel().getData();if(e.validFrom){e.validFrom=new Date(e.validFrom).toISOString().split("T")[0]}if(e.validTo){e.validTo=new Date(e.validTo).toISOString().split("T")[0]}fetch("./odata/v4/real-estate/Buildings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>{if(!e.ok){throw new Error("Failed to create Building")}return e.json()}).then(e=>{sap.m.MessageToast.show("Building created!");var n=t.getView().byId("BuildingsTable");var i=n.getModel();var a=i.getProperty("/Buildings")||[];a.push(e);i.setProperty("/Buildings",a);t._oAddBuildingDialog.close()}).catch(e=>{sap.m.MessageBox.error("Error: "+e.message);console.log(e)})}}),endButton:new sap.m.Button({text:"Cancel",press:function(){t._oAddBuildingDialog.close()}})});this._oAddBuildingDialog.setModel(e);this.getView().addDependent(this._oAddBuildingDialog);this._oAddBuildingDialog.open()},onEdit:function(e){var t=e.getSource();var n=t.getParent().getParent().getBindingContext();if(!n){sap.m.MessageBox.warning("Error: Unable to retrieve row data");return}var i=n.getObject();var a=this.getView().byId("buildingsTable");var o=a.getModel();if(!this._oEditDialog){this._oEditBuildingModel=new sap.ui.model.json.JSONModel({buildingId:"",buildingDescription:"",buildingOldCode:"",projectId:"",projectDescription:"",companyCodeId:"",companyCodeDescription:"",validFrom:"",validTo:"",location:"",businessArea:"",profitCenter:"",functionalArea:""});this._oEditDialog=new sap.m.Dialog({title:"Edit Building",titleAlignment:"Center",contentWidth:"600px",content:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:"Building ID"}),new sap.m.Input({value:"{/buildingId}",editable:false}),new sap.m.Label({text:"Building Description"}),new sap.m.Input({value:"{/buildingDescription}"}),new sap.m.Label({text:"Building Old Code"}),new sap.m.Input({value:"{/buildingOldCode}"}),new sap.m.Label({text:"Project ID"}),new sap.m.Input({value:"{/projectId}"}),new sap.m.Label({text:"Project Description"}),new sap.m.Input({value:"{/projectDescription}"}),new sap.m.Label({text:"Company Code"}),new sap.m.Input({value:"{/companyCodeId}"}),new sap.m.Label({text:"Company Code Description"}),new sap.m.Input({value:"{/companyCodeDescription}"}),new sap.m.Label({text:"Valid From"}),new sap.m.DatePicker({value:"{/validFrom}"}),new sap.m.Label({text:"Valid To"}),new sap.m.DatePicker({value:"{/validTo}"}),new sap.m.Label({text:"Location"}),new sap.m.Input({value:"{/location}"}),new sap.m.Label({text:"Business Area"}),new sap.m.Input({value:"{/businessArea}"}),new sap.m.Label({text:"Profit Center"}),new sap.m.Input({value:"{/profitCenter}"}),new sap.m.Label({text:"Functional Area"}),new sap.m.Input({value:"{/functionalArea}"})]})],beginButton:new sap.m.Button({text:"Save",type:"Emphasized",press:()=>{var e=this._oEditBuildingModel.getData();if(e.validFrom)e.validFrom=new Date(e.validFrom).toISOString().split("T")[0];if(e.validTo)e.validTo=new Date(e.validTo).toISOString().split("T")[0];fetch(`./odata/v4/real-estate/Buildings(${e.buildingId})`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>{if(!e.ok)throw new Error("Failed to update Building");return e.json()}).then(e=>{var t=o.getProperty("/Buildings")||[];var n=t.findIndex(t=>t.buildingId===e.buildingId);if(n>-1){t[n]=e;o.setProperty("/Buildings",t)}sap.m.MessageToast.show("Building updated successfully!");this._oEditDialog.close()}).catch(e=>{sap.m.MessageBox.error("Error: "+e.message)})}}),endButton:new sap.m.Button({text:"Cancel",press:()=>this._oEditDialog.close()})});this._oEditDialog.setModel(this._oEditBuildingModel);this.getView().addDependent(this._oEditDialog)}this._oEditBuildingModel.setData(Object.assign({},i));this._oEditDialog.open()},onDelete:function(e){const n=e.getSource().getBindingContext();const i=n.getProperty("buildingId");t.confirm(`Delete Building ${i}?`,{actions:[t.Action.OK,t.Action.CANCEL],onClose:e=>{if(e===t.Action.OK){fetch(`./odata/v4/real-estate/Buildings('${encodeURIComponent(i)}')`,{method:"DELETE"}).then(e=>{if(e.ok){D.show("Deleted successfully!");this._loadBuildings()}else throw new Error("Delete failed")}).catch(e=>t.error(e.message))}}})},onNavigateToAddUnit:function(e){const t=e.getSource().getBindingContext();const n=t.getObject();const i={unitId:"",unitDescription:"",companyCodeId:"",companyCodeDescription:"",projectId:n.projectId,projectDescription:n.projectDescription,buildingId:n.buildingId,buildingDescription:n.buildingDescription,zone:"",salesPhase:"",unitDeliveryDate:"",supplementaryText:"",measurements:[],conditions:[]};const a=new sap.ui.model.json.JSONModel(i);if(this._oAddDialog){this._oAddDialog.destroy();this._oAddDialog=null}this._oAddDialog=new sap.m.Dialog({title:"Add Unit for "+i.buildingDescription,contentWidth:"80%",resizable:true,draggable:true,content:new sap.m.VBox({items:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:"Unit ID"}),new sap.m.Input({value:"{/unitId}",editable:"{= ${/unitId} === '' }",required:true}),new sap.m.Label({text:"Unit Description"}),new sap.m.Input({value:"{/unitDescription}",required:true}),new sap.m.Label({text:"Company Code ID"}),new sap.m.Input({value:"{/companyCodeId}",required:true}),new sap.m.Label({text:"Company Code Description"}),new sap.m.Input({value:"{/companyCodeDescription}",required:true}),new sap.m.Label({text:"Project ID"}),new sap.m.Input({value:"{/projectId}",editable:false,required:true}),new sap.m.Label({text:"Project Description"}),new sap.m.Input({value:"{/projectDescription}",editable:false,required:true}),new sap.m.Label({text:"Building ID"}),new sap.m.Input({value:"{/buildingId}",editable:false,required:true}),new sap.m.Label({text:"Zone"}),new sap.m.Input({value:"{/zone}"}),new sap.m.Label({text:"Sales Phase"}),new sap.m.Input({value:"{/salesPhase}"}),new sap.m.Label({text:"Delivery Date"}),new sap.m.DatePicker({value:"{/unitDeliveryDate}",valueFormat:"yyyy-MM-dd",displayFormat:"long"}),new sap.m.Label({text:"Supplementary Text"}),new sap.m.TextArea({value:"{/supplementaryText}",rows:3,width:"100%"})]}),new sap.m.Title({text:"Measurements",level:"H3",class:" sapUiMarginStart sapUiSmallMarginTop"}),new sap.m.Button({text:"Add Measurement",press:this.onAddMeasurementRow.bind(this)}),new sap.m.Table({id:"measurementsTable",items:"{/measurements}",columns:[new sap.m.Column({header:new sap.m.Label({text:"Code"})}),new sap.m.Column({header:new sap.m.Label({text:"Description"})}),new sap.m.Column({header:new sap.m.Label({text:"Quantity"})}),new sap.m.Column({header:new sap.m.Label({text:"UOM"})})],items:{path:"/measurements",template:new sap.m.ColumnListItem({cells:[new sap.m.Input({value:"{code}"}),new sap.m.Input({value:"{description}"}),new sap.m.Input({value:"{quantity}",type:"Number"}),new sap.m.Input({value:"{uom}"})]})}}),new sap.m.Title({text:"Conditions",level:"H3",class:"sapUiMarginStart sapUiSmallMarginTop"}),new sap.m.Button({text:"Add Condition",press:this.onAddConditionRow.bind(this)}),new sap.m.Table({id:"conditionsTable",items:"{/conditions}",columns:[new sap.m.Column({header:new sap.m.Label({text:"Code"})}),new sap.m.Column({header:new sap.m.Label({text:"Description"})}),new sap.m.Column({header:new sap.m.Label({text:"Amount"})}),new sap.m.Column({header:new sap.m.Label({text:"Currency"})})],items:{path:"/conditions",template:new sap.m.ColumnListItem({cells:[new sap.m.Input({value:"{code}"}),new sap.m.Input({value:"{description}"}),new sap.m.Input({value:"{amount}",type:"Number"}),new sap.m.Input({value:"{currency}"})]})}})]}),beginButton:new sap.m.Button({text:"Save",type:"Emphasized",press:this.onSaveUnit.bind(this)}),endButton:new sap.m.Button({text:"Cancel",press:function(){this._oAddDialog.close()}.bind(this)})});this._oAddDialog.setModel(a);this.getView().addDependent(this._oAddDialog);this._oAddDialog.open()},onAddMeasurementRow:function(){const e=this._oAddDialog.getModel();e.getProperty("/measurements").push({code:"",description:"",quantity:0,uom:""});e.refresh()},onAddConditionRow:function(){const e=this._oAddDialog.getModel();e.getProperty("/conditions").push({code:"",description:"",amount:0,currency:""});e.refresh()},_generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0,n=e==="x"?t:t&3|8;return n.toString(16)})},onSaveUnit:function(){const e=this._oAddDialog.getModel().getData();const n={unitId:e.unitId||Date.now().toString().slice(-8),unitDescription:e.unitDescription,companyCodeId:e.companyCodeId,companyCodeDescription:e.companyCodeDescription,projectId:e.projectId,projectDescription:e.projectDescription,buildingId:e.buildingId,zone:e.zone,salesPhase:e.salesPhase,unitDeliveryDate:e.unitDeliveryDate||null,supplementaryText:e.supplementaryText,profitCenter:e.profitCenter||0,functionalArea:e.functionalArea||0,measurements:e.measurements,conditions:e.conditions};const i=!!e.unitId;const a=i?"PATCH":"POST";const o=i?`./odata/v4/real-estate/Units(unitId='${encodeURIComponent(e.unitId)}')`:"./odata/v4/real-estate/Units";fetch(o,{method:a,headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(e=>{if(!e.ok)throw new Error(i?"Update failed":"Create failed")}).then(()=>{this._loadUnits();t.success(i?"Unit updated successfully!":"Unit created successfully!");this._oAddDialog.close()}).catch(e=>t.error(e.message))},onDetails:function(e){var t=e.getSource().getBindingContext();if(!t){return}var n=t.getObject();var i=new sap.ui.model.json.JSONModel({BuildingId:n.buildingId,BuildingDescription:n.buildingDescription,BuildingOldCode:n.buildingOldCode,ProjectId:n.projectId,ProjectDescription:n.projectDescription,CompanyCodeId:n.companyCodeId,CompanyCodeDescription:n.companyCodeDescription,validFrom:n.validFrom,validTo:n.validTo,location:n.location,businessArea:n.businessArea,profitCenter:n.profitCenter,functionalArea:n.functionalArea,supplementaryText:n.supplementaryText});if(!this._oDetailsDialog){this._oDetailsDialog=new sap.m.Dialog({title:"Building Details",contentWidth:"100%",resizable:true,draggable:true,content:[new sap.m.IconTabBar({expandable:true,items:[new sap.m.IconTabFilter({text:"General Data",icon:"sap-icon://building",content:[new sap.ui.layout.form.SimpleForm({editable:false,layout:"ResponsiveGridLayout",labelSpanL:3,columnsL:2,content:[new sap.m.Label({text:"Building ID (8 digits)"}),new sap.m.Text({text:"{/BuildingId}"}),new sap.m.Label({text:"Building Description"}),new sap.m.Text({text:"{/BuildingDescription}"}),new sap.m.Label({text:"Building Old Code"}),new sap.m.Text({text:"{/BuildingOldCode}"}),new sap.m.Label({text:"Project ID"}),new sap.m.Text({text:"{/ProjectId}"}),new sap.m.Label({text:"Project Description"}),new sap.m.Text({text:"{/ProjectDescription}"}),new sap.m.Label({text:"Company Code"}),new sap.m.Text({text:"{/CompanyCodeId}"}),new sap.m.Label({text:"Company Code Description"}),new sap.m.Text({text:"{/CompanyCodeDescription}"}),new sap.m.Label({text:"Valid From"}),new sap.m.Text({text:"{/validFrom}"}),new sap.m.Label({text:"Valid To"}),new sap.m.Text({text:"{/validTo}"}),new sap.m.Label({text:"Location"}),new sap.m.Text({text:"{/location}"})]})]}),new sap.m.IconTabFilter({text:"Posting Parameters",icon:"sap-icon://post",content:[new sap.ui.layout.form.SimpleForm({editable:false,layout:"ResponsiveGridLayout",labelSpanL:3,columnsL:2,content:[new sap.m.Label({text:"Business Area"}),new sap.m.Text({text:"{/businessArea}"}),new sap.m.Label({text:"Profit Center"}),new sap.m.Text({text:"{/profitCenter}"}),new sap.m.Label({text:"Functional Area"}),new sap.m.Text({text:"{/functionalArea}"})]})]}),new sap.m.IconTabFilter({text:"Supplementary Text",icon:"sap-icon://document-text",content:[new sap.ui.layout.form.SimpleForm({editable:false,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:"Supplementary Text"}),new sap.m.TextArea({value:"{/supplementaryText}",width:"100%",rows:6,editable:false,growing:true,growingMaxLines:10})]})]})]})],endButton:new sap.m.Button({text:"Close",type:"Emphasized",press:function(){this._oDetailsDialog.close()}.bind(this)})});this.getView().addDependent(this._oDetailsDialog)}this._oDetailsDialog.setModel(i);this._oDetailsDialog.open()}})});
sap.ui.predefine("dboperations/controller/CalculationMethods.controller", ["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel"],function(o,t,e,a){"use strict";return o.extend("dboperations.controller.CalculationMethods",{onInit:function(){this._loadCalculationMethods()},_loadCalculationMethods:function(){fetch("./odata/v4/real-estate/CalculationMethods").then(o=>o.json()).then(o=>{this.getView().setModel(new a(o.value||[]),"calculationMethods")}).catch(o=>console.error("Failed to load CalculationMethods:",o))},onAddCalculationMethod:function(){this._openCalculationMethodDialog({})},onEditCalculationMethod:function(o){const t=o.getSource().getBindingContext("calculationMethods");const e=t.getObject();this._openCalculationMethodDialog(e)},_openCalculationMethodDialog:function(o){if(!this._oDialog){this._oDialog=this.getView().byId("calculationMethodDialog")}const t=new a({code:o.code||"",description:o.description||"",isEdit:!!o.code});this._oDialog.setModel(t,"local");this._oDialog.open()},onSaveCalculationMethod:async function(){const o=this._oDialog;const a=o.getModel("local");const i=a.getData();if(!i.code||!i.description){e.error("Code and Description are required.");return}try{const e=i.isEdit?"PUT":"POST";const a=i.isEdit?`./odata/v4/real-estate/CalculationMethods(code='${i.code}')`:`./odata/v4/real-estate/CalculationMethods`;const n=await fetch(a,{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify({code:i.code,description:i.description})});if(!n.ok)throw new Error("Failed to save CalculationMethod");t.show("CalculationMethod saved successfully!");o.close();this._loadCalculationMethods()}catch(o){e.error("Error: "+o.message)}},onCancelCalculationMethod:function(){this._oDialog.close()},onDeleteCalculationMethod:function(o){const a=o.getSource().getBindingContext("calculationMethods");const i=a.getObject();e.confirm(`Delete CalculationMethod ${i.code}?`,{onClose:async o=>{if(o==="OK"){try{const o=await fetch(`./odata/v4/real-estate/CalculationMethods(code='${i.code}')`,{method:"DELETE"});if(!o.ok)throw new Error("Delete failed");t.show("Deleted successfully");this._loadCalculationMethods()}catch(o){e.error(o.message)}}}})}})});
sap.ui.predefine("dboperations/controller/ConditionTypes.controller", ["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel"],function(o,e,t,i){"use strict";return o.extend("dboperations.controller.ConditionTypes",{onInit:function(){this._loadConditionTypes()},_loadConditionTypes:function(){fetch("./odata/v4/real-estate/ConditionTypes").then(o=>o.json()).then(o=>{this.getView().setModel(new i(o.value||[]),"conditionTypes")}).catch(o=>console.error("Failed to load ConditionTypes:",o))},onAddConditionType:function(){this._openConditionTypeDialog({})},onEditConditionType:function(o){const e=o.getSource().getBindingContext("conditionTypes");const t=e.getObject();this._openConditionTypeDialog(t)},_openConditionTypeDialog:function(o){if(!this._oDialog){this._oDialog=this.getView().byId("conditionTypeDialog")}const e=new i({code:o.code||"",description:o.description||"",isEdit:!!o.code});this._oDialog.setModel(e,"local");this._oDialog.open()},onSaveConditionType:async function(){const o=this._oDialog;const i=o.getModel("local");const n=i.getData();if(!n.code||!n.description){t.error("Code and Description are required.");return}try{const t=n.isEdit?"PUT":"POST";const i=n.isEdit?`./odata/v4/real-estate/ConditionTypes(code='${n.code}')`:`./odata/v4/real-estate/ConditionTypes`;const s=await fetch(i,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify({code:n.code,description:n.description})});if(!s.ok)throw new Error("Failed to save ConditionType");e.show("ConditionType saved successfully!");o.close();this._loadConditionTypes()}catch(o){t.error("Error: "+o.message)}},onCancelConditionType:function(){this._oDialog.close()},onDeleteConditionType:function(o){const i=o.getSource().getBindingContext("conditionTypes");const n=i.getObject();t.confirm(`Delete ConditionType ${n.code}?`,{onClose:async o=>{if(o==="OK"){try{const o=await fetch(`./odata/v4/real-estate/ConditionTypes(code='${n.code}')`,{method:"DELETE"});if(!o.ok)throw new Error("Delete failed");e.show("Deleted successfully");this._loadConditionTypes()}catch(o){t.error(o.message)}}}})}})});
sap.ui.predefine("dboperations/controller/Conditions.controller", ["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel"],function(o,t,n,i){"use strict";return o.extend("dboperations.controller.Conditions",{onInit:function(){this._loadConditions()},_loadConditions:function(){fetch("./odata/v4/real-estate/Conditions").then(o=>o.json()).then(o=>{this.getView().setModel(new i(o.value||[]),"conditions")}).catch(o=>console.error("Failed to load Conditions:",o))},onAddCondition:function(){this._openConditionDialog({})},onEditCondition:function(o){const t=o.getSource().getBindingContext("conditions");const n=t.getObject();this._openConditionDialog(n)},_openConditionDialog:function(o){if(!this._oDialog){this._oDialog=this.getView().byId("conditionDialog")}const t=new i({code:o.code||"",description:o.description||"",ID:o.ID||null,isEdit:!!o.code});this._oDialog.setModel(t,"local");this._oDialog.open()},onSaveCondition:async function(){const o=this._oDialog;const i=o.getModel("local");const e=i.getData();if(!e.code||!e.description){n.error("Code and Description are required.");return}try{const n={code:e.code,description:e.description};const i=e.isEdit?"PUT":"POST";const s=e.isEdit?`./odata/v4/real-estate/Conditions(ID='${e.ID}')`:`./odata/v4/real-estate/Conditions`;const d=await fetch(s,{method:i,headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!d.ok)throw new Error("Failed to save Condition");t.show("Condition saved successfully!");o.close();this._loadConditions()}catch(o){n.error("Error: "+o.message)}},onCancelCondition:function(){this._oDialog.close()},onDeleteCondition:function(o){const i=o.getSource().getBindingContext("conditions");const e=i.getObject();n.confirm(`Delete Condition ${e.code}?`,{onClose:async o=>{if(o==="OK"){try{const o=await fetch(`./odata/v4/real-estate/Conditions(ID='${e.ID}')`,{method:"DELETE"});if(!o.ok)throw new Error("Delete failed");t.show("Deleted successfully");this._loadConditions()}catch(o){n.error(o.message)}}}})}})});
sap.ui.predefine("dboperations/controller/DBOperations.controller", ["sap/ui/core/mvc/Controller"],e=>{"use strict";return e.extend("dboperations.controller.DBOperations",{onInit(){},onNavigateToProjects(){this.getOwnerComponent().getRouter().navTo("Projects")},onNavigateToBuildings(){this.getOwnerComponent().getRouter().navTo("Buildings")},onNavigateToUnits(){this.getOwnerComponent().getRouter().navTo("Units")},onNavigateToPaymentPlans(){this.getOwnerComponent().getRouter().navTo("PaymentPlans")},onNavigateToPaymentPlanSchedules(){this.getOwnerComponent().getRouter().navTo("PaymentPlanSchedules")},onNavigateToPaymentPlanProjects(){this.getOwnerComponent().getRouter().navTo("PaymentPlanProjects")},onNavigateToReservations(){this.getOwnerComponent().getRouter().navTo("Reservations")},onNavigateToEOI(){this.getOwnerComponent().getRouter().navTo("EOI")},onNavigateToPaymentPlanSimulations(){this.getOwnerComponent().getRouter().navTo("PaymentPlanSimulations")},onNavigateToConditionTypes(){this.getOwnerComponent().getRouter().navTo("ConditionTypes")},onNavigateToCalculationMethods(){this.getOwnerComponent().getRouter().navTo("CalculationMethods")},onNavigateToFrequencies(){this.getOwnerComponent().getRouter().navTo("Frequencies")},onNavigateToMeasurements(){this.getOwnerComponent().getRouter().navTo("Measurements")},onNavigateToConditions(){this.getOwnerComponent().getRouter().navTo("Conditions")},onNavigateToBasePrices(){this.getOwnerComponent().getRouter().navTo("BasePrices")}})});
sap.ui.predefine("dboperations/controller/EOI.controller", ["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/Dialog","sap/m/Input","sap/m/Button","sap/m/Label","sap/m/Text","sap/m/VBox","sap/m/DatePicker","sap/m/Table","sap/m/Column","sap/m/ColumnListItem","sap/ui/model/json/JSONModel","sap/m/Title","sap/m/IconTabBar","sap/m/IconTabFilter","sap/ui/layout/form/SimpleForm","sap/m/HBox"],function(e,t,a,n,o,s,i,l,d,r,c,u,p,m,w,y,h,x){"use strict";return e.extend("dboperations.controller.EOI",{onInit:function(){this._loadEOIs()},_loadEOIs:function(){const e=new p;fetch("./odata/v4/real-estate/EOI?$expand=paymentDetails").then(e=>e.json()).then(t=>{e.setData({EOI:t.value||[]});this.getView().byId("eoiTable").setModel(e)}).catch(e=>{console.error("Error loading EOIs:",e);t.error("Error loading EOIs: "+e.message)})},onNavigateToAddEOI:function(){const e={eoiType:"",status:"",date:"",companyCode:"",projectId:"",totalEoiValue:0,collectedAmount:0,remainingAmount:0,nationality:"",mobile1:"",customerId:"",validatedBy:"",validatedOn:"",paymentDetails:[]};this._openAddEditDialog(e,false)},onEditEOI:function(e){const a=e.getSource().getBindingContext();if(!a)return t.warning("No EOI selected.");const n=Object.assign({},a.getObject());this._openAddEditDialog(n,true)},_openAddEditDialog:function(e,t){if(this._oAddDialog){this._oAddDialog.destroy();this._oAddDialog=null}const n=new p(e);this._oAddDialog=new a({title:t?"Edit EOI":"Add EOI",contentWidth:"100%",resizable:true,draggable:true,content:new l({items:this._createAddEditForm()}),beginButton:new o({text:"Save",type:"Emphasized",press:this.onSaveEOI.bind(this)}),endButton:new o({text:"Cancel",press:()=>this._oAddDialog.close()})});this._oAddDialog.setModel(n);this.getView().addDependent(this._oAddDialog);this._oAddDialog.open()},_createAddEditForm:function(){return[new s({text:"EOI Type"}),new n({value:"{/eoiType}"}),new s({text:"Status"}),new n({value:"{/status}"}),new s({text:"Date"}),new d({value:"{/date}",valueFormat:"yyyy-MM-dd"}),new s({text:"Company Code"}),new n({value:"{/companyCode}"}),new s({text:"Project ID"}),new n({value:"{/projectId}"}),new s({text:"Total EOI Value"}),new n({value:"{/totalEoiValue}",type:"Number"}),new s({text:"Collected Amount"}),new n({value:"{/collectedAmount}",type:"Number"}),new s({text:"Remaining Amount"}),new n({value:"{/remainingAmount}",type:"Number"}),new s({text:"Customer ID"}),new n({value:"{/customerId}"}),new s({text:"Nationality"}),new n({value:"{/nationality}"}),new s({text:"Mobile 1"}),new n({value:"{/mobile1}"}),new s({text:"Validated By"}),new n({value:"{/validatedBy}"}),new s({text:"Validated On"}),new d({value:"{/validatedOn}",valueFormat:"yyyy-MM-dd"}),new m({text:"Payment Details",level:"H3"}),new o({text:"Add Payment",press:this.onAddPaymentRow.bind(this)}),new r({id:"paymentDetailsTable",items:"{/paymentDetails}",columns:[new c({header:new s({text:"Receipt Type"})}),new c({header:new s({text:"Status"})}),new c({header:new s({text:"Payment Method"})}),new c({header:new s({text:"Amount"})}),new c({header:new s({text:"Due Date"})}),new c({header:new s({text:"House Bank"})}),new c({header:new s({text:"Collected Amount"})})],items:{path:"/paymentDetails",template:new u({cells:[new n({value:"{receiptType}"}),new n({value:"{receiptStatus}"}),new n({value:"{paymentMethod}"}),new n({value:"{amount}",type:"Number"}),new d({value:"{dueDate}",valueFormat:"yyyy-MM-dd"}),new n({value:"{houseBank}"}),new n({value:"{collectedAmount}",type:"Number"})]})}})]},onSaveEOI:function(){const e=this._oAddDialog.getModel().getData();const a=!!e.eoiId&&e.eoiId.trim()!=="";const n=a?e.eoiId:Date.now().toString().slice(-8);const o={eoiId:n,eoiType:e.eoiType,status:e.status,date:e.date||null,companyCode:e.companyCode,projectId:e.projectId,totalEoiValue:parseFloat(e.totalEoiValue)||0,collectedAmount:parseFloat(e.collectedAmount)||0,remainingAmount:parseFloat(e.remainingAmount)||0,nationality:e.nationality,mobile1:e.mobile1,customerId:e.customerId,validatedBy:e.validatedBy,validatedOn:e.validatedOn||null,paymentDetails:e.paymentDetails||[]};const s=a?"PATCH":"POST";const i=a?`./odata/v4/real-estate/EOI(eoiId='${encodeURIComponent(n)}')`:"./odata/v4/real-estate/EOI";console.log("EOI Save →",s,i,o);fetch(i,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then(async e=>{if(!e.ok){const t=await e.text().catch(()=>"");throw new Error(t||"Save failed")}return e.text().then(e=>e?JSON.parse(e):{})}).then(()=>{this._loadEOIs();t.success(a?"EOI updated successfully!":"EOI created successfully!");this._oAddDialog.close()}).catch(e=>{console.error("Save error:",e);t.error("Save failed: "+e.message)})},onDetails:function(e){const n=e.getSource().getBindingContext();if(!n)return t.warning("No EOI selected.");const l=n.getObject();const d=new p(l);if(this._oDetailsDialog){this._oDetailsDialog.destroy();this._oDetailsDialog=null}this._oDetailsDialog=new a({title:"EOI Details",contentWidth:"900px",resizable:true,draggable:true,content:[new w({items:[new y({text:"General Data",icon:"sap-icon://home",content:new h({editable:false,content:[new s({text:"EOI ID"}),new i({text:"{/eoiId}"}),new s({text:"EOI Type"}),new i({text:"{/eoiType}"}),new s({text:"Status"}),new i({text:"{/status}"}),new s({text:"Date"}),new i({text:"{/date}"}),new s({text:"Company Code"}),new i({text:"{/companyCode}"}),new s({text:"Project ID"}),new i({text:"{/projectId}"}),new s({text:"Total Value"}),new i({text:"{/totalEoiValue}"}),new s({text:"Collected Amount"}),new i({text:"{/collectedAmount}"}),new s({text:"Remaining Amount"}),new i({text:"{/remainingAmount}"})]})}),new y({text:"Payment Details",icon:"sap-icon://money-bills",content:[new r({columns:[new c({header:new s({text:"Receipt Type"})}),new c({header:new s({text:"Status"})}),new c({header:new s({text:"Payment Method"})}),new c({header:new s({text:"Amount"})}),new c({header:new s({text:"Due Date"})}),new c({header:new s({text:"House Bank"})}),new c({header:new s({text:"Collected Amount"})})],items:{path:"/paymentDetails",template:new u({cells:[new i({text:"{receiptType}"}),new i({text:"{receiptStatus}"}),new i({text:"{paymentMethod}"}),new i({text:"{amount}"}),new i({text:"{dueDate}"}),new i({text:"{houseBank}"}),new i({text:"{collectedAmount}"})]})}})]})]})],endButton:new o({text:"Close",press:()=>this._oDetailsDialog.close()})});this._oDetailsDialog.setModel(d);this.getView().addDependent(this._oDetailsDialog);this._oDetailsDialog.open()},onAddReservationFromEOI:async function(e){const t=e.getSource().getBindingContext();if(!t){sap.m.MessageToast.show("No EOI selected.");return}const a=t.getObject();const n=new sap.ui.model.json.JSONModel({reservationId:"",companyCodeId:a.companyCode||"",oldReservationId:"",eoiId:a.eoiId||"",description:`Reservation for EOI ${a.eoiId}`,salesType:"",validFrom:(new Date).toISOString().split("T")[0],customerType:"",currency:"",afterSales:"",status:"Draft",project_projectId:a.projectId||"",building_buildingId:"",unit_unitId:"",paymentPlan_paymentPlanId:"",bua:0,phase:"",pricePlanYears:0,planYears:0,unitPrice:0,planCurrency:"",requestType:"",reason:"",cancellationDate:"",cancellationStatus:"",rejectionReason:"",cancellationFees:0,payments:[],partners:[],conditions:[]});if(!this._oAddReservationDialog){this._oAddReservationDialog=new sap.m.Dialog({title:"Add Reservation from EOI",contentWidth:"700px",contentHeight:"80%",resizable:true,draggable:true,class:"sapUiSizeCompact",content:[new sap.m.ScrollContainer({height:"100%",vertical:true,focusable:true,content:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",labelSpanL:4,columnsL:2,content:[new sap.m.Label({text:"EOI ID"}),new sap.m.Text({text:"{/eoiId}"}),new sap.m.Label({text:"Company Code"}),new sap.m.Text({text:"{/companyCodeId}"}),new sap.m.Label({text:"Project ID"}),new sap.m.Text({text:"{/project_projectId}"}),new sap.m.Label({text:"Description"}),new sap.m.Input({value:"{/description}"}),new sap.m.Label({text:"Sales Type"}),new sap.m.Input({value:"{/salesType}"}),new sap.m.Label({text:"Valid From"}),new sap.m.DatePicker({value:"{/validFrom}",displayFormat:"long",valueFormat:"yyyy-MM-dd",showClearIcon:true}),new sap.m.Label({text:"Currency"}),new sap.m.Input({value:"{/currency}"}),new sap.m.Label({text:"Customer Type"}),new sap.m.Input({value:"{/customerType}"}),new sap.m.Label({text:"After Sales"}),new sap.m.Input({value:"{/afterSales}"}),new sap.m.Label({text:"Phase"}),new sap.m.Input({value:"{/phase}"}),new sap.m.Label({text:"Unit Price"}),new sap.m.Input({value:"{/unitPrice}"}),new sap.m.Label({text:"BUA"}),new sap.m.Input({value:"{/bua}"}),new sap.m.Label({text:"Plan Years"}),new sap.m.Input({value:"{/planYears}"}),new sap.m.Label({text:"Price Plan Years"}),new sap.m.Input({value:"{/pricePlanYears}"}),new sap.m.Label({text:"Plan Currency"}),new sap.m.Input({value:"{/planCurrency}"}),new sap.m.Label({text:"Request Type"}),new sap.m.Input({value:"{/requestType}"}),new sap.m.Label({text:"Reason"}),new sap.m.Input({value:"{/reason}"}),new sap.m.Label({text:"Cancellation Date"}),new sap.m.DatePicker({value:"{/cancellationDate}",displayFormat:"long",valueFormat:"yyyy-MM-dd",showClearIcon:true}),new sap.m.Label({text:"Cancellation Status"}),new sap.m.Input({value:"{/cancellationStatus}"}),new sap.m.Label({text:"Cancellation Fees"}),new sap.m.Input({value:"{/cancellationFees}"})]})]})],beginButton:new sap.m.Button({text:"Save",type:"Emphasized",press:async function(){const e=this._oAddReservationDialog.getModel().getData();try{const t=await fetch("./odata/v4/real-estate/Reservations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const e=await t.json();throw new Error(e.error?.message||"Failed to create reservation")}sap.m.MessageToast.show("Reservation created successfully!");this._oAddReservationDialog.close()}catch(e){console.error("❌ Error creating reservation from EOI:",e);sap.m.MessageBox.error("Error: "+e.message)}}.bind(this)}),endButton:new sap.m.Button({text:"Cancel",press:function(){this._oAddReservationDialog.close()}.bind(this)})});this.getView().addDependent(this._oAddReservationDialog)}this._oAddReservationDialog.setModel(n);this._oAddReservationDialog.open()},onAddPaymentRow:function(){const e=this._oAddDialog.getModel();const t=e.getProperty("/paymentDetails")||[];t.push({receiptType:"",receiptStatus:"",paymentMethod:"",amount:0,dueDate:"",houseBank:"",collectedAmount:0});e.setProperty("/paymentDetails",t);e.refresh()},onDelete:function(e){const a=e.getSource().getBindingContext();if(!a)return;const n=a.getObject().eoiId;t.confirm(`Delete EOI ${n}?`,{onClose:e=>{if(e!==t.Action.OK)return;fetch(`/odata/v4/real-estate/EOI(eoiId='${encodeURIComponent(n)}')`,{method:"DELETE"}).then(()=>this._loadEOIs()).then(()=>t.success("EOI deleted successfully!")).catch(e=>t.error(e.message))}})}})});
sap.ui.predefine("dboperations/controller/Frequencies.controller", ["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel"],function(e,o,t,n){"use strict";return e.extend("dboperations.controller.Frequencies",{onInit:function(){this._loadFrequencies()},_loadFrequencies:function(){fetch("./odata/v4/real-estate/Frequencies").then(e=>e.json()).then(e=>{this.getView().setModel(new n(e.value||[]),"frequencies")}).catch(e=>console.error("Failed to load Frequencies:",e))},onAddFrequency:function(){this._openFrequencyDialog({})},onEditFrequency:function(e){const o=e.getSource().getBindingContext("frequencies");const t=o.getObject();this._openFrequencyDialog(t)},_openFrequencyDialog:function(e){if(!this._oDialog){this._oDialog=this.getView().byId("frequencyDialog")}const o=new n({code:e.code||"",description:e.description||"",isEdit:!!e.code});this._oDialog.setModel(o,"local");this._oDialog.open()},onSaveFrequency:async function(){const e=this._oDialog;const n=e.getModel("local");const c=n.getData();if(!c.code||!c.description){t.error("Code and Description are required.");return}try{const t=c.isEdit?"PUT":"POST";const n=c.isEdit?`./odata/v4/real-estate/Frequencies(code='${c.code}')`:`./odata/v4/real-estate/Frequencies`;const i=await fetch(n,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify({code:c.code,description:c.description})});if(!i.ok)throw new Error("Failed to save Frequency");o.show("Frequency saved successfully!");e.close();this._loadFrequencies()}catch(e){t.error("Error: "+e.message)}},onCancelFrequency:function(){this._oDialog.close()},onDeleteFrequency:function(e){const n=e.getSource().getBindingContext("frequencies");const c=n.getObject();t.confirm(`Delete Frequency ${c.code}?`,{onClose:async e=>{if(e==="OK"){try{const e=await fetch(`./odata/v4/real-estate/Frequencies(code='${c.code}')`,{method:"DELETE"});if(!e.ok)throw new Error("Delete failed");o.show("Deleted successfully");this._loadFrequencies()}catch(e){t.error(e.message)}}}})}})});
sap.ui.predefine("dboperations/controller/Measurements.controller", ["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel"],function(e,t,o,s){"use strict";return e.extend("dboperations.controller.Measurements",{onInit:function(){this._loadMeasurements()},_loadMeasurements:function(){fetch("./odata/v4/real-estate/Measurements").then(e=>e.json()).then(e=>{this.getView().setModel(new s(e.value||[]),"measurements")}).catch(e=>console.error("Failed to load Measurements:",e))},onAddMeasurement:function(){this._openMeasurementDialog({})},onEditMeasurement:function(e){const t=e.getSource().getBindingContext("measurements");const o=t.getObject();this._openMeasurementDialog(o)},_openMeasurementDialog:function(e){if(!this._oDialog){this._oDialog=this.getView().byId("measurementDialog")}const t=new s({code:e.code||"",description:e.description||"",ID:e.ID||null,isEdit:!!e.ID});this._oDialog.setModel(t,"local");this._oDialog.open()},onSaveMeasurement:async function(){const e=this._oDialog;const s=e.getModel("local");const n=s.getData();if(!n.code||!n.description){o.error("Code and Description are required.");return}try{const o={code:n.code,description:n.description};const s=n.isEdit?"PUT":"POST";const a=n.isEdit?`./odata/v4/real-estate/Measurements(ID='${n.ID}')`:`./odata/v4/real-estate/Measurements`;const i=await fetch(a,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!i.ok)throw new Error("Failed to save Measurement");t.show("Measurement saved successfully!");e.close();this._loadMeasurements()}catch(e){o.error("Error: "+e.message)}},onCancelMeasurement:function(){this._oDialog.close()},onDeleteMeasurement:function(e){const s=e.getSource().getBindingContext("measurements");const n=s.getObject();o.confirm(`Delete Measurement ${n.code}?`,{onClose:async e=>{if(e==="OK"){try{const e=await fetch(`./odata/v4/real-estate/Measurements(ID='${n.ID}')`,{method:"DELETE"});if(!e.ok)throw new Error("Delete failed");t.show("Deleted successfully");this._loadMeasurements()}catch(e){o.error(e.message)}}}})}})});
sap.ui.predefine("dboperations/controller/PaymentPlanSimulations.controller", ["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel"],function(e,t,n,i){"use strict";return e.extend("dboperations.controller.PaymentPlanSimulations",{onInit:function(){this.getView().setModel(new i({}),"local");this.getView().setModel(new i([]),"simulationOutput");this._loadUnits();this._loadDropdownData();this._idCounter=parseInt(localStorage.getItem("simulationIdCounter"))||0},onOpenUnitValueHelp:function(){const e=this.getView();if(!this._oUnitValueHelp){this._oUnitValueHelp=new sap.m.SelectDialog({title:"Select Unit",items:{path:"units>/",template:new sap.m.StandardListItem({title:"{units>unitDescription}",description:"{units>unitId}"})},search:function(e){const t=e.getParameter("value")||"";const n=[new sap.ui.model.Filter("unitDescription",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("unitId",sap.ui.model.FilterOperator.Contains,t)];e.getSource().getBinding("items").filter(new sap.ui.model.Filter(n,false))},confirm:function(t){const n=t.getParameter("selectedItem");if(n){const t=n.getBindingContext("units");const i=t.getObject();const o=i.unitId;const s=i.unitDescription;const a=e.getModel("local");a.setProperty("/unitId",o);const r=e.byId("unitIdInput");if(r){r.setValue(`${s} (${o})`)}this._onUnitSelected(o)}}.bind(this),liveChange:function(e){const t=e.getParameter("value")||"";const n=[new sap.ui.model.Filter("unitDescription",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("unitId",sap.ui.model.FilterOperator.Contains,t)];e.getSource().getBinding("items").filter(new sap.ui.model.Filter(n,false))}});e.addDependent(this._oUnitValueHelp)}this._oUnitValueHelp.open()},_onUnitSelected:function(e){this.onUnitChange({getParameter:()=>({selectedItem:{getKey:()=>e}})})},_loadUnits:function(){fetch("./odata/v4/real-estate/Units?$expand=project").then(e=>e.json()).then(e=>{this.getView().setModel(new i(e.value||[]),"units");console.log("Units loaded:",e);const t=this.getView().byId("unitIdSelect");if(t&&t.getBinding("items")){t.getBinding("items").refresh()}}).catch(e=>console.error("Failed to load units:",e))},_loadDropdownData:async function(){try{const[e,t]=await Promise.all([fetch("./odata/v4/real-estate/Projects"),fetch("./odata/v4/real-estate/PaymentPlans?$expand=assignedProjects($expand=project)")]);const n=await e.json();const o=await t.json();this.getView().setModel(new i(n.value||[]),"projects");this.getView().setModel(new i(o.value||[]),"paymentPlans")}catch(e){console.error("Failed to load dropdown data:",e)}},onUnitChange:async function(e){let t=null;if(e&&typeof e.getParameter==="function"){const n=e.getParameter("selectedItem");if(n&&typeof n.getKey==="function"){t=n.getKey()}}if(!t){const e=this.getView().byId("unitIdSelect");if(e&&typeof e.getSelectedKey==="function"){t=e.getSelectedKey()}}if(!t){const e=this.getView().getModel("local");t=e?e.getProperty("/unitId"):null}if(!t){console.warn("onUnitChange: no unit selected.");return}const n=this.getView().getModel("units");const i=n?n.getData():[];const o=(i||[]).find(e=>e.unitId===t);console.log("Selected unit:",o);if(o){const e=o.project?.projectId||o.projectId;const n=o.project?.projectDescription||o.projectDescription;if(e){const i=this.getView().getModel("local");i.setProperty("/projectId",e);i.setProperty("/projectDescription",n);try{const e=await fetch(`./odata/v4/real-estate/Conditions?$filter=unit_unitId eq '${t}'`);const n=await e.json();const o=n.value||[];console.log("Conditions for unit:",o);const s=(o||[]).reduce((e,t)=>{const n=Number(t.amount)||0;return e+n},0);i.setProperty("/finalPrice",s);console.log("Final Price set to:",s)}catch(e){console.error("Failed to calculate final price:",e)}}else{console.warn("No project info on selected unit.")}}else{console.warn("Selected unit not found in units model.")}},onPricePlanChange:function(e){const t=parseInt(e.getParameter("value"));const n=this.getView().byId("projectIdInput").getValue();const i=this.getView().getModel("paymentPlans");const o=i?i.getData():[];const s=(o||[]).find(e=>e.planYears===t&&Array.isArray(e.assignedProjects)&&e.assignedProjects.some(e=>e.project?.projectId===n));if(s){this.getView().byId("paymentPlanIdInput").setValue(s.paymentPlanId)}else{this.getView().byId("paymentPlanIdInput").setValue("")}},onSimulate:async function(){debugger;const e=this.getView().getModel("local");const t=e?e.getProperty("/unitId"):null;const o=e?Number(e.getProperty("/finalPrice")):NaN;const s=this.getView().byId("projectIdInput").getValue();const a=this.getView().byId("paymentPlanIdInput").getValue();const r=parseInt(this.getView().byId("pricePlanInput").getValue());const l=this.getView().byId("leadIdInput").getValue();const c="currentUser";if(!t){n.error("Please select a unit.");return}const u=this.getView().getModel("paymentPlans");const d=u?u.getData():[];const p=d.find(e=>e.planYears===r&&Array.isArray(e.assignedProjects)&&e.assignedProjects.some(e=>e.project?.projectId===s));if(!p){n.error("No payment plan exists for the selected years and project. Please enter a valid number of years.");return}if(!a){n.error("Payment Plan ID is not set. Please ensure the years are valid.");return}if(!o||isNaN(o)){n.error("Please fill all required fields (Final Price).");return}try{const n=await fetch(`./odata/v4/real-estate/PaymentPlanSchedules?$filter=paymentPlan_paymentPlanId eq '${a}'&$expand=conditionType,basePrice,frequency`);const o=await n.json();const s=o.value||[];const r=await fetch(`./odata/v4/real-estate/Conditions?$filter=unit_unitId eq '${t}'`);const l=await r.json();const c=l.value||[];const u=[];const d=new Date;s.forEach(e=>{const t=e.basePrice?.code;const n=c.find(e=>e.code===t);const i=n?Number(n.amount):0;const o=i*e.percentage/100;const s=this._getFrequencyInterval(e.frequency?.description);if(e.conditionType?.description==="Maintenance"){for(let t=0;t<(e.numberOfInstallments||1);t++){const n=e.dueInMonth+t*s;const i=new Date(d.getTime()+n*30*24*60*60*1e3);u.push({conditionType:e.conditionType.description,dueDate:i.toISOString().split("T")[0],amount:0,maintenance:o/Math.max(1,e.numberOfInstallments)})}}else{for(let t=0;t<(e.numberOfInstallments||1);t++){const n=e.dueInMonth+t*s;const i=new Date(d.getTime()+n*30*24*60*60*1e3);u.push({conditionType:e.conditionType?.description||"Installment",dueDate:i.toISOString().split("T")[0],amount:o/Math.max(1,e.numberOfInstallments),maintenance:0})}}});this.getView().setModel(new i(u),"simulationOutput");const p=this.getView().byId("simulationTable");if(p&&p.getBinding("items")){p.getBinding("items").refresh()}const g=this._generateId();this.getView().byId("simulationIdInput").setValue(g);e.setProperty("/simulationId",g)}catch(e){n.error("Simulation failed: "+(e.message||e))}},_getFrequencyInterval:function(e){if(!e)return 12;switch(e.toLowerCase()){case"monthly":return 1;case"quarterly":return 3;case"semi-annual":return 6;case"annual":return 12;default:return 12}},onSaveSimulation:async function(){const e=this.getView().byId("simulationIdInput").getValue();const i=this.getView().getModel("local");const o=i?i.getProperty("/unitId"):null;const s=this.getView().byId("projectIdInput").getValue();const a=this.getView().byId("paymentPlanIdInput").getValue();const r=parseInt(this.getView().byId("pricePlanInput").getValue());const l=this.getView().byId("leadIdInput").getValue();const c=Number(i?i.getProperty("/finalPrice"):NaN);const u="currentUser";const d=this.getView().getModel("simulationOutput").getData();try{const n={simulationId:e,unitId:o,projectId:s,pricePlanYears:r,leadId:l,finalPrice:c,userId:u,schedule:(d||[]).map(e=>({conditionType:e.conditionType,dueDate:e.dueDate,amount:e.amount,maintenance:e.maintenance}))};const i=await fetch("./odata/v4/real-estate/PaymentPlanSimulations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok)throw new Error("Failed to save simulation");t.show("Simulation saved successfully!")}catch(e){n.error("Error: "+(e.message||e))}},_generateId:function(){this._idCounter+=1;localStorage.setItem("simulationIdCounter",this._idCounter);const e=("00000"+this._idCounter).slice(-5);return"PPS"+e}})});
sap.ui.predefine("dboperations/controller/PaymentPlans.controller", ["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,n,o,a,s){"use strict";return e.extend("dboperations.controller.PaymentPlans",{onInit:function(){this.oModel=this.getView().getModel();this._loadPlans();this._loadDropdownData();this._idCounter=parseInt(localStorage.getItem("simulationIdCounter"))||0},_loadDropdownData:async function(){try{const e=["./odata/v4/real-estate/ConditionTypes","./odata/v4/real-estate/BasePrices","./odata/v4/real-estate/CalculationMethods","./odata/v4/real-estate/Frequencies","./odata/v4/real-estate/Projects"];const t=await Promise.allSettled(e.map(async e=>{try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP ${t.status} for ${e}`);return await t.json()}catch(t){console.error(`❌ Failed to fetch ${e}:`,t);return{value:[]}}}));const[n,a,s,r,i]=t.map(e=>e.status==="fulfilled"?e.value:{value:[]});const l=new o({conditionTypes:(n.value||[]).map(e=>({code:e.code||e.conditionTypeId||e.id,description:e.description||e.conditionTypeDescription})),basePrices:(a.value||[]).map(e=>({code:e.code||e.basePriceId||e.id,description:e.description||e.basePriceDescription})),calculationMethods:(s.value||[]).map(e=>({code:e.code||e.calculationMethodId||e.id,description:e.description||e.calculationMethodDescription})),frequencies:(r.value||[]).map(e=>({code:e.code||e.frequencyId||e.id,description:e.description||e.frequencyDescription})),projects:(i.value||[]).map(e=>({code:e.projectId,description:e.projectDescription})),planStatuses:[{code:"A",description:"Approved"},{code:"I",description:"Initial"}]});this.getView().setModel(l,"dropdowns");console.log("✅ Dropdown data loaded",l.getData());console.log("RAW ConditionTypes:",n);console.log("RAW BasePrices:",a);console.log("RAW CalcMethods:",s);console.log("RAW Frequencies:",r);console.log("RAW Projects:",i)}catch(e){console.error("❌ Overall error loading dropdown data:",e);n.error("Failed to load dropdown data. Check console for details.")}},_loadPlans:function(){fetch("./odata/v4/real-estate/PaymentPlans?$expand=schedule($expand=conditionType,basePrice,calculationMethod,frequency),assignedProjects($expand=project)").then(e=>e.json()).then(e=>{this.getView().setModel(new o(e.value||[]),"plans")}).catch(e=>console.error("Failed to load plans:",e))},onShowPlanDetails:async function(e){const t=e.getSource().getBindingContext("plans");if(!t)return;const a=t.getProperty("paymentPlanId");try{const e=await fetch(`./odata/v4/real-estate/PaymentPlans(paymentPlanId='${a}')?$expand=schedule($expand=conditionType,basePrice,calculationMethod,frequency),assignedProjects($expand=project)`);if(!e.ok)throw new Error("Failed to load plan details");const t=await e.json();const n=t.value?t.value[0]:t;const s=new o(n);if(!this._oDetailsDialog){this._oDetailsDialog=new sap.m.Dialog({title:"Payment Plan Details",contentWidth:"90%",resizable:true,draggable:true,content:[new sap.m.IconTabBar({items:[new sap.m.IconTabFilter({text:"General Info",content:[new sap.ui.layout.form.SimpleForm({editable:false,content:[new sap.m.Label({text:"Payment Plan ID"}),new sap.m.Text({text:"{/paymentPlanId}"}),new sap.m.Label({text:"Description"}),new sap.m.Text({text:"{/description}"}),new sap.m.Label({text:"Company Code"}),new sap.m.Text({text:"{/companyCodeId}"}),new sap.m.Label({text:"Years"}),new sap.m.Text({text:"{/planYears}"}),new sap.m.Label({text:"Valid From"}),new sap.m.Text({text:"{/validFrom}"}),new sap.m.Label({text:"Valid To"}),new sap.m.Text({text:"{/validTo}"}),new sap.m.Label({text:"Status"}),new sap.m.Text({text:"{/planStatus}"})]})]}),new sap.m.IconTabFilter({text:"Schedules",content:[new sap.m.Table({columns:[new sap.m.Column({header:new sap.m.Label({text:"Condition Type"})}),new sap.m.Column({header:new sap.m.Label({text:"Base Price"})}),new sap.m.Column({header:new sap.m.Label({text:"Frequency"})}),new sap.m.Column({header:new sap.m.Label({text:"%"})}),new sap.m.Column({header:new sap.m.Label({text:"Due (Months)"})}),new sap.m.Column({header:new sap.m.Label({text:"Installments"})}),new sap.m.Column({header:new sap.m.Label({text:"Years"})})],items:{path:"/schedule",template:new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{conditionType/description}"}),new sap.m.Text({text:"{basePrice/description}"}),new sap.m.Text({text:"{frequency/description}"}),new sap.m.Text({text:"{percentage}"}),new sap.m.Text({text:"{dueInMonth}"}),new sap.m.Text({text:"{numberOfInstallments}"}),new sap.m.Text({text:"{numberOfYears}"})]})}})]}),new sap.m.IconTabFilter({text:"Assigned Projects",content:[new sap.m.Table({columns:[new sap.m.Column({header:new sap.m.Label({text:"Project ID"})}),new sap.m.Column({header:new sap.m.Label({text:"Description"})})],items:{path:"/assignedProjects",template:new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{project/projectId}"}),new sap.m.Text({text:"{project/projectDescription}"})]})}})]})]})],endButton:new sap.m.Button({text:"Close",press:function(){this._oDetailsDialog.close()}.bind(this)})});this.getView().addDependent(this._oDetailsDialog)}this._oDetailsDialog.setModel(s);this._oDetailsDialog.open()}catch(e){n.error("Error: "+e.message)}},onAddPlan:function(){this._openPlanDialog({})},onEditPlan:async function(e){const t=e.getSource().getBindingContext("plans");const o=t.getProperty("paymentPlanId");try{const e=await fetch(`./odata/v4/real-estate/PaymentPlans(paymentPlanId='${o}')?$expand=schedule($expand=conditionType,basePrice,calculationMethod,frequency),assignedProjects($expand=project)`);if(!e.ok)throw new Error("Failed to load payment plan for edit");const t=await e.json();const n=t.value?t.value[0]:t;this._openPlanDialog(n)}catch(e){n.error("Error: "+e.message)}},_openPlanDialog:function(e){if(!this._oAddDialog){this._oAddDialog=this.getView().byId("planDialog")}const t=(e.schedule||[]).map(e=>({conditionType:e.conditionType?{code:e.conditionType.code,description:e.conditionType.description}:{},basePrice:e.basePrice?{code:e.basePrice.code,description:e.basePrice.description}:{},calculationMethod:e.calculationMethod?{code:e.calculationMethod.code,description:e.calculationMethod.description}:{},frequency:e.frequency?{code:e.frequency.code,description:e.frequency.description}:{},percentage:e.percentage||0,dueInMonth:e.dueInMonth||0,numberOfInstallments:e.numberOfInstallments||0,numberOfYears:e.numberOfYears||0}));const n=new o({paymentPlanId:e.paymentPlanId||"",description:e.description||"",companyCodeId:e.companyCodeId||"",planYears:e.planYears||0,validFrom:e.validFrom||"",validTo:e.validTo||"",planStatus:e.planStatus||"",schedules:t,projects:(e.assignedProjects||[]).map(e=>({projectId:e.project?.projectId||"",projectDescription:e.project?.projectDescription||""}))});this._oAddDialog.setModel(n,"local");this._oAddDialog.open()},onSavePlan:async function(){const e=this._oAddDialog;const o=e.getModel("local");const a=o.getData();if(!a.validFrom){n.error("Valid From is required.");return}if(!a.validTo){n.error("Valid To is required.");return}const s=new Date(a.validFrom);const r=new Date(a.validTo);if(isNaN(s.getTime())||isNaN(r.getTime())){n.error("Valid From and Valid To must be valid dates.");return}if(r<s){n.error("Valid To cannot be earlier than Valid From.");return}try{const o=(a.schedules||[]).map(e=>({conditionType_code:e.conditionType?.code||"",basePrice_code:e.basePrice?.code||"",calculationMethod_code:e.calculationMethod?.code||"",frequency_code:e.frequency?.code||"",percentage:e.percentage||0,dueInMonth:e.dueInMonth||0,numberOfInstallments:e.numberOfInstallments||0,numberOfYears:e.numberOfYears||0}));const s=(a.projects||[]).map(e=>({project_projectId:e.projectId||""}));const r={paymentPlanId:a.paymentPlanId||this._generateId(),description:a.description,companyCodeId:a.companyCodeId,planYears:a.planYears,validFrom:a.validFrom,validTo:a.validTo,planStatus:a.planStatus,schedule:o,assignedProjects:s};const i=a.paymentPlanId?"PUT":"POST";const l=a.paymentPlanId?`./odata/v4/real-estate/PaymentPlans(paymentPlanId='${a.paymentPlanId}')`:`./odata/v4/real-estate/PaymentPlans`;console.log("Schedules payload:",o);console.log("Assigned projects payload:",s);const c=parseInt(a.planYears)||0;const d=(a.schedules||[]).filter(e=>!e.conditionType?.description?.toLowerCase().includes("maintenance")).reduce((e,t)=>e+(parseFloat(t.percentage)||0),0);if(d!==100){n.error(`Total percentage for installments and downpayment must be 100. Current: ${d}`);return}const p=(a.schedules||[]).reduce((e,t)=>e+(parseInt(t.numberOfYears)||0),0);if(p!==c){n.error(`Total years in schedules must equal plan years (${c}). Current: ${p}`);return}const m=await fetch(l,{method:i,headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!m.ok)throw new Error("Failed to save payment plan");t.show("Payment plan saved successfully!");e.close();this._loadPlans()}catch(e){n.error("Error: "+e.message)}},onCancelPlan:function(){this._oAddDialog.close()},onAddScheduleRow:function(){const e=this._oAddDialog.getModel("local");const t=e.getProperty("/schedules");t.push({});e.refresh()},onDeleteScheduleRow:function(){const e=this._oAddDialog.getModel("local");const t=e.getProperty("/schedules");t.pop();e.refresh()},onAddProjectRow:function(){const e=this._oAddDialog.getModel("local");const t=e.getProperty("/projects");t.push({});e.refresh()},onDeleteProjectRow:function(){const e=this._oAddDialog.getModel("local");const t=e.getProperty("/projects");t.pop();e.refresh()},_generateId:function(){this._idCounter+=1;localStorage.setItem("simulationIdCounter",this._idCounter);const e=("00000"+this._idCounter).slice(-5);return"PP"+e},onDeletePlan:function(e){const o=e.getSource().getBindingContext("plans");const a=o.getObject();n.confirm(`Delete plan ${a.paymentPlanId}?`,{onClose:async e=>{if(e==="OK"){try{const e=await fetch(`./odata/v4/real-estate/PaymentPlans('${a.paymentPlanId}')`,{method:"DELETE"});if(!e.ok)throw new Error("Delete failed");t.show("Deleted successfully");this._loadPlans()}catch(e){n.error(e.message)}}}})},_onValueHelpConfirm:function(e,t,n,o){const a=e.getParameter("selectedItem");if(a){const e=a.getBindingContext("dropdowns");if(e){const a=e.getObject();o({code:a[t],description:a[n]})}}},onOpenPlanStatusVHD:function(e){var t=new sap.m.SelectDialog({title:"Select Plan Status",items:{path:"dropdowns>/planStatuses",template:new sap.m.StandardListItem({title:"{dropdowns>description}",description:"{dropdowns>code}",type:"Active"})},liveChange:function(e){var t=e.getParameter("value");e.getParameter("itemsBinding").filter([new sap.ui.model.Filter("description",sap.ui.model.FilterOperator.Contains,t)])},confirm:function(e){var t=e.getParameter("selectedItem");if(t){var n=t.getBindingContext("dropdowns").getObject();var o=this.getView().byId("planDialog").getModel("local");o.setProperty("/planStatus",n.code)}}.bind(this)});t.setModel(this.getView().getModel("dropdowns"),"dropdowns");t.open()},onOpenConditionTypeVHD:function(e){var t=e.getSource();var n=t.getBindingContext("local");this._openValueHelpDialog("Condition Type","dropdowns>/conditionTypes",n,"conditionType")},onOpenBasePriceVHD:function(e){var t=e.getSource();var n=t.getBindingContext("local");this._openValueHelpDialog("Base Price","dropdowns>/basePrices",n,"basePrice")},onOpenFrequencyVHD:function(e){var t=e.getSource();var n=t.getBindingContext("local");var o=new sap.m.SelectDialog({title:"Select Frequency",items:{path:"dropdowns>/frequencies",template:new sap.m.StandardListItem({title:"{dropdowns>description}",description:"{dropdowns>code}",type:"Active"})},liveChange:function(e){var t=e.getParameter("value");e.getParameter("itemsBinding").filter([new sap.ui.model.Filter("description",sap.ui.model.FilterOperator.Contains,t)])},confirm:function(e){var t=e.getParameter("selectedItem");if(t){var o=t.getBindingContext("dropdowns");var a=o.getObject();n.setProperty("frequency",a);var s=parseInt(n.getProperty("numberOfYears"))||0;if(s>0){this._calculateInstallments(n)}}}.bind(this)});o.setModel(this.getView().getModel("dropdowns"),"dropdowns");o.open()},onOpenProjectVHD:function(e){var t=e.getSource();var n=t.getBindingContext("local");var o=new sap.m.SelectDialog({title:"Select Project",items:{path:"dropdowns>/projects",template:new sap.m.StandardListItem({title:"{dropdowns>description}",description:"{dropdowns>code}",type:"Active"})},liveChange:function(e){var t=e.getParameter("value");e.getParameter("itemsBinding").filter([new sap.ui.model.Filter("description",sap.ui.model.FilterOperator.Contains,t)])},confirm:function(e){var t=e.getParameter("selectedItem");if(t){var o=t.getBindingContext("dropdowns").getObject();n.setProperty("projectId",o.code);n.setProperty("projectDescription",o.description)}}});o.setModel(this.getView().getModel("dropdowns"),"dropdowns");o.open()},_openValueHelpDialog:function(e,t,n,o){var a=this;var s=new sap.m.SelectDialog({title:e,items:{path:t,template:new sap.m.StandardListItem({title:"{dropdowns>description}",description:"{dropdowns>code}",type:"Active"})},liveChange:function(e){var t=e.getParameter("value");var n=e.getParameter("itemsBinding");n.filter([new sap.ui.model.Filter("description",sap.ui.model.FilterOperator.Contains,t)])},confirm:function(e){var t=e.getParameter("selectedItem");if(t){var a=t.getBindingContext("dropdowns");var s=a.getObject();n.setProperty(o,s)}}});s.setModel(this.getView().getModel("dropdowns"),"dropdowns");s.open()},onFrequencyChange:function(e){var t=e.getSource().getBindingContext("local");var n=parseInt(t.getProperty("numberOfYears"))||0;if(n>0){this._calculateInstallments(t)}},onYearsChange:function(e){var t=e.getSource().getBindingContext("local");var n=t.getProperty("frequency/description")||"";if(n){this._calculateInstallments(t)}},_calculateInstallments:function(e){var t=e.getProperty("frequency/description")||"";var n=parseInt(e.getProperty("numberOfYears"))||0;var o=0;switch(t.toLowerCase()){case"one time":o=1;break;case"monthly":o=12*n;break;case"quarterly":o=4*n;break;case"semi-annual":o=2*n;break;case"annual":o=1*n;break;default:o=0}e.setProperty("numberOfInstallments",o)}})});
sap.ui.predefine("dboperations/controller/Projects.controller", ["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/Dialog","sap/m/Input","sap/m/Button","sap/m/Label","sap/m/VBox","sap/ui/model/json/JSONModel"],function(e,t,a,o,n,i,r,s){"use strict";var d="";return e.extend("dboperations.controller.Projects",{onInit:function(){this.getOwnerComponent().getRouter().getRoute("Projects").attachPatternMatched(this._onRouteMatched,this);var e=new sap.ui.model.json.JSONModel({Projects:[]});this.getView().setModel(e,"view");var e=new s;fetch("/odata/v4/real-estate/Projects").then(e=>e.json()).then(t=>{e.setData({Projects:t.value});this.getView().byId("projectsTable").setModel(e)}).catch(e=>{console.error("Error fetching projects",e)})},_onRouteMatched:function(){this._loadProjects()},_loadProjects:function(){var e=new sap.ui.model.json.JSONModel;fetch("./odata/v4/real-estate/Projects",{method:"GET",headers:{"X-CSRF-Token":"Fetch"}}).then(e=>{d=e.headers.get("X-CSRF-Token");return e.json()}).then(t=>{e.setData({Projects:t.value});this.getView().byId("projectsTable").setModel(e)}).catch(e=>{console.error("Error fetching projects",e)})},onNavigateToAddProject:function(){if(!this._oAddDialog){var e=new sap.ui.model.json.JSONModel({projectId:"",projectDescription:"",companyCodeId:"",companyCodeDescription:"",validFrom:"",validTo:"",location:"",businessArea:"",profitCenter:"",functionalArea:"",supplementaryText:""});this._oAddDialog=new sap.m.Dialog({title:"Add New Project",content:new sap.ui.layout.form.SimpleForm({editable:true,content:[new sap.m.Label({text:"Project ID",required:true}),new sap.m.Input("projectIdInput",{value:"{/projectId}",tooltip:"Must be 8 characters or fewer"}),new sap.m.Label({text:"Description",required:true}),new sap.m.Input("projectDescInput",{value:"{/projectDescription}",tooltip:"Up to 60 characters"}),new sap.m.Label({text:"Company Code",required:true}),new sap.m.Input("companyCodeInput",{value:"{/companyCodeId}",tooltip:"Must be 4 characters"}),new sap.m.Label({text:"Company Code Description",required:true}),new sap.m.Input("companyCodeDescInput",{value:"{/companyCodeDescription}",tooltip:"Up to 60 characters"}),new sap.m.Label({text:"Valid From",required:true}),new sap.m.DatePicker("validFromInput",{value:"{/validFrom}",displayFormat:"long",valueFormat:"yyyy-MM-dd",placeholder:"Select a date"}),new sap.m.Label({text:"Valid To",required:true}),new sap.m.DatePicker("validToInput",{value:"{/validTo}",displayFormat:"long",valueFormat:"yyyy-MM-dd",placeholder:"Select a date"}),new sap.m.Label({text:"Location",required:true}),new sap.m.Input("locationInput",{value:"{/location}",tooltip:"Up to 40 characters"}),new sap.m.Label({text:"Business Area",required:true}),new sap.m.Input("businessAreaInput",{value:"{/businessArea}"}),new sap.m.Label({text:"Profit Center",required:true}),new sap.m.Input("profitCenterInput",{value:"{/profitCenter}"}),new sap.m.Label({text:"Functional Area",required:true}),new sap.m.Input("functionalAreaInput",{value:"{/functionalArea}"}),new sap.m.Label({text:"Supplementary Text",required:true}),new sap.m.Input("supplementaryTextInput",{value:"{/supplementaryText}"})]}),beginButton:new sap.m.Button({text:"Save",type:"Emphasized",press:function(){var e=this._oAddDialog.getModel().getData();var t=[{id:"projectIdInput",name:"Project ID"},{id:"projectDescInput",name:"Description"},{id:"companyCodeInput",name:"Company Code"},{id:"companyCodeDescInput",name:"Company Code Description"},{id:"validFromInput",name:"Valid From"},{id:"validToInput",name:"Valid To"},{id:"locationInput",name:"Location"},{id:"businessAreaInput",name:"Business Area"},{id:"profitCenterInput",name:"Profit Center"},{id:"functionalAreaInput",name:"Functional Area"},{id:"supplementaryTextInput",name:"Supplementary Text"}];var a=true;t.forEach(function(e){var t=sap.ui.getCore().byId(e.id);if(!t.getValue()){t.setValueState("Error");t.setValueStateText(e.name+" is required");a=false}else{t.setValueState("None")}});if(!a){sap.m.MessageBox.warning("Please fill all required fields before saving.");return}var o=sap.ui.getCore().byId("validFromInput").getDateValue();var n=sap.ui.getCore().byId("validToInput").getDateValue();if(o&&n&&n<o){sap.ui.getCore().byId("validToInput").setValueState("Error");sap.ui.getCore().byId("validToInput").setValueStateText("'Valid To' must be later than 'Valid From'");sap.m.MessageBox.error("'Valid To' date must be later than 'Valid From' date.");return}else{sap.ui.getCore().byId("validToInput").setValueState("None")}fetch("./odata/v4/real-estate/Projects",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":d},body:JSON.stringify(e)}).then(e=>{if(!e.ok){throw new Error("Failed to create project")}return e.text()}).then(()=>{sap.m.MessageToast.show("Project created");this._resetAddDialogFields();this._oAddDialog.close();this._loadProjects()}).catch(e=>console.error("Error during POST:",e))}.bind(this)}),endButton:new sap.m.Button({text:"Cancel",press:function(){this._resetAddDialogFields();this._oAddDialog.close();this._oAddDialog.destroy();this._oAddDialog=null}.bind(this)})});this._oAddDialog.setModel(e);this.getView().addDependent(this._oAddDialog)}this._resetAddDialogFields();this._oAddDialog.open()},_resetAddDialogFields:function(){var e=this._oAddDialog.getModel();e.setData({projectId:"",projectDescription:"",companyCodeId:"",companyCodeDescription:"",validFrom:"",validTo:"",location:"",businessArea:"",profitCenter:"",functionalArea:"",supplementaryText:""});["projectIdInput","projectDescInput","companyCodeInput","companyCodeDescInput","validFromInput","validToInput","locationInput"].forEach(function(e){var t=sap.ui.getCore().byId(e);if(t)t.setValueState("None")})},onDetails:function(e){var t=e.getSource().getBindingContext();if(!t){return}var a=t.getObject();var o=new sap.ui.model.json.JSONModel({ProjectId:a.projectId,Description:a.projectDescription,CompanyCode:a.companyCodeId,companyCodeDescription:a.companyCodeDescription,validFrom:a.validFrom,validTo:a.validTo,location:a.location,businessArea:a.businessArea,profitCenter:a.profitCenter,functionalArea:a.functionalArea,supplementaryText:a.supplementaryText});if(!this._oDetailsDialog){this._oDetailsDialog=new sap.m.Dialog({title:"Project Details",contentWidth:"100%",resizable:true,draggable:true,content:[new sap.m.IconTabBar({expandable:true,items:[new sap.m.IconTabFilter({text:"General Data",icon:"sap-icon://project-definition",content:[new sap.ui.layout.form.SimpleForm({editable:false,layout:"ResponsiveGridLayout",labelSpanL:3,columnsL:2,content:[new sap.m.Label({text:"Company Code ID"}),new sap.m.Text({text:"{/CompanyCode}"}),new sap.m.Label({text:"Company Code Description"}),new sap.m.Text({text:"{/companyCodeDescription}"}),new sap.m.Label({text:"Project ID"}),new sap.m.Text({text:"{/ProjectId}"}),new sap.m.Label({text:"Project Description"}),new sap.m.Text({text:"{/Description}"}),new sap.m.Label({text:"Valid From"}),new sap.m.Text({text:"{/validFrom}"}),new sap.m.Label({text:"Valid To"}),new sap.m.Text({text:"{/validTo}"}),new sap.m.Label({text:"Location"}),new sap.m.Text({text:"{/location}"})]})]}),new sap.m.IconTabFilter({text:"Posting Parameters",icon:"sap-icon://post",content:[new sap.ui.layout.form.SimpleForm({editable:false,layout:"ResponsiveGridLayout",labelSpanL:3,columnsL:2,content:[new sap.m.Label({text:"Business Area"}),new sap.m.Text({text:"{/businessArea}"}),new sap.m.Label({text:"Profit Center"}),new sap.m.Text({text:"{/profitCenter}"}),new sap.m.Label({text:"Functional Area"}),new sap.m.Text({text:"{/functionalArea}"})]})]}),new sap.m.IconTabFilter({text:"Supplementary Text",icon:"sap-icon://document-text",content:[new sap.ui.layout.form.SimpleForm({editable:false,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:"Supplementary Text"}),new sap.m.TextArea({value:"{/supplementaryText}",width:"100%",rows:6,editable:false,growing:true,growingMaxLines:10})]})]})]})],endButton:new sap.m.Button({text:"Close",type:"Emphasized",press:function(){this._oDetailsDialog.close();this._oDetailsDialog.destroy();this._oDetailsDialog=null}.bind(this)})});this.getView().addDependent(this._oDetailsDialog)}this._oDetailsDialog.setModel(o);this._oDetailsDialog.open()},onDelete:function(e){var a=e.getSource().getBindingContext();if(a){var o=a.getPath();var n=this.getView().byId("projectsTable").getModel();var i=n.getProperty(o);if(!i){sap.m.MessageBox.error("Could not find model data for deletion.");return}t.confirm("Are you sure you want to delete "+i.projectId+"?",{title:"Confirm Deletion",onClose:function(e){if(e===t.Action.OK){fetch(`./odata/v4/real-estate/Projects(projectId='${i.projectId}')`,{method:"DELETE"}).then(e=>{if(!e.ok){throw new Error("Failed to delete: "+e.statusText)}var t=n.getProperty("/Projects");var a=t.findIndex(e=>e.projectId===i.projectId);if(a>-1){t.splice(a,1);n.setProperty("/Projects",t)}sap.m.MessageToast.show("Project deleted successfully!")}).catch(e=>{console.error("Error deleting Project:",e);sap.m.MessageBox.error("Error: "+e.message)})}}})}},onEditProject:function(e){var t=e.getSource().getBindingContext();if(!t)return;var a=t.getObject();var o=new sap.ui.model.json.JSONModel(Object.assign({},a));if(!this._oEditDialog){this._oEditDialog=new sap.m.Dialog({title:"Edit Project",content:new sap.ui.layout.form.SimpleForm({editable:true,content:[new sap.m.Label({text:"Project ID"}),new sap.m.Input({value:"{/projectId}",editable:false}),new sap.m.Label({text:"Description",required:true}),new sap.m.Input("editProjectDescInput",{value:"{/projectDescription}"}),new sap.m.Label({text:"Company Code",required:true}),new sap.m.Input("editCompanyCodeInput",{value:"{/companyCodeId}"}),new sap.m.Label({text:"Company Code Description",required:true}),new sap.m.Input("editCompanyCodeDescInput",{value:"{/companyCodeDescription}"}),new sap.m.Label({text:"Valid From",required:true}),new sap.m.DatePicker("editValidFromInput",{value:"{/validFrom}",displayFormat:"long",valueFormat:"yyyy-MM-dd",placeholder:"Select a date"}),new sap.m.Label({text:"Valid To",required:true}),new sap.m.DatePicker("editValidToInput",{value:"{/validTo}",displayFormat:"long",valueFormat:"yyyy-MM-dd",placeholder:"Select a date"}),new sap.m.Label({text:"Location",required:true}),new sap.m.Input("editLocationInput",{value:"{/location}"}),new sap.m.Label({text:"Business Area",required:true}),new sap.m.Input("editBusinessAreaInput",{value:"{/businessArea}"}),new sap.m.Label({text:"Profit Center",required:true}),new sap.m.Input("editProfitCenterInput",{value:"{/profitCenter}"}),new sap.m.Label({text:"Functional Area",required:true}),new sap.m.Input("editFunctionalAreaInput",{value:"{/functionalArea}"}),new sap.m.Label({text:"Supplementary Text",required:true}),new sap.m.Input("editSupplementaryTextInput",{value:"{/supplementaryText}"})]}),beginButton:new sap.m.Button({text:"Save",type:"Emphasized",press:function(){var e=this._oEditDialog.getModel().getData();var t=[{id:"editProjectDescInput",name:"Description"},{id:"editCompanyCodeInput",name:"Company Code"},{id:"editCompanyCodeDescInput",name:"Company Code Description"},{id:"editValidFromInput",name:"Valid From"},{id:"editValidToInput",name:"Valid To"},{id:"editLocationInput",name:"Location"},{id:"editBusinessAreaInput",name:"Business Area"},{id:"editProfitCenterInput",name:"Profit Center"},{id:"editFunctionalAreaInput",name:"Functional Area"},{id:"editSupplementaryTextInput",name:"Supplementary Text"}];var a=true;t.forEach(function(e){var t=sap.ui.getCore().byId(e.id);if(!t.getValue()){t.setValueState("Error");t.setValueStateText(e.name+" is required");a=false}else{t.setValueState("None")}});if(!a){sap.m.MessageBox.warning("Please fill all required fields before saving.");return}var o=sap.ui.getCore().byId("editValidFromInput").getDateValue();var n=sap.ui.getCore().byId("editValidToInput").getDateValue();if(o&&n&&n<o){sap.ui.getCore().byId("editValidToInput").setValueState("Error");sap.ui.getCore().byId("editValidToInput").setValueStateText("'Valid To' must be later than 'Valid From'");sap.m.MessageBox.error("'Valid To' date must be later than 'Valid From' date.");return}else{sap.ui.getCore().byId("editValidToInput").setValueState("None")}fetch(`./odata/v4/real-estate/Projects(projectId='${e.projectId}')`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>{if(!e.ok)throw new Error("Update failed");return e.json()}).then(()=>{sap.m.MessageToast.show("Project updated successfully!");this._loadProjects();this._oEditDialog.close();this._oEditDialog.destroy();this._oEditDialog=null}).catch(e=>sap.m.MessageBox.error("Error: "+e.message))}.bind(this)}),endButton:new sap.m.Button({text:"Cancel",press:function(){this._oEditDialog.close();this._oEditDialog.destroy();this._oEditDialog=null}.bind(this)})});this.getView().addDependent(this._oEditDialog)}this._oEditDialog.setModel(o);this._oEditDialog.open()},onAddBuilding:function(e){var t=e.getSource().getBindingContext();if(!t){sap.m.MessageToast.show("No project selected.");return}var a=t.getObject();var o=new sap.ui.model.json.JSONModel({buildingId:"",buildingDescription:"",buildingOldCode:"",location:a.location||"",validFrom:"",validTo:"",companyCodeId:a.companyCodeId,companyCodeDescription:a.companyCodeDescription,projectId:a.projectId,projectDescription:a.projectDescription,businessArea:a.businessArea||"",profitCenter:a.profitCenter||"",functionalArea:a.functionalArea||""});if(!this._oAddBuildingDialog){this._oAddBuildingDialog=new sap.m.Dialog({title:"Add Building for "+a.projectDescription,contentWidth:"600px",content:new sap.ui.layout.form.SimpleForm({editable:true,content:[new sap.m.Label({text:"Building ID",required:true}),new sap.m.Input("buildingIdInput",{value:"{/buildingId}"}),new sap.m.Label({text:"Building Description",required:true}),new sap.m.Input("buildingDescInput",{value:"{/buildingDescription}"}),new sap.m.Label({text:"Old Building Code"}),new sap.m.Input({value:"{/buildingOldCode}"}),new sap.m.Label({text:"Location",required:true}),new sap.m.Input("buildingLocationInput",{value:"{/location}"}),new sap.m.Label({text:"Valid From",required:true}),new sap.m.DatePicker("buildingValidFromInput",{value:"{/validFrom}",displayFormat:"long",valueFormat:"yyyy-MM-dd",placeholder:"Select date",showClearIcon:true}),new sap.m.Label({text:"Valid To",required:true}),new sap.m.DatePicker("buildingValidToInput",{value:"{/validTo}",displayFormat:"long",valueFormat:"yyyy-MM-dd",placeholder:"Select date",showClearIcon:true}),new sap.m.Label({text:"Company Code ID"}),new sap.m.Text({text:"{/companyCodeId}"}),new sap.m.Label({text:"Company Code Description"}),new sap.m.Text({text:"{/companyCodeDescription}"}),new sap.m.Label({text:"Project ID"}),new sap.m.Text({text:"{/projectId}"}),new sap.m.Label({text:"Project Description"}),new sap.m.Text({text:"{/projectDescription}"}),new sap.m.Label({text:"Business Area",required:true}),new sap.m.Input("businessAreaInput",{value:"{/businessArea}"}),new sap.m.Label({text:"Profit Center",required:true}),new sap.m.Input("profitCenterInput",{value:"{/profitCenter}"}),new sap.m.Label({text:"Functional Area",required:true}),new sap.m.Input("functionalAreaInput",{value:"{/functionalArea}"})]}),beginButton:new sap.m.Button({text:"Save",type:"Emphasized",press:function(){var e=this._oAddBuildingDialog.getModel().getData();var t=[{id:"buildingIdInput",name:"Building ID"},{id:"buildingDescInput",name:"Building Description"},{id:"buildingLocationInput",name:"Location"},{id:"buildingValidFromInput",name:"Valid From"},{id:"buildingValidToInput",name:"Valid To"},{id:"businessAreaInput",name:"Business Area"},{id:"profitCenterInput",name:"Profit Center"},{id:"functionalAreaInput",name:"Functional Area"}];var o=true;t.forEach(function(e){var t=sap.ui.getCore().byId(e.id);if(!t.getValue()){t.setValueState("Error");t.setValueStateText(e.name+" is required");o=false}else{t.setValueState("None")}});if(!o){sap.m.MessageBox.warning("Please fill all required fields before saving.");return}var n=new Date(a.validFrom);var i=new Date(a.validTo);var r=sap.ui.getCore().byId("buildingValidFromInput").getDateValue();var s=sap.ui.getCore().byId("buildingValidToInput").getDateValue();if(r>s){sap.ui.getCore().byId("buildingValidToInput").setValueState("Error");sap.ui.getCore().byId("buildingValidToInput").setValueStateText("'Valid To' must be later than 'Valid From'");sap.m.MessageBox.error("Building 'Valid From' cannot be after 'Valid To'.");return}if(r<n){sap.m.MessageBox.error("Building 'Valid From' must be on or after the Project 'Valid From' ("+a.validFrom+").");return}if(s>i){sap.m.MessageBox.error("Building 'Valid To' must be on or before the Project 'Valid To' ("+a.validTo+").");return}fetch("./odata/v4/real-estate/Buildings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>{if(!e.ok)throw new Error("Failed to create building");return e.json()}).then(()=>{sap.m.MessageToast.show("Building added successfully!");this._oAddBuildingDialog.close();this._oAddBuildingDialog.destroy();this._oAddBuildingDialog=null}).catch(e=>{sap.m.MessageBox.error("Error: "+e.message)})}.bind(this)}),endButton:new sap.m.Button({text:"Cancel",press:function(){this._oAddBuildingDialog.close();this._oAddBuildingDialog.destroy();this._oAddBuildingDialog=null}.bind(this)})});this.getView().addDependent(this._oAddBuildingDialog)}this._oAddBuildingDialog.setModel(o);this._oAddBuildingDialog.open()}})});
sap.ui.predefine("dboperations/controller/Reservations.controller", ["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel"],function(e,t,n,a){"use strict";return e.extend("dboperations.controller.Reservations",{onInit:function(){this.oModel=this.getView().getModel();this._loadReservations()},_loadReservations:function(){fetch("./odata/v4/real-estate/Reservations?$expand=payments,partners,conditions,project,building,unit").then(e=>e.json()).then(e=>{this.getView().setModel(new a(e.value||[]),"reservations")}).catch(e=>console.error("Failed to load reservations:",e))},onShowReservationDetails:async function(e){const t=e.getSource().getBindingContext("reservations");if(!t)return;const s=t.getProperty("reservationId");try{const e=await fetch(`./odata/v4/real-estate/Reservations(reservationId='${s}')?$expand=payments,partners,conditions,project,building,unit`);if(!e.ok)throw new Error("Failed to load reservation details");const t=await e.json();const n=t.value?t.value[0]:t;const o={...n,projectName:n.project?.name||"",projectId:n.project?.projectId||"",buildingName:n.building?.name||"",buildingId:n.building?.buildingId||"",unitNumber:n.unit?.unitNumber||"",unitId:n.unit?.unitId||"",payments:n.payments||[],partners:n.partners||[],conditions:n.conditions||[]};const r=new a(o);if(!this._oDetailsDialog){this._oDetailsDialog=new sap.m.Dialog({title:"Reservation Details",contentWidth:"90%",resizable:true,draggable:true,content:[new sap.m.IconTabBar({items:[new sap.m.IconTabFilter({text:"General Info",content:[new sap.ui.layout.form.SimpleForm({editable:false,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:"Reservation ID"}),new sap.m.Text({text:"{/reservationId}"}),new sap.m.Label({text:"Company Code"}),new sap.m.Text({text:"{/companyCodeId}"}),new sap.m.Label({text:"Old Reservation ID"}),new sap.m.Text({text:"{/oldReservationId}"}),new sap.m.Label({text:"EOI ID"}),new sap.m.Text({text:"{/eoiId}"}),new sap.m.Label({text:"Sales Type"}),new sap.m.Text({text:"{/salesType}"}),new sap.m.Label({text:"Description"}),new sap.m.Text({text:"{/description}"}),new sap.m.Label({text:"Valid From"}),new sap.m.Text({text:"{/validFrom}"}),new sap.m.Label({text:"Status"}),new sap.m.Text({text:"{/status}"}),new sap.m.Label({text:"Customer Type"}),new sap.m.Text({text:"{/customerType}"}),new sap.m.Label({text:"Currency"}),new sap.m.Text({text:"{/currency}"}),new sap.m.Label({text:"After Sales"}),new sap.m.Text({text:"{/afterSales}"})]})]}),new sap.m.IconTabFilter({text:"Unit Info",content:[new sap.ui.layout.form.SimpleForm({editable:false,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:"Project ID"}),new sap.m.Text({text:"{/projectId}"}),new sap.m.Label({text:"Project Name"}),new sap.m.Text({text:"{/projectName}"}),new sap.m.Label({text:"Building ID"}),new sap.m.Text({text:"{/buildingId}"}),new sap.m.Label({text:"Building Name"}),new sap.m.Text({text:"{/buildingName}"}),new sap.m.Label({text:"Unit ID"}),new sap.m.Text({text:"{/unitId}"}),new sap.m.Label({text:"Unit Number"}),new sap.m.Text({text:"{/unitNumber}"}),new sap.m.Label({text:"BUA"}),new sap.m.Text({text:"{/bua}"}),new sap.m.Label({text:"Phase"}),new sap.m.Text({text:"{/phase}"}),new sap.m.Label({text:"Price Plan Years"}),new sap.m.Text({text:"{/pricePlanYears}"})]})]}),new sap.m.IconTabFilter({text:"Payments",content:[new sap.m.Table({columns:[new sap.m.Column({header:new sap.m.Label({text:"Receipt Type"})}),new sap.m.Column({header:new sap.m.Label({text:"Status"})}),new sap.m.Column({header:new sap.m.Label({text:"Payment Method"})}),new sap.m.Column({header:new sap.m.Label({text:"Amount"})}),new sap.m.Column({header:new sap.m.Label({text:"House Bank"})}),new sap.m.Column({header:new sap.m.Label({text:"Due Date"})})],items:{path:"/payments",template:new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{receiptType}"}),new sap.m.Text({text:"{receiptStatus}"}),new sap.m.Text({text:"{paymentMethod}"}),new sap.m.Text({text:"{amount}"}),new sap.m.Text({text:"{houseBank}"}),new sap.m.Text({text:"{dueDate}"})]})}})]}),new sap.m.IconTabFilter({text:"Partners",content:[new sap.m.Table({columns:[new sap.m.Column({header:new sap.m.Label({text:"Customer Code"})}),new sap.m.Column({header:new sap.m.Label({text:"Name"})}),new sap.m.Column({header:new sap.m.Label({text:"Address"})}),new sap.m.Column({header:new sap.m.Label({text:"Valid From"})})],items:{path:"/partners",template:new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{customerCode}"}),new sap.m.Text({text:"{customerName}"}),new sap.m.Text({text:"{customerAddress}"}),new sap.m.Text({text:"{validFrom}"})]})}})]}),new sap.m.IconTabFilter({text:"Conditions",content:[new sap.m.Table({columns:[new sap.m.Column({header:new sap.m.Label({text:"Type"})}),new sap.m.Column({header:new sap.m.Label({text:"Amount"})}),new sap.m.Column({header:new sap.m.Label({text:"Currency"})}),new sap.m.Column({header:new sap.m.Label({text:"Frequency"})}),new sap.m.Column({header:new sap.m.Label({text:"Valid From"})}),new sap.m.Column({header:new sap.m.Label({text:"Valid To"})})],items:{path:"/conditions",template:new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{conditionType}"}),new sap.m.Text({text:"{amount}"}),new sap.m.Text({text:"{currency}"}),new sap.m.Text({text:"{frequency}"}),new sap.m.Text({text:"{validFrom}"}),new sap.m.Text({text:"{validTo}"})]})}})]})]})],endButton:new sap.m.Button({text:"Close",press:function(){this._oDetailsDialog.close()}.bind(this)})});this.getView().addDependent(this._oDetailsDialog)}this._oDetailsDialog.setModel(r);this._oDetailsDialog.open()}catch(e){n.error("Error: "+e.message)}},onAddReservation:function(){this._openReservationDialog({})},onEditReservation:async function(e){const t=e.getSource().getBindingContext("reservations");const a=t.getProperty("reservationId");try{const e=await fetch(`./odata/v4/real-estate/Reservations(reservationId='${a}')?$expand=payments,partners,conditions,project,building,unit`);if(!e.ok)throw new Error("Failed to load reservation for edit");const t=await e.json();const n=t.value?t.value[0]:t;this._openReservationDialog(n)}catch(e){n.error("Error: "+e.message)}},_openReservationDialog:function(e){if(!this._oAddDialog){this._oAddDialog=this.getView().byId("reservationDialog")}const t=new sap.ui.model.json.JSONModel({reservationId:e.reservationId||"",companyCodeId:e.companyCodeId||"",oldReservationId:e.oldReservationId||"",eoiId:e.eoiId||"",salesType:e.salesType||"",description:e.description||"",validFrom:e.validFrom||"",status:e.status||"",customerType:e.customerType||"",currency:e.currency||"",afterSales:e.afterSales||"",project:e.project||null,building:e.building||null,unit:e.unit||null,bua:e.bua||0,phase:e.phase||"",pricePlanYears:e.pricePlanYears||0,paymentPlan:e.paymentPlan||null,planYears:e.planYears||0,unitPrice:e.unitPrice||0,planCurrency:e.planCurrency||"",requestType:e.requestType||"",reason:e.reason||"",cancellationDate:e.cancellationDate||"",cancellationStatus:e.cancellationStatus||"",rejectionReason:e.rejectionReason||"",cancellationFees:e.cancellationFees||0,payments:e.payments||[],partners:e.partners||[],conditions:e.conditions||[]});this._oAddDialog.setModel(t,"local");this._oAddDialog.open()},onSaveReservation:async function(){const e=this.byId("reservationDialog");const t=e.getModel("local");const n=t.getData();try{const t={reservationId:n.reservationId||undefined,companyCodeId:n.companyCodeId,oldReservationId:n.oldReservationId,eoiId:n.eoiId,description:n.description,salesType:n.salesType,validFrom:n.validFrom,customerType:n.customerType,currency:n.currency,afterSales:n.afterSales,status:n.status,project_projectId:n.project_projectId,building_buildingId:n.building_buildingId,unit_unitId:n.unit_unitId,paymentPlan_paymentPlanId:n.paymentPlan_paymentPlanId,bua:n.bua,phase:n.phase,pricePlanYears:n.pricePlanYears,planYears:n.planYears,unitPrice:n.unitPrice,planCurrency:n.planCurrency,requestType:n.requestType,reason:n.reason,cancellationDate:n.cancellationDate,cancellationStatus:n.cancellationStatus,rejectionReason:n.rejectionReason,cancellationFees:n.cancellationFees,payments:n.payments||[],partners:n.partners||[],conditions:n.conditions||[]};const a=t.reservationId?"PUT":"POST";const s=t.reservationId?`./odata/v4/real-estate/Reservations(reservationId='${t.reservationId}')`:`./odata/v4/real-estate/Reservations`;const o=await fetch(s,{method:a,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok){const e=await o.json();throw new Error(e.error?.message||"Failed to save reservation")}sap.m.MessageToast.show("Reservation saved successfully!");e.close();const r=this.getView().getModel("reservations");r.refresh()}catch(e){console.error("Error saving reservation:",e);sap.m.MessageBox.error("Failed to save reservation: "+e.message)}},onCancelReservation:function(){this._oAddDialog.close()},onDeleteReservation:function(e){const a=e.getSource().getBindingContext("reservations");const s=a.getObject();n.confirm(`Delete reservation ${s.reservationId}?`,{onClose:async e=>{if(e==="OK"){try{const e=await fetch(`./odata/v4/real-estate/Reservations('${s.reservationId}')`,{method:"DELETE"});if(!e.ok)throw new Error("Delete failed");t.show("Deleted successfully");this._loadReservations()}catch(e){n.error(e.message)}}}})},onAddPaymentRow:function(){const e=this._oAddDialog.getModel("local");const t=e.getProperty("/payments");t.push({});e.refresh()},onDeletePaymentRow:function(){const e=this._oAddDialog.getModel("local");const t=e.getProperty("/payments");t.pop();e.refresh()},onAddPartnerRow:function(){const e=this._oAddDialog.getModel("local");const t=e.getProperty("/partners");t.push({});e.refresh()},onDeletePartnerRow:function(){const e=this._oAddDialog.getModel("local");const t=e.getProperty("/partners");t.pop();e.refresh()},onAddConditionRow:function(){const e=this._oAddDialog.getModel("local");const t=e.getProperty("/conditions");t.push({});e.refresh()},onDeleteConditionRow:function(){const e=this._oAddDialog.getModel("local");const t=e.getProperty("/conditions");t.pop();e.refresh()}})});
sap.ui.predefine("dboperations/controller/Units.controller", ["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/Dialog","sap/m/Input","sap/m/Button","sap/m/Label","sap/m/Text","sap/m/TextArea","sap/m/VBox","sap/m/DatePicker","sap/m/Table","sap/m/Column","sap/m/ColumnListItem","sap/ui/model/json/JSONModel","sap/m/Title","sap/m/IconTabBar","sap/m/IconTabFilter","sap/ui/layout/form/SimpleForm","sap/m/ComboBox","sap/ui/core/Item","sap/m/MessageToast","sap/m/SelectDialog","sap/m/StandardListItem"],function(e,t,n,i,a,o,s,r,l,p,u,c,d,m,g,h,P,y,I,D,w,f,C){"use strict";return e.extend("dboperations.controller.Units",{onInit:function(){this.getOwnerComponent().getRouter().getRoute("Units").attachPatternMatched(this._onRouteMatched,this);var e=new sap.ui.model.json.JSONModel({Units:[]});e.setProperty("/selectedUnitStatus","");e.setProperty("/selectedUnitId","");this.getView().setModel(e,"view");this._loadUnits();this._loadMeasurementsList();this._loadConditionsList();this._loadCompanyCodesList();this._loadProjectsList();this._loadBuildingsList();this._loadPaymentPlansForFilter();this._idCounter=parseInt(localStorage.getItem("simulationIdCounter"))||0;this._unitIdCounter=parseInt(localStorage.getItem("unitIdCounter"))||0},_onRouteMatched:function(){this._loadUnits()},_loadUnits:function(){var e=new sap.ui.model.json.JSONModel;fetch("./odata/v4/real-estate/Units?$expand=measurements,conditions").then(e=>e.json()).then(t=>{const n=t.value.map(e=>{let n=e.measurements?.find(e=>e.code?.toUpperCase()==="BUA");let i=n?n.quantity:null;let a=n?n.uom:null;let o=n?n.code:null;let s=e.conditions?.[0];let r=s?s.amount:null;console.log("Units",t.value);console.log("BUA",i);return{...e,bua:i,originalPrice:r,uom:a,measurementCode:o}});e.setData({Units:n});const i=[];const a=[];const o=[];n.forEach(e=>{if(e.unitStatusDescription&&!i.includes(e.unitStatusDescription)){i.push(e.unitStatusDescription)}if(e.unitId&&!a.includes(e.unitId)){a.push(e.unitId)}if(e.unitTypeDescription&&!o.includes(e.unitTypeDescription)){o.push(e.unitTypeDescription)}});console.log("united status",i);console.log("unitIDS",a);console.log("UnitTypes",o);e.setProperty("/UnitStatuses",i.map(e=>({status:e})));e.setProperty("/UnitId",a.map(e=>({id:e})));e.setProperty("/UnitType",o.map(e=>({type:e})));this.getView().setModel(e,"view");this.getView().byId("unitsTable").setModel(e);[]}).catch(e=>{console.error("Error fetching units",e)})},_loadPaymentPlansForFilter:function(){fetch("./odata/v4/real-estate/PaymentPlans?$expand=assignedProjects($expand=project)").then(e=>e.json()).then(e=>{this.getView().setModel(new m(e.value||[]),"paymentPlansFilter");console.log("Payment Plans loaded for filtering:",e.value)}).catch(e=>console.error("Failed to load Payment Plans for filter:",e))},_loadMeasurementsList:function(){fetch("./odata/v4/real-estate/Measurements").then(e=>e.json()).then(e=>{const t=e.value.reduce((e,t)=>{if(!e.find(e=>e.code===t.description)){e.push({code:t.code,description:t.description})}return e},[]);this.getView().setModel(new m(t),"measurementsList");console.log("MeasList",e.value)}).catch(e=>console.error("Failed to load Measurements list:",e))},_loadConditionsList:function(){fetch("./odata/v4/real-estate/Conditions").then(e=>e.json()).then(e=>{this.getView().setModel(new m(e.value||[]),"conditionsList");console.log("CondList",e.value)}).catch(e=>console.error("Failed to load Conditions list:",e))},_loadCompanyCodesList:function(){fetch("./odata/v4/real-estate/Projects").then(e=>e.json()).then(e=>{const t=e.value.reduce((e,t)=>{if(!e.find(e=>e.companyCodeId===t.companyCodeId)){e.push({companyCodeId:t.companyCodeId,companyCodeDescription:t.companyCodeDescription})}return e},[]);this.getView().setModel(new m(t),"companyCodesList");console.log(t)}).catch(e=>console.error("Failed to load Company Codes list:",e))},_loadProjectsList:function(){fetch("./odata/v4/real-estate/Projects").then(e=>e.json()).then(e=>{const t=e.value.reduce((e,t)=>{if(!e.find(e=>e.projectId===t.projectId)){e.push({projectId:t.projectId,projectDescription:t.projectDescription,profitCenter:t.profitCenter,functionalArea:t.functionalArea})}return e},[]);this.getView().setModel(new m(t),"projectsList");console.log("projectsList",e.value)}).catch(e=>console.error("Failed to load Projects list:",e))},_loadBuildingsList:function(){fetch("./odata/v4/real-estate/Buildings").then(e=>e.json()).then(e=>{this.getView().setModel(new m(e.value||[]),"buildingsList")}).catch(e=>console.error("Failed to load Buildings list:",e))},_updateFilteredBuildings:function(e,t){const n=this.getView().getModel("buildingsList").getData();const i=n.filter(t=>t.projectId===e);t.setProperty("/filteredBuildings",i)},onNavigateToAddUnit:function(){if(!this._oAddDialog){var e=new sap.ui.model.json.JSONModel({unitDescription:"",companyCodeId:"",companyCodeDescription:"",projectId:"",projectDescription:"",buildingId:"",unitTypeDescription:"",usageTypeDescription:"",unitStatusDescription:"",floorDescription:"",zone:"",salesPhase:"",finishingSpexDescription:"",profitCenter:"",functionalArea:"",unitDeliveryDate:"",supplementaryText:"",measurements:[],conditions:[],filteredBuildings:[]});this._oAddDialog=new sap.m.Dialog({title:"Add New Unit",content:new sap.m.VBox({items:[new sap.m.Label({text:"Unit Description",required:true}),new sap.m.Input("unitDescInput",{value:"{/unitDescription}",tooltip:"Up to 60 characters"}),new sap.m.Label({text:"Company Code ID",required:true}),new I("companyCodeIdInput",{selectedKey:"{/companyCodeId}",change:this.onCompanyCodeChange.bind(this),items:{path:"companyCodesList>/",template:new D({key:"{companyCodesList>companyCodeId}",text:"{companyCodesList>companyCodeId} - {companyCodesList>companyCodeDescription}"})},tooltip:"Must be 4 characters"}),new sap.m.Label({text:"Company Code Description",required:true}),new sap.m.Input("companyCodeDescInput",{value:"{/companyCodeDescription}",tooltip:"Up to 60 characters"}),new sap.m.Label({text:"Project ID",required:true}),new I("projectIdInput",{selectedKey:"{/projectId}",change:this.onProjectChange.bind(this),items:{path:"projectsList>/",template:new D({key:"{projectsList>projectId}",text:"{projectsList>projectId} - {projectsList>projectDescription}"})},tooltip:"Must be 8 characters"}),new sap.m.Label({text:"Project Description",required:true}),new sap.m.Input("projectDescInput",{value:"{/projectDescription}",tooltip:"Up to 60 characters"}),new sap.m.Label({text:"Unit Type Description",required:true}),new sap.m.Input("unitTypeDescInput",{value:"{/unitTypeDescription}"}),new sap.m.Label({text:"Usage Type Description",required:true}),new sap.m.Input("usageTypeDescInput",{value:"{/usageTypeDescription}"}),new sap.m.Label({text:"Unit Status Description",required:true}),new sap.m.Input("unitStatusDescInput",{value:"{/unitStatusDescription}"}),new sap.m.Label({text:"Floor Description",required:true}),new sap.m.Input("floorDescInput",{value:"{/floorDescription}"}),new sap.m.Label({text:"Zone",required:true}),new sap.m.Input("zoneInput",{value:"{/zone}"}),new sap.m.Label({text:"Sales Phase",required:true}),new sap.m.Input("salesPhaseInput",{value:"{/salesPhase}"}),new sap.m.Label({text:"Finishing Spex Description",required:true}),new sap.m.Input("finishingSpexDescInput",{value:"{/finishingSpexDescription}"}),new sap.m.Label({text:"Profit Center"}),new sap.m.Text({text:"{/profitCenter}"}),new sap.m.Label({text:"Functional Area"}),new sap.m.Text({text:"{/functionalArea}"}),new sap.m.Label({text:"Delivery Date",required:true}),new sap.m.DatePicker("unitDeliveryDateInput",{value:"{/unitDeliveryDate}",displayFormat:"long",valueFormat:"yyyy-MM-dd",placeholder:"Select a date"}),new sap.m.Label({text:"Supplementary Text",required:true}),new sap.m.Input("supplementaryTextInput",{value:"{/supplementaryText}"}),new sap.m.Title({text:"Measurements",level:"H3"}),new sap.m.Button({text:"Add Measurement",press:this.onAddMeasurementRow.bind(this)}),new sap.m.Button({text:"Delete Measurement",press:this.onDeleteMeasurementRow.bind(this)}),new sap.m.Table({id:"addMeasurementsTable",items:"{/measurements}",columns:[new sap.m.Column({header:new sap.m.Label({text:"Code"})}),new sap.m.Column({header:new sap.m.Label({text:"Description"})}),new sap.m.Column({header:new sap.m.Label({text:"Quantity"})}),new sap.m.Column({header:new sap.m.Label({text:"UOM"})})],items:{path:"/measurements",template:new sap.m.ColumnListItem({cells:[new I({selectedKey:"{code}",change:this.onMeasurementCodeChange.bind(this),items:{path:"measurementsList>/",template:new D({key:"{measurementsList>code}",text:"{measurementsList>code} - {measurementsList>description}"})}}),new s({text:"{description}"}),new i({value:"{quantity}",type:"Number"}),new i({value:"{uom}"})]})}}),new sap.m.Title({text:"Conditions",level:"H3"}),new sap.m.Button({text:"Add Condition",press:this.onAddConditionRow.bind(this)}),new sap.m.Button({text:"Delete Condition",press:this.onDeleteConditionRow.bind(this)}),new sap.m.Table({id:"addConditionsTable",items:"{/conditions}",columns:[new sap.m.Column({header:new sap.m.Label({text:"Code"})}),new sap.m.Column({header:new sap.m.Label({text:"Description"})}),new sap.m.Column({header:new sap.m.Label({text:"Amount"})}),new sap.m.Column({header:new sap.m.Label({text:"Currency"})}),new sap.m.Column({header:new sap.m.Label({text:"Number of Years"})})],items:{path:"/conditions",template:new sap.m.ColumnListItem({cells:[new I({selectedKey:"{code}",change:this.onConditionCodeChange.bind(this),items:{path:"conditionsList>/",template:new D({key:"{conditionsList>code}",text:"{conditionsList>code} - {conditionsList>description}"})}}),new s({text:"{description}"}),new i({value:"{amount}",type:"Number"}),new i({value:"{currency}"}),new i({value:"{numberOfYears}",type:"Number"})]})}})]}),beginButton:new sap.m.Button({text:"Save",type:"Emphasized",press:function(){var e=this._oAddDialog.getModel().getData();var t=[{id:"unitDescInput",name:"Unit Description"},{id:"companyCodeIdInput",name:"Company Code ID"},{id:"companyCodeDescInput",name:"Company Code Description"},{id:"projectIdInput",name:"Project ID"},{id:"projectDescInput",name:"Project Description"},{id:"unitTypeDescInput",name:"Unit Type Description"},{id:"usageTypeDescInput",name:"Usage Type Description"},{id:"unitStatusDescInput",name:"Unit Status Description"},{id:"floorDescInput",name:"Floor Description"},{id:"zoneInput",name:"Zone"},{id:"salesPhaseInput",name:"Sales Phase"},{id:"finishingSpexDescInput",name:"Finishing Spex Description"},{id:"unitDeliveryDateInput",name:"Delivery Date"},{id:"supplementaryTextInput",name:"Supplementary Text"}];var n=true;t.forEach(function(e){var t=sap.ui.getCore().byId(e.id);if(!t.getValue()){t.setValueState("Error");t.setValueStateText(e.name+" is required");n=false}else{t.setValueState("None")}});if(!n){sap.m.MessageBox.warning("Please fill all required fields before saving.");return}this._unitIdCounter=(this._unitIdCounter||0)+1;const i="U"+("000"+this._unitIdCounter).slice(-4);localStorage.setItem("unitIdCounter",this._unitIdCounter);const a={unitId:i,unitDescription:e.unitDescription,companyCodeId:e.companyCodeId,companyCodeDescription:e.companyCodeDescription,projectId:e.projectId,projectDescription:e.projectDescription,unitTypeDescription:e.unitTypeDescription,usageTypeDescription:e.usageTypeDescription,unitStatusDescription:e.unitStatusDescription,floorDescription:e.floorDescription,zone:e.zone,salesPhase:e.salesPhase,finishingSpexDescription:e.finishingSpexDescription,unitDeliveryDate:e.unitDeliveryDate||null,supplementaryText:e.supplementaryText,profitCenter:e.profitCenter||0,functionalArea:e.functionalArea||0,measurements:e.measurements,conditions:e.conditions};if(a.measurements.length===0){delete a.measurements}if(a.conditions.length===0){delete a.conditions}fetch("./odata/v4/real-estate/Units",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(e=>{if(!e.ok){throw new Error("Failed to create unit")}return e.json()}).then(()=>{sap.m.MessageToast.show("Unit created!");this._loadUnits();this._resetAddDialogFields();this._oAddDialog.close()}).catch(e=>{sap.m.MessageBox.error("Error: "+e.message)})}.bind(this)}),endButton:new sap.m.Button({text:"Cancel",press:function(){this._resetAddDialogFields();this._oAddDialog.close()}.bind(this)})});this._oAddDialog.setModel(e);this.getView().addDependent(this._oAddDialog)}this._resetAddDialogFields();this._oAddDialog.open()},_resetAddDialogFields:function(){var e=this._oAddDialog.getModel();e.setData({unitDescription:"",companyCodeId:"",companyCodeDescription:"",projectId:"",projectDescription:"",unitTypeDescription:"",usageTypeDescription:"",unitStatusDescription:"",floorDescription:"",zone:"",salesPhase:"",finishingSpexDescription:"",profitCenter:"",functionalArea:"",unitDeliveryDate:"",supplementaryText:"",measurements:[],conditions:[],filteredBuildings:[]});["unitDescInput","companyCodeIdInput","companyCodeDescInput","projectIdInput","projectDescInput","buildingIdInput","unitTypeDescInput","usageTypeDescInput","unitStatusDescInput","floorDescInput","zoneInput","salesPhaseInput","finishingSpexDescInput","unitDeliveryDateInput","supplementaryTextInput"].forEach(function(e){var t=sap.ui.getCore().byId(e);if(t)t.setValueState("None")})},onDetails:function(e){var t=e.getSource().getBindingContext();if(!t){return}var n=t.getObject();var i=new sap.ui.model.json.JSONModel({unitId:n.unitId,unitDescription:n.unitDescription,companyCodeId:n.companyCodeId,companyCodeDescription:n.companyCodeDescription,projectId:n.projectId,projectDescription:n.projectDescription,buildingId:n.buildingId,unitTypeDescription:n.unitTypeDescription,usageTypeDescription:n.usageTypeDescription,unitStatusDescription:n.unitStatusDescription,floorDescription:n.floorDescription,zone:n.zone,salesPhase:n.salesPhase,finishingSpexDescription:n.finishingSpexDescription,profitCenter:n.profitCenter,functionalArea:n.functionalArea,unitDeliveryDate:n.unitDeliveryDate,supplementaryText:n.supplementaryText,measurements:n.measurements,conditions:n.conditions});if(!this._oDetailsDialog){this._oDetailsDialog=new sap.m.Dialog({title:"Unit Details",contentWidth:"100%",resizable:true,draggable:true,content:[new sap.m.IconTabBar({expandable:true,items:[new sap.m.IconTabFilter({text:"General Data",icon:"sap-icon://project-definition",content:[new sap.ui.layout.form.SimpleForm({editable:false,layout:"ResponsiveGridLayout",labelSpanL:3,columnsL:2,content:[new sap.m.Label({text:"Unit ID"}),new sap.m.Text({text:"{/unitId}"}),new sap.m.Label({text:"Unit Description"}),new sap.m.Text({text:"{/unitDescription}"}),new sap.m.Label({text:"Company Code ID"}),new sap.m.Text({text:"{/companyCodeId}"}),new sap.m.Label({text:"Company Code Description"}),new sap.m.Text({text:"{/companyCodeDescription}"}),new sap.m.Label({text:"Project ID"}),new sap.m.Text({text:"{/projectId}"}),new sap.m.Label({text:"Project Description"}),new sap.m.Text({text:"{/projectDescription}"}),new sap.m.Label({text:"Building ID"}),new sap.m.Text({text:"{/buildingId}"}),new sap.m.Label({text:"Unit Type Description"}),new sap.m.Text({text:"{/unitTypeDescription}"}),new sap.m.Label({text:"Usage Type Description"}),new sap.m.Text({text:"{/usageTypeDescription}"}),new sap.m.Label({text:"Unit Status Description"}),new sap.m.Text({text:"{/unitStatusDescription}"}),new sap.m.Label({text:"Floor Description"}),new sap.m.Text({text:"{/floorDescription}"}),new sap.m.Label({text:"Zone"}),new sap.m.Text({text:"{/zone}"}),new sap.m.Label({text:"Sales Phase"}),new sap.m.Text({text:"{/salesPhase}"}),new sap.m.Label({text:"Finishing Spex Description"}),new sap.m.Text({text:"{/finishingSpexDescription}"}),new sap.m.Label({text:"Delivery Date"}),new sap.m.Text({text:"{/unitDeliveryDate}"})]})]}),new sap.m.IconTabFilter({text:"Posting Parameters",icon:"sap-icon://post",content:[new sap.ui.layout.form.SimpleForm({editable:false,layout:"ResponsiveGridLayout",labelSpanL:3,columnsL:2,content:[new sap.m.Label({text:"Profit Center"}),new sap.m.Text({text:"{/profitCenter}"}),new sap.m.Label({text:"Functional Area"}),new sap.m.Text({text:"{/functionalArea}"})]})]}),new sap.m.IconTabFilter({text:"Supplementary Text",icon:"sap-icon://document-text",content:[new sap.ui.layout.form.SimpleForm({editable:false,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:"Supplementary Text"}),new sap.m.TextArea({value:"{/supplementaryText}",width:"100%",rows:6,editable:false,growing:true,growingMaxLines:10})]})]}),new sap.m.IconTabFilter({text:"Measurements",icon:"sap-icon://measure",content:[new sap.m.Table({columns:[new sap.m.Column({header:new sap.m.Label({text:"Code"})}),new sap.m.Column({header:new sap.m.Label({text:"Description"})}),new sap.m.Column({header:new sap.m.Label({text:"Quantity"})}),new sap.m.Column({header:new sap.m.Label({text:"UOM"})})],items:{path:"/measurements",template:new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{code}"}),new sap.m.Text({text:"{description}"}),new sap.m.Text({text:"{quantity}"}),new sap.m.Text({text:"{uom}"})]})}})]}),new sap.m.IconTabFilter({text:"Conditions",icon:"sap-icon://list",content:[new sap.m.Table({columns:[new sap.m.Column({header:new sap.m.Label({text:"Code"})}),new sap.m.Column({header:new sap.m.Label({text:"Description"})}),new sap.m.Column({header:new sap.m.Label({text:"Amount"})}),new sap.m.Column({header:new sap.m.Label({text:"Currency"})}),new sap.m.Column({header:new sap.m.Label({text:"Number of Years"})})],items:{path:"/conditions",template:new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{code}"}),new sap.m.Text({text:"{description}"}),new sap.m.Text({text:"{amount}"}),new sap.m.Text({text:"{currency}"}),new sap.m.Text({text:"{numberOfYears}"})]})}})]})]})],endButton:new sap.m.Button({text:"Close",type:"Emphasized",press:function(){this._oDetailsDialog.close()}.bind(this)})});this.getView().addDependent(this._oDetailsDialog)}this._oDetailsDialog.setModel(i);this._oDetailsDialog.open()},onDelete:function(e){var n=e.getSource().getBindingContext();if(n){var i=n.getPath();var a=this.getView().byId("unitsTable").getModel();var o=a.getProperty(i);if(!o){sap.m.MessageBox.error("Could not find model data for deletion.");return}t.confirm("Are you sure you want to delete "+o.unitId+"?",{title:"Confirm Deletion",onClose:function(e){if(e===t.Action.OK){fetch(`./odata/v4/real-estate/Units(unitId='${o.unitId}')`,{method:"DELETE"}).then(e=>{if(!e.ok){throw new Error("Failed to delete: "+e.statusText)}var t=a.getProperty("/Units");var n=t.findIndex(e=>e.unitId===o.unitId);if(n>-1){t.splice(n,1);a.setProperty("/Units",t)}sap.m.MessageToast.show("Unit deleted successfully!")}).catch(e=>{console.error("Error deleting Unit:",e);sap.m.MessageBox.error("Error: "+e.message)})}}})}},onEditUnit:function(e){var t=e.getSource().getBindingContext();if(!t)return;var n=t.getObject();var a=new sap.ui.model.json.JSONModel(Object.assign({},n,{filteredBuildings:[]}));this._updateFilteredBuildings(n.projectId,a);if(!this._oEditDialog){this._oEditDialog=new sap.m.Dialog({title:"Edit Unit",content:new sap.m.VBox({items:[new sap.m.Label({text:"Unit ID"}),new sap.m.Input({value:"{/unitId}",editable:false}),new sap.m.Label({text:"Unit Description",required:true}),new sap.m.Input("editUnitDescInput",{value:"{/unitDescription}"}),new sap.m.Label({text:"Company Code ID",required:true}),new I("editCompanyCodeIdInput",{selectedKey:"{/companyCodeId}",change:this.onCompanyCodeChange.bind(this),items:{path:"companyCodesList>/",template:new D({key:"{companyCodesList>companyCodeId}",text:"{companyCodesList>companyCodeId} - {companyCodesList>companyCodeDescription}"})}}),new sap.m.Label({text:"Company Code Description",required:true}),new sap.m.Input("editCompanyCodeDescInput",{value:"{/companyCodeDescription}"}),new sap.m.Label({text:"Project ID",required:true}),new I("editProjectIdInput",{selectedKey:"{/projectId}",change:this.onProjectChange.bind(this),items:{path:"projectsList>/",template:new D({key:"{projectsList>projectId}",text:"{projectsList>projectId} - {projectsList>projectDescription}"})}}),new sap.m.Label({text:"Project Description",required:true}),new sap.m.Input("editProjectDescInput",{value:"{/projectDescription}"}),new sap.m.Label({text:"Unit Type Description",required:true}),new sap.m.Input("editUnitTypeDescInput",{value:"{/unitTypeDescription}"}),new sap.m.Label({text:"Usage Type Description",required:true}),new sap.m.Input("editUsageTypeDescInput",{value:"{/usageTypeDescription}"}),new sap.m.Label({text:"Unit Status Description",required:true}),new sap.m.Input("editUnitStatusDescInput",{value:"{/unitStatusDescription}"}),new sap.m.Label({text:"Floor Description",required:true}),new sap.m.Input("editFloorDescInput",{value:"{/floorDescription}"}),new sap.m.Label({text:"Zone",required:true}),new sap.m.Input("editZoneInput",{value:"{/zone}"}),new sap.m.Label({text:"Sales Phase",required:true}),new sap.m.Input("editSalesPhaseInput",{value:"{/salesPhase}"}),new sap.m.Label({text:"Finishing Spex Description",required:true}),new sap.m.Input("editFinishingSpexDescInput",{value:"{/finishingSpexDescription}"}),new sap.m.Label({text:"Profit Center",required:true}),new sap.m.Input("editProfitCenterInput",{value:"{/profitCenter}"}),new sap.m.Label({text:"Functional Area",required:true}),new sap.m.Input("editFunctionalAreaInput",{value:"{/functionalArea}"}),new sap.m.Label({text:"Delivery Date",required:true}),new sap.m.DatePicker("editUnitDeliveryDateInput",{value:"{/unitDeliveryDate}",displayFormat:"long",valueFormat:"yyyy-MM-dd",placeholder:"Select a date"}),new sap.m.Label({text:"Supplementary Text",required:true}),new sap.m.Input("editSupplementaryTextInput",{value:"{/supplementaryText}"}),new sap.m.Title({text:"Measurements",level:"H3"}),new sap.m.Button({text:"Add Measurement",press:this.onAddMeasurementRow.bind(this)}),new sap.m.Button({text:"Delete Measurement",press:this.onDeleteMeasurementRow.bind(this)}),new sap.m.Table({id:"editMeasurementsTable",items:"{/measurements}",columns:[new sap.m.Column({header:new sap.m.Label({text:"Code"})}),new sap.m.Column({header:new sap.m.Label({text:"Description"})}),new sap.m.Column({header:new sap.m.Label({text:"Quantity"})}),new sap.m.Column({header:new sap.m.Label({text:"UOM"})})],items:{path:"/measurements",template:new sap.m.ColumnListItem({cells:[new I({selectedKey:"{code}",change:this.onMeasurementCodeChange.bind(this),items:{path:"measurementsList>/",template:new D({key:"{measurementsList>code}",text:"{measurementsList>code} - {measurementsList>description}"})}}),new s({text:"{description}"}),new i({value:"{quantity}",type:"Number"}),new i({value:"{uom}"})]})}}),new sap.m.Title({text:"Conditions",level:"H3"}),new sap.m.Button({text:"Add Condition",press:this.onAddConditionRow.bind(this)}),new sap.m.Button({text:"Delete Condition",press:this.onDeleteConditionRow.bind(this)}),new sap.m.Table({id:"editConditionsTable",items:"{/conditions}",columns:[new sap.m.Column({header:new sap.m.Label({text:"Code"})}),new sap.m.Column({header:new sap.m.Label({text:"Description"})}),new sap.m.Column({header:new sap.m.Label({text:"Amount"})}),new sap.m.Column({header:new sap.m.Label({text:"Currency"})})],items:{path:"/conditions",template:new sap.m.ColumnListItem({cells:[new I({selectedKey:"{code}",change:this.onConditionCodeChange.bind(this),items:{path:"conditionsList>/",template:new D({key:"{conditionsList>code}",text:"{conditionsList>code} - {conditionsList>description}"})}}),new s({text:"{description}"}),new i({value:"{amount}",type:"Number"}),new i({value:"{currency}"})]})}})]}),beginButton:new sap.m.Button({text:"Save",type:"Emphasized",press:function(){var e=this._oEditDialog.getModel().getData();var t=[{id:"editUnitDescInput",name:"Unit Description"},{id:"editCompanyCodeIdInput",name:"Company Code ID"},{id:"editCompanyCodeDescInput",name:"Company Code Description"},{id:"editProjectIdInput",name:"Project ID"},{id:"editProjectDescInput",name:"Project Description"},{id:"editUnitTypeDescInput",name:"Unit Type Description"},{id:"editUsageTypeDescInput",name:"Usage Type Description"},{id:"editUnitStatusDescInput",name:"Unit Status Description"},{id:"editFloorDescInput",name:"Floor Description"},{id:"editZoneInput",name:"Zone"},{id:"editSalesPhaseInput",name:"Sales Phase"},{id:"editFinishingSpexDescInput",name:"Finishing Spex Description"},{id:"editProfitCenterInput",name:"Profit Center"},{id:"editFunctionalAreaInput",name:"Functional Area"},{id:"editUnitDeliveryDateInput",name:"Delivery Date"},{id:"editSupplementaryTextInput",name:"Supplementary Text"}];var n=true;t.forEach(function(e){var t=sap.ui.getCore().byId(e.id);if(!t.getValue()){t.setValueState("Error");t.setValueStateText(e.name+" is required");n=false}else{t.setValueState("None")}});if(!n){sap.m.MessageBox.warning("Please fill all required fields before saving.");return}const i={unitId:e.unitId,unitDescription:e.unitDescription,companyCodeId:e.companyCodeId,companyCodeDescription:e.companyCodeDescription,projectId:e.projectId,projectDescription:e.projectDescription,unitTypeDescription:e.unitTypeDescription,usageTypeDescription:e.usageTypeDescription,unitStatusDescription:e.unitStatusDescription,floorDescription:e.floorDescription,zone:e.zone,salesPhase:e.salesPhase,finishingSpexDescription:e.finishingSpexDescription,unitDeliveryDate:e.unitDeliveryDate||null,supplementaryText:e.supplementaryText,profitCenter:e.profitCenter||0,functionalArea:e.functionalArea||0,measurements:e.measurements,conditions:e.conditions};if(i.measurements.length===0){delete i.measurements}if(i.conditions.length===0){delete i.conditions}fetch(`./odata/v4/real-estate/Units(unitId='${e.unitId}')`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then(e=>{if(!e.ok)throw new Error("Update failed");return e.json()}).then(()=>{sap.m.MessageToast.show("Unit updated successfully!");this._loadUnits();this._oEditDialog.close()}).catch(e=>sap.m.MessageBox.error("Error: "+e.message))}.bind(this)}),endButton:new sap.m.Button({text:"Cancel",press:function(){this._oEditDialog.close()}.bind(this)})});this.getView().addDependent(this._oEditDialog)}this._oEditDialog.setModel(a);this._oEditDialog.open()},onCompanyCodeChange:function(e){var t=e.getSource();var n=t.getSelectedKey();var i=t.getSelectedItem();var a=i?i.getText().split(" - ")[1]||"":"";var o=t.getBindingContext();if(o){o.getModel().setProperty(o.getPath()+"/companyCodeDescription",a)}else{t.getModel().setProperty("/companyCodeDescription",a)}},onProjectChange:function(e){var t=e.getSource();var n=t.getSelectedKey();var i=t.getSelectedItem();var a=i?i.getText().split(" - ")[1]||"":"";var o=t.getModel();o.setProperty("/projectDescription",a);const s=this.getView().getModel("projectsList").getData();const r=s.find(e=>e.projectId===n);if(r){o.setProperty("/profitCenter",r.profitCenter);o.setProperty("/functionalArea",r.functionalArea)}this._updateFilteredBuildings(n,o)},onAddMeasurementRow:function(e){const t=e.getSource().getModel();t.getProperty("/measurements").push({code:"",description:"",quantity:0,uom:""});t.refresh()},onDeleteMeasurementRow:function(e){const t=e.getSource().getModel();const n=t.getProperty("/measurements");n.pop();t.refresh()},onAddConditionRow:function(e){const t=e.getSource().getModel();t.getProperty("/conditions").push({code:"",description:"",amount:0,currency:"",numberOfYears:0});t.refresh()},onDeleteConditionRow:function(e){const t=e.getSource().getModel();const n=t.getProperty("/conditions");n.pop();t.refresh()},onMeasurementCodeChange:function(e){var t=e.getSource();var n=t.getSelectedKey();var i=t.getSelectedItem();var a=i?i.getText().split(" - ")[1]||"":"";var o=t.getBindingContext();if(o){o.getModel().setProperty(o.getPath()+"/description",a)}},onConditionCodeChange:function(e){var t=e.getSource();var n=t.getSelectedKey();var i=t.getSelectedItem();var a=i?i.getText().split(" - ")[1]||"":"";var o=t.getBindingContext();if(o){o.getModel().setProperty(o.getPath()+"/description",a)}},onFilterUnits:function(){var e=this.byId("unitsTable");var t=e.getBinding("items");var n=[];var i=this.byId("unitTypeFilter").getSelectedKey();if(i){n.push(new sap.ui.model.Filter("unitTypeDescription",sap.ui.model.FilterOperator.EQ,i))}var a=this.byId("companyCodeFilter").getSelectedKey();if(a){n.push(new sap.ui.model.Filter("companyCodeId",sap.ui.model.FilterOperator.EQ,a))}var o=this.byId("projectIdFilter").getSelectedKey();if(o){n.push(new sap.ui.model.Filter("projectId",sap.ui.model.FilterOperator.EQ,o))}var s=this.byId("_IDGenInput17").getValue();var r=this.byId("_IDGenInput18").getValue();if(s)n.push(new sap.ui.model.Filter("floorDescription",sap.ui.model.FilterOperator.GE,s));if(r)n.push(new sap.ui.model.Filter("floorDescription",sap.ui.model.FilterOperator.LE,r));var l=this.byId("measurementFilter").getSelectedKey();var p=this.byId("_IDGenInput15").getValue();var u=this.byId("_IDGenInput16").getValue();var c=this.byId("_IDGenInput19").getValue();if(l||p||u||c){n.push(new sap.ui.model.Filter({path:"",test:function(e){var t=e.measurements?.find(e=>e.code?.toUpperCase()===l?.toUpperCase());if(l&&!t)return false;if((p||u||c)&&!t)return false;if(p&&parseFloat(t.quantity)<parseFloat(p))return false;if(u&&parseFloat(t.quantity)>parseFloat(u))return false;if(c&&t.uom?.toUpperCase()!==c.toUpperCase())return false;return true}}))}var d=this.byId("_IDGenInput20").getValue();var m=this.byId("_IDGenInput21").getValue().trim().toUpperCase();if(d||m){var g=[];var h=this.getView().getModel("paymentPlansFilter").getData()||[];h.forEach(function(e){var t=!d||e.planYears===parseInt(d);var n=!m||e.currency&&e.currency.toUpperCase()===m;if(t&&n){if(Array.isArray(e.assignedProjects)){e.assignedProjects.forEach(function(e){if(e.project&&e.project.projectId){var t=e.project.projectId;if(g.indexOf(t)===-1){g.push(t)}}})}}});if(g.length>0){var P=g.map(function(e){return new sap.ui.model.Filter("projectId",sap.ui.model.FilterOperator.EQ,e)});n.push(new sap.ui.model.Filter({aFilters:P,bAnd:false}))}else{n.push(new sap.ui.model.Filter("projectId",sap.ui.model.FilterOperator.EQ,null))}}var y=n.length>0?new sap.ui.model.Filter(n,true):null;t.filter(y?[y]:[])},onCreateReservation:function(e){var t=e.getSource().getBindingContext().getObject();var n=sap.ui.core.UIComponent.getRouterFor(this);n.navTo("Reservations",{unitId:t.unitId})},onClearFilter:function(){var e=this.getView().getModel("view");this.byId("unitTypeFilter").setSelectedKey("");this.byId("companyCodeFilter").setSelectedKey("");this.byId("projectIdFilter").setSelectedKey("");e.setProperty("/selectedUnitStatus","");e.setProperty("/selectedUnitId","");e.setProperty("/selectedUnitId","");var t=this.byId("unitsTable");t.getBinding("items").filter([])},onOpenPaymentSimulation:function(e){var t=e.getSource().getBindingContext().getObject().unitId;if(!this._oSimulationDialog){var n=new sap.m.VBox({items:[new sap.m.Title({text:"Simulation Details",level:"H3"}),new sap.m.Label({text:"Simulation ID"}),new sap.m.Input({id:"simIdInput",value:"{local>/simulationId}",editable:false,placeholder:"Auto-generated"}),new sap.m.Label({text:"Unit"}),new sap.m.Input({id:"unitIdInputPPS",value:"{local>/unitDisplay}",showValueHelp:true,valueHelpRequest:this.onOpenUnitValueHelpPPS.bind(this),editable:false,placeholder:"Unit pre-selected"}),new sap.m.Label({text:"Project ID"}),new sap.m.Input({id:"projectIdInputPPS",value:"{local>/projectId}",editable:false}),new sap.m.Label({text:"Project Description"}),new sap.m.Input({id:"projectDescriptionInputPPS",value:"{local>/projectDescription}",editable:false}),new sap.m.Label({text:"Price Plan (Years)"}),new sap.m.Input({id:"pricePlanInputPPS",value:"{local>/pricePlanYears}",editable:false,placeholder:"Auto-calculated from unit conditions"}),new sap.m.Label({text:"Payment Plan ID"}),new sap.m.Input({id:"paymentPlanIdInputPPS",value:"{local>/paymentPlanId}",editable:false}),new sap.m.Label({text:"Lead ID"}),new sap.m.Input({id:"leadIdInputPPS",value:"{local>/leadId}",placeholder:"Enter code"}),new sap.m.Label({text:"Final Price"}),new sap.m.Input({id:"finalPriceInputPPS",value:"{local>/finalPrice}",editable:false}),new sap.m.Label({text:"User"}),new sap.m.Input({id:"userIdInputPPS",value:"currentUser",editable:false}),new sap.m.HBox({items:[new sap.m.Button({id:"saveBtnPPS",text:"Save Simulation",press:this.onSaveSimulationPPS.bind(this)})]}),new sap.m.Title({text:"Payment Schedule",level:"H3"}),new sap.m.Table({id:"simulationTablePPS",items:"{simulationOutput>/}",width:"100%",showSeparators:"All",columns:[new sap.m.Column({header:new sap.m.Label({text:"Condition Type"})}),new sap.m.Column({header:new sap.m.Label({text:"Due Date"})}),new sap.m.Column({header:new sap.m.Label({text:"Amount"})}),new sap.m.Column({header:new sap.m.Label({text:"Maintenance"})})],items:{path:"simulationOutput>/",template:new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{simulationOutput>conditionType}"}),new sap.m.Text({text:"{simulationOutput>dueDate}"}),new sap.m.Text({text:"{simulationOutput>amount}"}),new sap.m.Text({text:"{simulationOutput>maintenance}"})]})}})]});this._oSimulationDialog=new sap.m.Dialog({title:"Payment Plan Simulation",contentWidth:"80%",resizable:true,content:n,endButton:new sap.m.Button({text:"Close",press:function(){this._oSimulationDialog.close()}.bind(this)})});this._oSimulationDialog.setModel(new m({}),"local");this._oSimulationDialog.setModel(new m([]),"simulationOutput");this._loadUnitsForSim();this._loadDropdownDataForSim();this.getView().addDependent(this._oSimulationDialog)}if(this._oSimulationDialog){var i=this._oSimulationDialog.getModel("local");i.setProperty("/unitId",t);var a=this.getView().getModel("view").getProperty("/Units");var o=a.find(e=>e.unitId===t);if(o){i.setProperty("/projectId",o.projectId);i.setProperty("/projectDescription",o.projectDescription);sap.ui.getCore().byId("unitIdInputPPS").setValue(`${o.unitDescription} (${t})`);this._calculateFinalPricePPS(t,i);const e=o.conditions||[];const n=e.reduce((e,t)=>e+(t.numberOfYears||0),0);i.setProperty("/pricePlanYears",n);this.onOpenPricePlanValueHelpPPS()}this._oSimulationDialog.open()}else{console.error("Simulation dialog could not be created.")}},onOpenPricePlanValueHelpPPS:function(){const e=this._oSimulationDialog;const t=sap.ui.getCore().byId("projectIdInputPPS").getValue();const n=this._oSimulationDialog.getModel("local").getProperty("/pricePlanYears");console.log("Opening Price Plan Value Help for projectId:",t,"and years:",n);if(!this._oPricePlanValueHelpPPS){this._oPricePlanValueHelpPPS=new f({title:"Select Payment Plan (Filtered by Unit Conditions Years)",items:{path:"filteredPlans>/",template:new C({title:"{filteredPlans>planYears} Years",description:"{filteredPlans>description}"})},search:function(e){const t=e.getParameter("value")||"";const n=[new sap.ui.model.Filter("planYears",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("description",sap.ui.model.FilterOperator.Contains,t)];e.getSource().getBinding("items").filter(new sap.ui.model.Filter(n,false))},confirm:function(e){const t=e.getParameter("selectedItem");if(t){const e=t.getBindingContext("filteredPlans");const n=e.getObject();const i=n.planYears;const a=n.paymentPlanId;const o=n.description||"";console.log("Selected plan:",n);sap.ui.getCore().byId("paymentPlanIdInputPPS").setValue(a);this.onSimulatePPS()}}.bind(this)});e.addDependent(this._oPricePlanValueHelpPPS)}const i=this._oSimulationDialog.getModel("paymentPlans");const a=i?i.getData():[];console.log("All payment plans:",a);const o=a.filter(e=>Array.isArray(e.assignedProjects)&&e.assignedProjects.some(e=>e.project?.projectId===t)&&e.planYears===n);console.log("Filtered plans for project and years:",o);if(o.length===0){sap.m.MessageBox.warning(`No payment plans available for the selected project with ${n} years from unit conditions.`);return}this._oPricePlanValueHelpPPS.setModel(new m(o),"filteredPlans");const s=this._oPricePlanValueHelpPPS.getBinding("items");if(s){s.refresh()}this._oPricePlanValueHelpPPS.open()},onOpenPricePlanValueHelpPPS:function(){const e=this._oSimulationDialog;const t=sap.ui.getCore().byId("projectIdInputPPS").getValue();const n=this._oSimulationDialog.getModel("local").getProperty("/pricePlanYears");console.log("Opening Price Plan Value Help for projectId:",t,"and years:",n);if(!this._oPricePlanValueHelpPPS){this._oPricePlanValueHelpPPS=new f({title:"Select Payment Plan (Filtered by Unit Conditions Years)",items:{path:"filteredPlans>/",template:new C({title:"{filteredPlans>planYears} Years",description:"{filteredPlans>description}"})},search:function(e){const t=e.getParameter("value")||"";const n=[new sap.ui.model.Filter("planYears",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("description",sap.ui.model.FilterOperator.Contains,t)];e.getSource().getBinding("items").filter(new sap.ui.model.Filter(n,false))},confirm:function(e){const t=e.getParameter("selectedItem");if(t){const e=t.getBindingContext("filteredPlans");const n=e.getObject();const i=n.planYears;const a=n.paymentPlanId;const o=n.description||"";console.log("Selected plan:",n);sap.ui.getCore().byId("paymentPlanIdInputPPS").setValue(a);this.onSimulatePPS()}}.bind(this)});e.addDependent(this._oPricePlanValueHelpPPS)}const i=this._oSimulationDialog.getModel("paymentPlans");const a=i?i.getData():[];console.log("All payment plans:",a);const o=a.filter(e=>Array.isArray(e.assignedProjects)&&e.assignedProjects.some(e=>e.project?.projectId===t)&&e.planYears===n);console.log("Filtered plans for project and years:",o);if(o.length===0){sap.m.MessageBox.warning(`No payment plans available for the selected project with ${n} years from unit conditions.`);return}this._oPricePlanValueHelpPPS.setModel(new m(o),"filteredPlans");const s=this._oPricePlanValueHelpPPS.getBinding("items");if(s){s.refresh()}this._oPricePlanValueHelpPPS.open()},onOpenPricePlanValueHelpPPS:function(){const e=this._oSimulationDialog;const t=sap.ui.getCore().byId("projectIdInputPPS").getValue();console.log("Opening Price Plan Value Help for projectId:",t);if(!this._oPricePlanValueHelpPPS){this._oPricePlanValueHelpPPS=new f({title:"Select Payment Plan Year",items:{path:"filteredPlans>/",template:new C({title:"{filteredPlans>planYears} Years",description:"{filteredPlans>description}"})},search:function(e){const t=e.getParameter("value")||"";const n=[new sap.ui.model.Filter("planYears",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("description",sap.ui.model.FilterOperator.Contains,t)];e.getSource().getBinding("items").filter(new sap.ui.model.Filter(n,false))},confirm:function(e){const t=e.getParameter("selectedItem");if(t){const e=t.getBindingContext("filteredPlans");const n=e.getObject();const i=n.planYears;const a=n.paymentPlanId;const o=n.description||"";console.log("Selected plan:",n);sap.ui.getCore().byId("pricePlanInputPPS").setValue(`${i} Years`);sap.ui.getCore().byId("paymentPlanIdInputPPS").setValue(a);this.onSimulatePPS()}}.bind(this)});e.addDependent(this._oPricePlanValueHelpPPS)}const n=this._oSimulationDialog.getModel("paymentPlans");const i=n?n.getData():[];console.log("All payment plans:",i);const a=i.filter(e=>Array.isArray(e.assignedProjects)&&e.assignedProjects.some(e=>e.project?.projectId===t));console.log("Filtered plans for project:",a);if(a.length===0){sap.m.MessageBox.warning("No payment plans available for the selected project.");return}this._oPricePlanValueHelpPPS.setModel(new m(a),"filteredPlans");const o=this._oPricePlanValueHelpPPS.getBinding("items");if(o){o.refresh()}this._oPricePlanValueHelpPPS.open()},onPricePlanChangePPS:function(e){const n=parseInt(e.getParameter("value"));const i=sap.ui.getCore().byId("projectIdInputPPS").getValue();const a=this._oSimulationDialog.getModel("paymentPlans");const o=a?a.getData():[];const s=(o||[]).find(e=>e.planYears===n&&Array.isArray(e.assignedProjects)&&e.assignedProjects.some(e=>e.project?.projectId===i));if(s){sap.ui.getCore().byId("paymentPlanIdInputPPS").setValue(s.paymentPlanId);this.onSimulatePPS()}else{sap.ui.getCore().byId("paymentPlanIdInputPPS").setValue("");t.warning("No payment plan found for the entered years and project. Please select from the value help.")}},_loadUnitsForSim:function(){fetch("./odata/v4/real-estate/Units?$expand=project").then(e=>e.json()).then(e=>{this._oSimulationDialog.setModel(new m(e.value||[]),"units")}).catch(e=>console.error("Failed to load units for PPS:",e))},_loadDropdownDataForSim:async function(){try{const[e,t]=await Promise.all([fetch("./odata/v4/real-estate/Projects"),fetch("./odata/v4/real-estate/PaymentPlans?$expand=assignedProjects($expand=project)")]);const n=await e.json();const i=await t.json();this._oSimulationDialog.setModel(new m(n.value||[]),"projects");this._oSimulationDialog.setModel(new m(i.value||[]),"paymentPlans")}catch(e){console.error("Failed to load dropdown data for PPS:",e)}},onOpenUnitValueHelpPPS:function(){const e=this._oSimulationDialog;if(!this._oUnitValueHelpPPS){this._oUnitValueHelpPPS=new f({title:"Select Unit",items:{path:"units>/",template:new C({title:"{units>unitDescription}",description:"{units>unitId}"})},search:function(e){const t=e.getParameter("value")||"";const n=[new sap.ui.model.Filter("unitDescription",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("unitId",sap.ui.model.FilterOperator.Contains,t)];e.getSource().getBinding("items").filter(new sap.ui.model.Filter(n,false))},confirm:function(t){const n=t.getParameter("selectedItem");if(n){const t=n.getBindingContext("units");const i=t.getObject();const a=i.unitId;const o=i.unitDescription;const s=e.getModel("local");s.setProperty("/unitId",a);sap.ui.getCore().byId("unitIdInputPPS").setValue(`${o} (${a})`);this._onUnitSelectedPPS(a)}}.bind(this)});e.addDependent(this._oUnitValueHelpPPS)}this._oUnitValueHelpPPS.open()},_onUnitSelectedPPS:function(e){this.onUnitChangePPS({getParameter:()=>({selectedItem:{getKey:()=>e}})})},onUnitChangePPS:async function(e){let t=null;if(e&&typeof e.getParameter==="function"){const n=e.getParameter("selectedItem");if(n&&typeof n.getKey==="function"){t=n.getKey()}}if(!t){const e=this._oSimulationDialog.getModel("local");t=e?e.getProperty("/unitId"):null}if(!t)return;const n=this._oSimulationDialog.getModel("units");const i=n?n.getData():[];const a=i.find(e=>e.unitId===t);if(a){const e=a.project?.projectId||a.projectId;const n=a.project?.projectDescription||a.projectDescription;const i=this._oSimulationDialog.getModel("local");i.setProperty("/projectId",e);i.setProperty("/projectDescription",n);this._calculateFinalPricePPS(t,i)}},_calculateFinalPricePPS:async function(e,t){try{const n=await fetch(`./odata/v4/real-estate/Conditions?$filter=unit_unitId eq '${e}'`);const i=await n.json();const a=i.value||[];const o=a.reduce((e,t)=>e+Number(t.amount||0),0);t.setProperty("/finalPrice",o)}catch(e){console.error("Failed to calculate final price for PPS:",e)}},onPricePlanChangePPS:function(e){const t=parseInt(e.getParameter("value"));const n=sap.ui.getCore().byId("projectIdInputPPS").getValue();const i=this._oSimulationDialog.getModel("paymentPlans");const a=i?i.getData():[];const o=a.find(e=>e.planYears===t&&Array.isArray(e.assignedProjects)&&e.assignedProjects.some(e=>e.project?.projectId===n));if(o){sap.ui.getCore().byId("paymentPlanIdInputPPS").setValue(o.paymentPlanId)}else{sap.ui.getCore().byId("paymentPlanIdInputPPS").setValue("")}},onSimulatePPS:async function(){const e=this._oSimulationDialog.getModel("local");const n=e?e.getProperty("/unitId"):null;const i=e?Number(e.getProperty("/finalPrice")):NaN;const a=sap.ui.getCore().byId("projectIdInputPPS").getValue();const o=sap.ui.getCore().byId("paymentPlanIdInputPPS").getValue();const s=parseInt(sap.ui.getCore().byId("pricePlanInputPPS").getValue());const r=sap.ui.getCore().byId("leadIdInputPPS").getValue();if(!n){t.error("Please select a unit.");return}const l=this._oSimulationDialog.getModel("paymentPlans");const p=l?l.getData():[];const u=p.find(e=>e.planYears===s&&Array.isArray(e.assignedProjects)&&e.assignedProjects.some(e=>e.project?.projectId===a));if(!u){t.error("No payment plan exists for the selected years and project.");return}if(!o||!i||isNaN(i)){t.error("Please fill all required fields.");return}try{const t=await fetch(`./odata/v4/real-estate/PaymentPlanSchedules?$filter=paymentPlan_paymentPlanId eq '${o}'&$expand=conditionType,basePrice,frequency`);const i=await t.json();const a=i.value||[];const s=await fetch(`./odata/v4/real-estate/Conditions?$filter=unit_unitId eq '${n}'`);const r=await s.json();const l=r.value||[];const p=[];const u=new Date;a.forEach(e=>{const t=e.basePrice?.code;const n=l.find(e=>e.code===t);const i=n?Number(n.amount):0;const a=i*e.percentage/100;const o=this._getFrequencyIntervalPPS(e.frequency?.description);if(e.conditionType?.description==="Maintenance"){for(let t=0;t<(e.numberOfInstallments||1);t++){const n=e.dueInMonth+t*o;const i=new Date(u.getTime()+n*30*24*60*60*1e3);p.push({conditionType:e.conditionType.description,dueDate:i.toISOString().split("T")[0],amount:0,maintenance:Math.round(a/Math.max(1,e.numberOfInstallments)*100)/100})}}else{for(let t=0;t<(e.numberOfInstallments||1);t++){const n=e.dueInMonth+t*o;const i=new Date(u.getTime()+n*30*24*60*60*1e3);p.push({conditionType:e.conditionType?.description||"Installment",dueDate:i.toISOString().split("T")[0],amount:Math.round(a/Math.max(1,e.numberOfInstallments)*100)/100,maintenance:0})}}});this._oSimulationDialog.getModel("simulationOutput").setData(p);const c=sap.ui.getCore().byId("simulationTablePPS");if(c&&c.getBinding("items")){c.getBinding("items").refresh()}const d=this._generateIdPPS();sap.ui.getCore().byId("simIdInput").setValue(d);e.setProperty("/simulationId",d)}catch(e){t.error("Simulation failed: "+(e.message||e))}},onSaveSimulationPPS:async function(){const e=sap.ui.getCore().byId("simIdInput").getValue();const n=this._oSimulationDialog.getModel("local");const i=n?n.getProperty("/unitId"):null;const a=sap.ui.getCore().byId("projectIdInputPPS").getValue();const o=sap.ui.getCore().byId("paymentPlanIdInputPPS").getValue();const s=parseInt(sap.ui.getCore().byId("pricePlanInputPPS").getValue());const r=sap.ui.getCore().byId("leadIdInputPPS").getValue();const l=Number(n?n.getProperty("/finalPrice"):NaN);const p="currentUser";const u=this._oSimulationDialog.getModel("simulationOutput").getData();try{const t={simulationId:e,unitId:i,projectId:a,pricePlanYears:s,leadId:r,finalPrice:l,userId:p,schedule:(u||[]).map(e=>({conditionType:e.conditionType,dueDate:e.dueDate,amount:e.amount,maintenance:e.maintenance}))};const n=await fetch("./odata/v4/real-estate/PaymentPlanSimulations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error("Failed to save simulation");w.show("Simulation saved successfully!")}catch(e){t.error("Error: "+(e.message||e))}},_getFrequencyIntervalPPS:function(e){if(!e)return 12;switch(e.toLowerCase()){case"monthly":return 1;case"quarterly":return 3;case"semi-annual":return 6;case"annual":return 12;default:return 12}},_generateIdPPS:function(){this._idCounter+=1;localStorage.setItem("simulationIdCounter",this._idCounter);const e=("00000"+this._idCounter).slice(-5);return"PPS"+e},onProjectChange:function(e){var t=e.getSource();var n=t.getSelectedKey();var i=t.getSelectedItem();var a=i?i.getText().split(" - ")[1]||"":"";var o=this._oAddDialog.getModel();o.setProperty("/projectDescription",a);const s=this.getView().getModel("projectsList").getData();const r=s.find(e=>e.projectId===n);if(r){console.log(r);o.setProperty("/profitCenter",r.profitCenter||0);o.setProperty("/functionalArea",r.functionalArea||0)}else{o.setProperty("/profitCenter","");o.setProperty("/functionalArea","")}}})});
sap.ui.predefine("dboperations/model/models", ["sap/ui/model/json/JSONModel","sap/ui/Device"],function(e,n){"use strict";return{createDeviceModel:function(){var i=new e(n);i.setDefaultBindingMode("OneWay");return i}}});
sap.ui.require.preload({
	"dboperations/i18n/i18n.properties":'# This is the resource bundle for dboperations\n\n#Texts for manifest.json\n\n#XTIT: Application name\nappTitle=RealEstate\n\n#YDES: Application description\nappDescription=An SAP Fiori application.\n#XTIT: Main view title\ntitle=RealEstate',
	"dboperations/manifest.json":'{"_version":"1.76.0","sap.app":{"id":"dboperations","type":"application","i18n":{"bundleUrl":"i18n/i18n.properties","supportedLocales":[""]},"applicationVersion":{"version":"0.0.1"},"title":"{{appTitle}}","description":"{{appDescription}}","resources":"resources.json","sourceTemplate":{"id":"@sap/generator-fiori:basic","version":"1.19.0","toolsId":"6f7a97dd-e01a-4bb2-8f33-98fef9d57f2c"},"crossNavigation":{"inbounds":{"realestate-display":{"semanticObject":"dboperation","action":"display","title":"{{appTitle}}","subTitle":"{{appSubtitle}}","signature":{"parameters":{},"additionalParameters":"allowed"}},"dboperation-display":{"semanticObject":"dboperation","action":"display","signature":{"parameters":{},"additionalParameters":"allowed"}}}},"dataSources":{"mainService":{"uri":"odata/v4/real-estate/","type":"OData","settings":{"annotations":[],"odataVersion":"4.0"}}}},"sap.ui":{"technology":"UI5","icons":{"icon":"","favIcon":"","phone":"","phone@2":"","tablet":"","tablet@2":""},"deviceTypes":{"desktop":true,"tablet":true,"phone":true}},"sap.ui5":{"flexEnabled":true,"dependencies":{"minUI5Version":"1.141.0","libs":{"sap.m":{},"sap.ui.core":{},"sap.tnt":{},"sap.f":{},"sap.ui.integration":{},"sap.ui.table":{},"sap.fe.macros":{},"sap.ui.layout":{}}},"contentDensities":{"compact":true,"cozy":true},"models":{"i18n":{"type":"sap.ui.model.resource.ResourceModel","settings":{"bundleName":"dboperations.i18n.i18n","supportedLocales":[""]}},"":{"dataSource":"mainService","preload":true,"settings":{"operationMode":"Server","autoExpandSelect":true,"earlyRequests":true}}},"resources":{"css":[{"uri":"css/style.css"}]},"routing":{"config":{"routerClass":"sap.m.routing.Router","controlAggregation":"pages","controlId":"app","transition":"slide","type":"View","viewType":"XML","path":"dboperations.view","async":true,"viewPath":"dboperations.view"},"routes":[{"name":"Projects","pattern":"Projects","target":"Projects"},{"name":"Buildings","pattern":"Buildings","target":"Buildings"},{"name":"Units","pattern":"Units","target":"Units"},{"name":"PaymentPlans","pattern":"PaymentPlans","target":"PaymentPlans"},{"name":"EOI","pattern":"EOI","target":"EOI"},{"name":"Reservations","pattern":"Reservations","target":"Reservations"},{"name":"PaymentPlanSimulations","pattern":"PaymentPlanSimulations","target":"PaymentPlanSimulations"},{"name":"ConditionTypes","pattern":"ConditionTypes","target":"ConditionTypes"},{"name":"CalculationMethods","pattern":"CalculationMethods","target":"CalculationMethods"},{"name":"BasePrices","pattern":"BasePrices","target":"BasePrices"},{"name":"Frequencies","pattern":"Frequencies","target":"Frequencies"},{"name":"Measurements","pattern":"Measurements","target":"Measurements"},{"name":"Conditions","pattern":"Conditions","target":"Conditions"},{"name":"RouteDBOperations","pattern":":?query:","target":["TargetDBOperations"]}],"targets":{"Projects":{"viewName":"Projects"},"Buildings":{"viewName":"Buildings"},"Units":{"viewName":"Units"},"PaymentPlans":{"viewName":"PaymentPlans"},"EOI":{"viewName":"EOI"},"Reservations":{"viewName":"Reservations"},"PaymentPlanSimulations":{"viewName":"PaymentPlanSimulations"},"ConditionTypes":{"viewName":"ConditionTypes"},"CalculationMethods":{"viewName":"CalculationMethods"},"BasePrices":{"viewName":"BasePrices"},"Frequencies":{"viewName":"Frequencies"},"Measurements":{"viewName":"Measurements"},"Conditions":{"viewName":"Conditions"},"TargetDBOperations":{"id":"DBOperations","name":"DBOperations"}}},"rootView":{"viewName":"dboperations.view.App","type":"XML","id":"App","async":true}},"sap.cloud":{"public":true,"service":"RealEstate-approuter"}}',
	"dboperations/view/App.view.xml":'<mvc:View controllerName="dboperations.controller.App"\n    displayBlock="true"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns="sap.m"><App id="app"></App></mvc:View>',
	"dboperations/view/BasePrices.view.xml":'<mvc:View\n    controllerName="dboperations.controller.BasePrices"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns="sap.m"\n    displayBlock="true"\n><Page id="_IDGenPageBP" title="Base Prices"><headerContent><Button id="btnAddBP" icon="sap-icon://add" text="Add Base Price" press="onAddBasePrice"/></headerContent><content><Table id="basePricesTable" items="{basePrices>/}" width="100%"><columns><Column id="_IDGenColumnBP1"><Text id="_IDGenTextBP1" text="Code"/></Column><Column id="_IDGenColumnBP2"><Text id="_IDGenTextBP2" text="Description"/></Column><Column id="_IDGenColumnBP3"><Text id="_IDGenTextBP3" text="Actions"/></Column></columns><items><ColumnListItem id="_IDGenColumnListItemBP1"><cells><Text id="_IDGenTextBP4" text="{basePrices>code}"/><Text id="_IDGenTextBP5" text="{basePrices>description}"/><HBox id="_IDGenHBoxBP1"><Button id="_IDGenButtonBP1" icon="sap-icon://edit" press="onEditBasePrice"/><Button id="_IDGenButtonBP2" icon="sap-icon://delete" type="Reject" press="onDeleteBasePrice"/></HBox></cells></ColumnListItem></items></Table></content></Page><Dialog id="basePriceDialog" title="Add/Edit Base Price" stretchOnPhone="true"><content><VBox id="_IDGenVBoxBP1" class="sapUiSmallMargin"><Label id="_IDGenLabelBP1" text="Code"/><Input id="_IDGenInputBP1" value="{local>/code}" editable="{= !${local>/isEdit}}" placeholder="Enter Code (e.g., BP01)"/><Label id="_IDGenLabelBP2" text="Description"/><Input id="_IDGenInputBP2" value="{local>/description}" placeholder="Enter Description"/></VBox></content><beginButton><Button id="_IDGenButtonBP3" text="Save" press="onSaveBasePrice"/></beginButton><endButton><Button id="_IDGenButtonBP4" text="Cancel" press="onCancelBasePrice"/></endButton></Dialog></mvc:View>',
	"dboperations/view/Buildings.view.xml":'<mvc:View\n    controllerName="dboperations.controller.Buildings"\n    xmlns="sap.m"\n    xmlns:mvc="sap.ui.core.mvc"><Page id="BuildingsPage" title="Buildings"><headerContent><Button\n                id="btnAddBuildings"\n                icon="sap-icon://add"\n                tooltip="Add"\n                text="New Building"\n                press="onAddBuilding" /></headerContent><content><ScrollContainer id="_IDGenScrollContainer"\n                horizontal="true"\n                vertical="false"\n                height="100%"\n                width="100%"\n                focusable="true"\n                class="noPaddingScroll"><Table\n                    id="buildingsTable"\n                    items="{ path: \'/Buildings\' }"\n                    width="150%"\n                    inset="false"\n                    class="noPaddingTable"><columns><Column id="_IDGenColumn"><Text id="_IDGenText" text="Building ID" /></Column><Column id="_IDGenColumn1"><Text id="_IDGenText1" text="Building Description" /></Column><Column id="_IDGenColumn2"><Text id="_IDGenText2" text="Building Old Code" /></Column><Column id="_IDGenColumn3"><Text id="_IDGenText3" text="Project ID" /></Column><Column id="_IDGenColumn4"><Text id="_IDGenText4" text="Project Description" /></Column><Column id="_IDGenColumn5"><Text id="_IDGenText5" text="Company Code ID" /></Column><Column id="_IDGenColumn6"><Text id="_IDGenText6" text="Company Code Description" /></Column><Column id="_IDGenColumn7"><Text id="_IDGenText7" text="Valid From" /></Column><Column id="_IDGenColumn8"><Text id="_IDGenText8" text="Valid To" /></Column><Column id="_IDGenColumn9"><Text id="_IDGenText9" text="Location" /></Column><Column id="_IDGenColumn10"><Text id="_IDGenText10" text="Business Area" /></Column><Column id="_IDGenColumn11"><Text id="_IDGenText11" text="Profit Center" /></Column><Column id="_IDGenColumn12"><Text id="_IDGenText12" text="Functional Area" /></Column><Column id="_IDGenColumn13"><Text id="_IDGenText13" text="Actions" /></Column></columns><items><ColumnListItem id="_IDGenColumnListItem"><cells><Text id="_IDGenText14" text="{buildingId}" /><Text id="_IDGenText15" text="{buildingDescription}" /><Text id="_IDGenText16" text="{buildingOldCode}" /><Text id="_IDGenText17" text="{projectId}" /><Text id="_IDGenText18" text="{projectDescription}" /><Text id="_IDGenText19" text="{companyCodeId}" /><Text id="_IDGenText20" text="{companyCodeDescription}" /><Text id="_IDGenText21" text="{validFrom}" /><Text id="_IDGenText22" text="{validTo}" /><Text id="_IDGenText23" text="{location}" /><Text id="_IDGenText24" text="{businessArea}" /><Text id="_IDGenText25" text="{profitCenter}" /><Text id="_IDGenText26" text="{functionalArea}" /><HBox id="_IDGenHBox"><Button id="_IDGenButton1" icon="sap-icon://information" tooltip="Details" press="onDetails" /><Button id="_IDGenButton2" icon="sap-icon://edit" tooltip="Edit" press="onEdit" /><Button id="_IDGenButton3" icon="sap-icon://sys-add" tooltip="Add Unit" press="onNavigateToAddUnit" /><Button id="_IDGenButton4" icon="sap-icon://delete" type="Reject" tooltip="Delete" press="onDelete" /></HBox></cells></ColumnListItem></items></Table></ScrollContainer></content></Page></mvc:View>\n',
	"dboperations/view/CalculationMethods.view.xml":'<mvc:View\n    controllerName="dboperations.controller.CalculationMethods"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns="sap.m"\n    displayBlock="true"\n><Page id="_IDGenPageCM" title="Calculation Methods"><headerContent><Button id="btnAddCM" icon="sap-icon://add" text="Add Calculation Method" press="onAddCalculationMethod"/></headerContent><content><Table id="calculationMethodsTable" items="{calculationMethods>/}" width="100%"><columns><Column id="_IDGenColumnCM1"><Text id="_IDGenTextCM1" text="Code"/></Column><Column id="_IDGenColumnCM2"><Text id="_IDGenTextCM2" text="Description"/></Column><Column id="_IDGenColumnCM3"><Text id="_IDGenTextCM3" text="Actions"/></Column></columns><items><ColumnListItem id="_IDGenColumnListItemCM1"><cells><Text id="_IDGenTextCM4" text="{calculationMethods>code}"/><Text id="_IDGenTextCM5" text="{calculationMethods>description}"/><HBox id="_IDGenHBoxCM1"><Button id="_IDGenButtonCM1" icon="sap-icon://edit" press="onEditCalculationMethod"/><Button id="_IDGenButtonCM2" icon="sap-icon://delete" type="Reject" press="onDeleteCalculationMethod"/></HBox></cells></ColumnListItem></items></Table></content></Page><Dialog id="calculationMethodDialog" title="Add/Edit Calculation Method" stretchOnPhone="true"><content><VBox id="_IDGenVBoxCM1" class="sapUiSmallMargin"><Label id="_IDGenLabelCM1" text="Code"/><Input id="_IDGenInputCM1" value="{local>/code}" editable="{= !${local>/isEdit}}" placeholder="Enter Code (e.g., CM01)"/><Label id="_IDGenLabelCM2" text="Description"/><Input id="_IDGenInputCM2" value="{local>/description}" placeholder="Enter Description"/></VBox></content><beginButton><Button id="_IDGenButtonCM3" text="Save" press="onSaveCalculationMethod"/></beginButton><endButton><Button id="_IDGenButtonCM4" text="Cancel" press="onCancelCalculationMethod"/></endButton></Dialog></mvc:View>',
	"dboperations/view/ConditionTypes.view.xml":'<mvc:View\n    controllerName="dboperations.controller.ConditionTypes"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns="sap.m"\n    displayBlock="true"\n><Page id="_IDGenPagej1" title="Condition Types"><headerContent><Button id="btnAdd" icon="sap-icon://add" text="Add Condition Type" press="onAddConditionType"/></headerContent><content><Table id="conditionTypesTable" items="{conditionTypes>/}" width="100%"><columns><Column id="_IDGenColumn1"><Text id="_IDGenText1" text="Code"/></Column><Column id="_IDGenColumn2"><Text id="_IDGenText2" text="Description"/></Column><Column id="_IDGenColumn3"><Text id="_IDGenText3" text="Actions"/></Column></columns><items><ColumnListItem id="_IDGenColumnListItem1"><cells><Text id="_IDGenText4" text="{conditionTypes>code}"/><Text id="_IDGenText5" text="{conditionTypes>description}"/><HBox id="_IDGenHBox1"><Button id="_IDGenButton1" icon="sap-icon://edit" press="onEditConditionType"/><Button id="_IDGenButton2" icon="sap-icon://delete" type="Reject" press="onDeleteConditionType"/></HBox></cells></ColumnListItem></items></Table></content></Page><Dialog id="conditionTypeDialog" title="Add/Edit Condition Type" stretchOnPhone="true"><content><VBox id="_IDGenVBox1" class="sapUiSmallMargin"><Label id="_IDGenLabel1" text="Code"/><Input id="_IDGenInput1" value="{local>/code}" editable="{= !${local>/isEdit}}" placeholder="Enter Code (e.g., CT01)"/><Label id="_IDGenLabel2" text="Description"/><Input id="_IDGenInput2" value="{local>/description}" placeholder="Enter Description"/></VBox></content><beginButton><Button id="_IDGenButton3" text="Save" press="onSaveConditionType"/></beginButton><endButton><Button id="_IDGenButton4" text="Cancel" press="onCancelConditionType"/></endButton></Dialog></mvc:View>',
	"dboperations/view/Conditions.view.xml":'<mvc:View\n    controllerName="dboperations.controller.Conditions"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns="sap.m"\n    displayBlock="true"\n><Page title="Conditions"><headerContent><Button icon="sap-icon://add" text="Add Condition" press="onAddCondition"/></headerContent><content><Table id="conditionsTable" items="{conditions>/}" width="100%"><columns><Column><Text text="Code"/></Column><Column><Text text="Description"/></Column><Column><Text text="Actions"/></Column></columns><items><ColumnListItem><cells><Text text="{conditions>code}"/><Text text="{conditions>description}"/><HBox><Button icon="sap-icon://edit" press="onEditCondition"/><Button icon="sap-icon://delete" type="Reject" press="onDeleteCondition"/></HBox></cells></ColumnListItem></items></Table></content><Dialog id="conditionDialog" title="Add/Edit Condition" stretchOnPhone="true"><VBox class="sapUiSmallMargin"><Label text="Code"/><Input value="{local>/code}" editable="{= !${local>/isEdit}}" placeholder="Enter Code"/><Label text="Description"/><Input value="{local>/description}" placeholder="Enter Description"/></VBox><beginButton><Button text="Save" press="onSaveCondition"/></beginButton><endButton><Button text="Cancel" press="onCancelCondition"/></endButton></Dialog></Page></mvc:View>\n',
	"dboperations/view/DBOperations.view.xml":'<mvc:View\n    controllerName="dboperations.controller.DBOperations"\n    xmlns="sap.m"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns:sap.m="sap.m"\n    xmlns:f="sap.f"\n    xmlns:w="sap.ui.integration.widgets"\n    xmlns:tnt="sap.tnt"\n    xmlns:form="sap.ui.layout.form"\n    xmlns:table="sap.ui.table"\n    xmlns:layout="sap.ui.layout"\n    xmlns:core="sap.ui.core"\n    xmlns:m="sap.m"\n    xmlns:u="sap.ui.unified"\n    xmlns:macros="sap.fe.macros"\n><Page\n        id="_IDGenPage3"\n        title="Real Estate App"\n    ><content><IconTabBar\n                id="_IDGenIconTabBar1"\n                class="sapUiResponsiveContentPadding"\n            ><items><IconTabFilter\n                        id="_IDGenIconTabFilterMain"\n                        text="Main Operations"\n                        icon="sap-icon://business-objects-experience"\n                    ><ScrollContainer\n                            id="_IDGenScrollContainerMain"\n                            horizontal="true"\n                            vertical="false"\n                            width="100%"\n                            height="auto"\n                        ><HBox id="_IDGenHBoxMain"><GenericTile\n                                    id="_IDGenGenericTile3"\n                                    class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout"\n                                    header="Projects"\n                                    press="onNavigateToProjects"\n                                ><TileContent\n                                        id="_IDGenTileContent2"\n                                        footer="Projects CRUD OPs"\n                                    ><ImageContent\n                                            id="_IDGenImageContent2"\n                                            src="sap-icon://workflow-tasks"\n                                        /></TileContent></GenericTile><GenericTile\n                                    id="_IDGenGenericTile1"\n                                    class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout"\n                                    header="Buildings"\n                                    press="onNavigateToBuildings"\n                                ><TileContent\n                                        id="_IDGenTileContent"\n                                        footer="Buildings CRUD OPs"\n                                    ><ImageContent\n                                            id="_IDGenImageContent"\n                                            src="sap-icon://building"\n                                        /></TileContent></GenericTile><GenericTile\n                                    id="_IDGenGenericTile2"\n                                    class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout"\n                                    header="Units"\n                                    press="onNavigateToUnits"\n                                ><TileContent\n                                        id="_IDGenTileContent1"\n                                        footer="Units CRUD OPs"\n                                    ><ImageContent\n                                            id="_IDGenImageContent1"\n                                            src="sap-icon://home"\n                                        /></TileContent></GenericTile><GenericTile\n                                    id="_IDGenGenericTile4"\n                                    class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout"\n                                    header="Payment Plans"\n                                    press="onNavigateToPaymentPlans"\n                                ><TileContent\n                                        id="_IDGenTileContent4"\n                                        footer="Payment Plans CRUD OPs"\n                                    ><ImageContent\n                                            id="_IDGenImageContent4"\n                                            src="sap-icon://money-bills"\n                                        /></TileContent></GenericTile><GenericTile\n                                    id="_IDGenGenericTile5"\n                                    class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout"\n                                    header="EOI"\n                                    press="onNavigateToEOI"\n                                ><TileContent\n                                        id="_IDGenTileContent5"\n                                        footer="EOI CRUD OPs"\n                                    ><ImageContent\n                                            id="_IDGenImageContent5"\n                                            src="sap-icon://favorite-list"\n                                        /></TileContent></GenericTile><GenericTile\n                                    id="_IDGenGenericTile6"\n                                    class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout"\n                                    header="Reservations"\n                                    press="onNavigateToReservations"\n                                ><TileContent\n                                        id="_IDGenTileContent6"\n                                        footer="Reservations CRUD OPs"\n                                    ><ImageContent\n                                            id="_IDGenImageContent6"\n                                            src="sap-icon://add-activity"\n                                        /></TileContent></GenericTile></HBox></ScrollContainer></IconTabFilter><IconTabFilter\n                        id="_IDGenIconTabFilterConfig"\n                        text="Configurations"\n                        icon="sap-icon://settings"\n                    ><ScrollContainer\n                            id="_IDGenScrollContainerConfig"\n                            horizontal="true"\n                            vertical="false"\n                            width="100%"\n                            height="auto"\n                        ><HBox id="_IDGenHBoxConfig"><GenericTile\n                                    id="_IDGenGenericTile8"\n                                    class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout"\n                                    header="Condition Types"\n                                    press="onNavigateToConditionTypes"\n                                ><TileContent\n                                        id="_IDGenTileContent8"\n                                        footer="Condition Types CRUD OPs"\n                                    ><ImageContent\n                                            id="_IDGenImageContent8"\n                                            src="sap-icon://fx"\n                                        /></TileContent></GenericTile><GenericTile\n                                    id="_IDGenGenericTile9"\n                                    class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout"\n                                    header="Calculation Methods"\n                                    press="onNavigateToCalculationMethods"\n                                ><TileContent\n                                        id="_IDGenTileContent9"\n                                        footer="Calculation Methods CRUD OPs"\n                                    ><ImageContent\n                                            id="_IDGenImageContent9"\n                                            src="sap-icon://measurement-document"\n                                        /></TileContent></GenericTile><GenericTile\n                                    id="_IDGenGenericTile10"\n                                    class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout"\n                                    header="Base Prices"\n                                    press="onNavigateToBasePrices"\n                                ><TileContent\n                                        id="_IDGenTileContent10"\n                                        footer="Base Prices CRUD OPs"\n                                    ><ImageContent\n                                            id="_IDGenImageContent10"\n                                            src="sap-icon://database"\n                                        /></TileContent></GenericTile><GenericTile\n                                    id="_IDGenGenericTile11"\n                                    class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout"\n                                    header="Frequencies"\n                                    press="onNavigateToFrequencies"\n                                ><TileContent\n                                        id="_IDGenTileContent11"\n                                        footer="Frequencies CRUD OPs"\n                                    ><ImageContent\n                                            id="_IDGenImageContent11"\n                                            src="sap-icon://date-time"\n                                        /></TileContent></GenericTile><GenericTile\n                                    id="_IDGenGenericTile12"\n                                    class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout"\n                                    header="Measurements"\n                                    press="onNavigateToMeasurements"\n                                ><TileContent\n                                        id="_IDGenTileContent12"\n                                        footer="Measurements CRUD OPs"\n                                    ><ImageContent\n                                            id="_IDGenImageContent12"\n                                            src="sap-icon://measure"\n                                        /></TileContent></GenericTile><GenericTile\n                                    id="_IDGenGenericTile13"\n                                    class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout"\n                                    header="Conditions"\n                                    press="onNavigateToConditions"\n                                ><TileContent\n                                        id="_IDGenTileContent13"\n                                        footer="Conditions CRUD OPs"\n                                    ><ImageContent\n                                            id="_IDGenImageContent13"\n                                            src="sap-icon://decision"\n                                        /></TileContent></GenericTile></HBox></ScrollContainer></IconTabFilter></items></IconTabBar></content></Page></mvc:View>\n',
	"dboperations/view/EOI.view.xml":'<mvc:View\n    controllerName="dboperations.controller.EOI"\n    xmlns="sap.m"\n    xmlns:mvc="sap.ui.core.mvc"\n    displayBlock="true"\n><Page\n        id="eoiPage"\n        title="EOI Management"\n    ><headerContent><Button\n                id="btnAddEOI"\n                icon="sap-icon://add"\n                text="New EOI"\n                press="onNavigateToAddEOI"\n            /></headerContent><VBox class="sapUiSizeCompact sapUiSmallMargin"><Table\n                id="eoiTable"\n                items="{ path: \'/EOI\' }"\n                mode="SingleSelect"\n                selectionChange="onSelectEOI"\n            ><columns><Column><Text text="EOI ID" /></Column><Column><Text text="EOI Type" /></Column><Column><Text text="Status" /></Column><Column><Text text="Date" /></Column><Column><Text text="Project ID" /></Column><Column><Text text="Total Value" /></Column><Column><Text text="Collected Amount" /></Column><Column><Text text="Remaining Amount" /></Column><Column><Text text="Actions" /></Column></columns><items><ColumnListItem><cells><Text text="{eoiId}" /><Text text="{eoiType}" /><Text text="{status}" /><Text text="{date}" /><Text text="{projectId}" /><Text text="{totalEoiValue}" /><Text text="{collectedAmount}" /><Text text="{remainingAmount}" /><HBox><Button\n                                    icon="sap-icon://information"\n                                    press="onDetails"\n                                /><Button\n                                    icon="sap-icon://edit"\n                                    press="onEditEOI"\n                                /><Button\n                                    icon="sap-icon://sys-add"\n                                    tooltip="Add Reservation"\n                                    press="onAddReservationFromEOI"\n                                /><Button\n                                    icon="sap-icon://delete"\n                                    type="Reject"\n                                    press="onDelete"\n                                /></HBox></cells></ColumnListItem></items></Table></VBox></Page></mvc:View>\n',
	"dboperations/view/Frequencies.view.xml":'<mvc:View\n    controllerName="dboperations.controller.Frequencies"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns="sap.m"\n    displayBlock="true"\n><Page id="_IDGenPageFR" title="Frequencies"><headerContent><Button id="btnAddFR" icon="sap-icon://add" text="Add Frequency" press="onAddFrequency"/></headerContent><content><Table id="frequenciesTable" items="{frequencies>/}" width="100%"><columns><Column id="_IDGenColumnFR1"><Text id="_IDGenTextFR1" text="Code"/></Column><Column id="_IDGenColumnFR2"><Text id="_IDGenTextFR2" text="Description"/></Column><Column id="_IDGenColumnFR3"><Text id="_IDGenTextFR3" text="Actions"/></Column></columns><items><ColumnListItem id="_IDGenColumnListItemFR1"><cells><Text id="_IDGenTextFR4" text="{frequencies>code}"/><Text id="_IDGenTextFR5" text="{frequencies>description}"/><HBox id="_IDGenHBoxFR1"><Button id="_IDGenButtonFR1" icon="sap-icon://edit" press="onEditFrequency"/><Button id="_IDGenButtonFR2" icon="sap-icon://delete" type="Reject" press="onDeleteFrequency"/></HBox></cells></ColumnListItem></items></Table></content></Page><Dialog id="frequencyDialog" title="Add/Edit Frequency" stretchOnPhone="true"><content><VBox id="_IDGenVBoxFR1" class="sapUiSmallMargin"><Label id="_IDGenLabelFR1" text="Code"/><Input id="_IDGenInputFR1" value="{local>/code}" editable="{= !${local>/isEdit}}" placeholder="Enter Code (e.g., FR01)"/><Label id="_IDGenLabelFR2" text="Description"/><Input id="_IDGenInputFR2" value="{local>/description}" placeholder="Enter Description"/></VBox></content><beginButton><Button id="_IDGenButtonFR3" text="Save" press="onSaveFrequency"/></beginButton><endButton><Button id="_IDGenButtonFR4" text="Cancel" press="onCancelFrequency"/></endButton></Dialog></mvc:View>\n',
	"dboperations/view/Measurements.view.xml":'<mvc:View\n    controllerName="dboperations.controller.Measurements"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns="sap.m"\n    displayBlock="true"\n><Page title="Measurements"><headerContent><Button icon="sap-icon://add" text="Add Measurement" press="onAddMeasurement"/></headerContent><content><Table id="measurementsTable" items="{measurements>/}" width="100%"><columns><Column><Text text="Code"/></Column><Column><Text text="Description"/></Column><Column><Text text="Actions"/></Column></columns><items><ColumnListItem><cells><Text text="{measurements>code}"/><Text text="{measurements>description}"/><HBox><Button icon="sap-icon://edit" press="onEditMeasurement"/><Button icon="sap-icon://delete" type="Reject" press="onDeleteMeasurement"/></HBox></cells></ColumnListItem></items></Table></content><Dialog id="measurementDialog" title="Add/Edit Measurement" stretchOnPhone="true"><VBox class="sapUiSmallMargin"><Label text="Code"/><Input value="{local>/code}" editable="{= !${local>/isEdit}}" placeholder="Enter Code"/><Label text="Description"/><Input value="{local>/description}" placeholder="Enter Description"/></VBox><beginButton><Button text="Save" press="onSaveMeasurement"/></beginButton><endButton><Button text="Cancel" press="onCancelMeasurement"/></endButton></Dialog></Page></mvc:View>\n',
	"dboperations/view/PaymentPlanSimulations.view.xml":'<mvc:View\n    controllerName="dboperations.controller.PaymentPlanSimulations"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns="sap.m"\n    xmlns:core="sap.ui.core"\n    displayBlock="true"\n><Page id="_IDGenPageSim" title="Payment Plan Simulation"><content><VBox id="_IDGenVBoxSim" class="sapUiSmallMargin"><Title id="_IDGenTitle3" text="Simulation Details" level="H3"/><Label id="_IDGenLabel6" text="Simulation ID"/><Input id="simulationIdInput" value="{local>/simulationId}" editable="false" placeholder="Auto-generated"/><Label id="_IDGenLabel7" text="Unit"/><Input\n                    id="unitIdInput"\n                    value="{local>/unitDisplay}"\n                    showValueHelp="true"\n                    valueHelpRequest="onOpenUnitValueHelp"\n                    placeholder="Search unit..."\n                /><Label id="_IDGenLabel8" text="Project ID"/><Input id="projectIdInput" value="{local>/projectId}" editable="false"/><Label id="_IDGenLabel9" text="Project Description"/><Input id="projectDescriptionInput" value="{local>/projectDescription}" editable="false" placeholder="Description"/><Label id="_IDGenLabel10" text="Price Plan (Years)"/><Input id="pricePlanInput" type="Number" change="onPricePlanChange" placeholder="e.g., 5"/><Label id="_IDGenLabel11" text="Payment Plan ID"/><Input id="paymentPlanIdInput" value="{local>/paymentPlanId}" editable="false"/><Label id="_IDGenLabel12" text="Lead ID"/><Input id="leadIdInput" value="{local>/leadId}" placeholder="Enter code"/><Label id="_IDGenLabel13" text="Final Price"/><Input id="finalPriceInput" value="{local>/finalPrice}" editable="false"/><Label id="_IDGenLabel14" text="User"/><Input id="userIdInput" value="currentUser" editable="false"/><HBox id="_IDGenHBox4"><Button id="_IDGenButtonSimulate" text="Simulate" press="onSimulate"/><Button id="_IDGenButtonSave" text="Save Simulation" press="onSaveSimulation"/></HBox><Title id="_IDGenTitle4" text="Payment Schedule" level="H3"/><Table id="simulationTable" items="{simulationOutput>/}" width="100%" showSeparators="All"><columns><Column id="_IDGenColumn24"><header><Label id="_IDGenLabel15" text="Condition Type"/></header></Column><Column id="_IDGenColumn65"><header><Label id="_IDGenLabel16" text="Due Date"/></header></Column><Column id="_IDGenColumn66"><header><Label id="_IDGenLabel17" text="Amount"/></header></Column><Column id="_IDGenColumn67"><header><Label id="_IDGenLabel18" text="Maintenance"/></header></Column></columns><items><ColumnListItem id="_IDGenColumnListItem6"><cells><Text id="_IDGenText44" text="{simulationOutput>conditionType}"/><Text id="_IDGenText116" text="{simulationOutput>dueDate}"/><Text id="_IDGenText117" text="{simulationOutput>amount}"/><Text id="_IDGenText118" text="{simulationOutput>maintenance}"/></cells></ColumnListItem></items></Table></VBox></content></Page></mvc:View>\n',
	"dboperations/view/PaymentPlans.view.xml":'<mvc:View\ncontrollerName="dboperations.controller.PaymentPlans"\nxmlns:mvc="sap.ui.core.mvc"\nxmlns="sap.m"\ndisplayBlock="true"\n><Page id="_IDPPGenPage1" title="Payment Plans"><headerContent><Button id="btnAddPaymentPlan" icon="sap-icon://add" text="New Payment Plan" press="onAddPlan"/></headerContent><content><ScrollContainer id="_IDGenScrollContainer2" horizontal="true" vertical="false" width="100%" height="100%"><Table id="plansTable" items="{plans>/}" width="120%"><columns><Column id="_IDGenColumn14"><Text id="_IDGenText27" text="Plan ID"/></Column><Column id="_IDGenColumn15"><Text id="_IDGenText28" text="Description"/></Column><Column id="_IDGenColumn16"><Text id="_IDGenText29" text="Company Code"/></Column><Column id="_IDGenColumn17"><Text id="_IDGenText30" text="Years"/></Column><Column id="_IDGenColumn18"><Text id="_IDGenText31" text="Valid From"/></Column><Column id="_IDGenColumn19"><Text id="_IDGenText32" text="Valid To"/></Column><Column id="_IDGenColumn20"><Text id="_IDGenText33" text="Status"/></Column><Column id="_IDGenColumn21"><Text id="_IDGenText34" text="Actions"/></Column></columns><items><ColumnListItem id="_IDGenColumnListItempayment"><cells><Text id="_IDGenText35" text="{plans>paymentPlanId}"/><Text id="_IDGenText36" text="{plans>description}"/><Text id="_IDGenText37" text="{plans>companyCodeId}"/><Text id="_IDGenText38" text="{plans>planYears}"/><Text id="_IDGenText39" text="{plans>validFrom}"/><Text id="_IDGenText40" text="{plans>validTo}"/><Text id="_IDGenText41" text="{plans>planStatus}"/><HBox id="_IDGenHBoxpayment"><Button id="_IDGenButton" icon="sap-icon://information" press="onShowPlanDetails"/><Button id="_IDGenButton5" icon="sap-icon://edit" press="onEditPlan"/><Button id="_IDGenButton6" icon="sap-icon://delete" type="Reject" press="onDeletePlan"/></HBox></cells></ColumnListItem></items></Table></ScrollContainer></content></Page><Dialog id="planDialog" title="Add / Edit Payment Plan"><content><VBox id="_IDGenVBox" class="sapUiSmallMargin"><Label id="_IDGenLabel" text="Company Code ID"/><Input id="_IDGenInput" value="{local>/companyCodeId}"/><Label id="_IDGenLabel1payment" text="Description"/><Input id="_IDGenInput1payment" value="{local>/description}"/><Label id="_IDGenLabel2payment" text="Plan Years"/><Input id="_IDGenInput2payment" value="{local>/planYears}" type="Number"/><Label id="_IDGenLabel3" text="Valid From"/><DatePicker id="_IDGenDatePicker" value="{local>/validFrom}" displayFormat="yyyy-MM-dd" valueFormat="yyyy-MM-dd"/><Label id="_IDGenLabel4" text="Valid To"/><DatePicker id="_IDGenDatePicker1" value="{local>/validTo}" displayFormat="yyyy-MM-dd" valueFormat="yyyy-MM-dd"/><Label id="_IDGenLabel5" text="Plan Status"/><Input id="_IDGenInput3" value="{local>/planStatus}" showValueHelp="true" valueHelpRequest=".onOpenPlanStatusVHD" placeholder="Select Status"/><Title id="_IDGenTitle" text="Schedules" level="H3"/><Toolbar id="_IDGenToolbar"><Button id="_IDGenButton7" text="Add Row" icon="sap-icon://add" press="onAddScheduleRow"/><Button id="_IDGenButton8" text="Delete Row" icon="sap-icon://delete" press="onDeleteScheduleRow"/></Toolbar><Table id="scheduleTable" items="{path: \'local>/schedules\'}"><columns><Column id="_IDGenColumn22"><Text id="_IDGenText42" text="Condition Type"/></Column><Column id="_IDGenColumn23"><Text id="_IDGenText43" text="Base Price"/></Column><Column id="_IDGenColumn25"><Text id="_IDGenText45" text="Frequency"/></Column><Column id="_IDGenColumn26"><Text id="_IDGenText46" text="%"/></Column><Column id="_IDGenColumn27"><Text id="_IDGenText47" text="Due (Months)"/></Column><Column id="_IDGenColumn28"><Text id="_IDGenText48" text="Installments"/></Column><Column id="_IDGenColumn29"><Text id="_IDGenText49" text="Years"/></Column></columns><items><ColumnListItem id="_IDGenColumnListItem2"><cells><Input id="_IDGenInput4" value="{local>conditionType/description}" showValueHelp="true"\n                               valueHelpRequest=".onOpenConditionTypeVHD" placeholder="Select Condition Type"/><Input id="_IDGenInput5" value="{local>basePrice/description}" showValueHelp="true"\n                                   valueHelpRequest=".onOpenBasePriceVHD" placeholder="Select Base Price"/><Input id="_IDGenInput7" value="{local>frequency/description}" showValueHelp="true"\n                       valueHelpRequest=".onOpenFrequencyVHD" placeholder="Select Frequency" change=".onFrequencyChange"/><Input id="_IDGenInput8" value="{local>percentage}" type="Number"/><Input id="_IDGenInput9" value="{local>dueInMonth}" type="Number"/><Input id="_IDGenInput10" value="{local>numberOfInstallments}" type="Number" editable="false"/><Input id="_IDGenInput11" value="{local>numberOfYears}" type="Number" change=".onYearsChange"/></cells></ColumnListItem></items></Table><Title id="_IDGenTitle1" text="Assigned Projects" level="H3"/><Toolbar id="_IDGenToolbar1"><Button id="_IDGenButton9" text="Add Row" icon="sap-icon://add" press="onAddProjectRow"/><Button id="_IDGenButton10" text="Delete Row" icon="sap-icon://delete" press="onDeleteProjectRow"/></Toolbar><Table id="projectspTable" items="{path: \'local>/projects\'}"><columns><Column id="_IDGenColumn30"><Text id="_IDGenText50" text="Project ID"/></Column><Column id="_IDGenColumn31"><Text id="_IDGenText51" text="Project Description"/></Column></columns><items><ColumnListItem id="_IDGenColumnListItem3"><cells><Input id="_IDGenInput12" value="{local>projectId}" showValueHelp="true"\n                                   valueHelpRequest=".onOpenProjectVHD" placeholder="Select Project"/><Input id="_IDGenInput13" value="{local>projectDescription}" editable="false"/></cells></ColumnListItem></items></Table></VBox></content><beginButton><Button id="_IDGenButton11" text="Save" press="onSavePlan"/></beginButton><endButton><Button id="_IDGenButton12" text="Cancel" press="onCancelPlan"/></endButton></Dialog></mvc:View>',
	"dboperations/view/Projects.view.xml":'<mvc:View\n    controllerName="dboperations.controller.Projects"\n    xmlns="sap.m"\n    xmlns:mvc="sap.ui.core.mvc"\n><Page\n        id="ProjectsPage"\n        title="Projects"\n    ><headerContent><Button\n                id="btnAddProject"\n                icon="sap-icon://add"\n                tooltip="Add"\n                text="New Project"\n                press="onNavigateToAddProject"\n            /></headerContent><content><ScrollContainer id="_IDGenScrollContainer3"\n                horizontal="true"\n                vertical="false"\n                height="100%"\n                width="100%"\n                focusable="true"\n            ><Table\n                    id="projectsTable"\n                    items="{ path: \'/Projects\' }"\n                    width="150%"\n                ><columns><Column id="_IDGenColumn32"><Text id="_IDGenText52" text="Project ID" /></Column><Column id="_IDGenColumn33"><Text id="_IDGenText53" text="Project Description" /></Column><Column id="_IDGenColumn34"><Text id="_IDGenText54" text="Company Code ID" /></Column><Column id="_IDGenColumn35"><Text id="_IDGenText55" text="Company Code Description" /></Column><Column id="_IDGenColumn36"><Text id="_IDGenText56" text="Valid From" /></Column><Column id="_IDGenColumn37"><Text id="_IDGenText57" text="Valid To" /></Column><Column id="_IDGenColumn38"><Text id="_IDGenText58" text="Location" /></Column><Column id="_IDGenColumn39"><Text id="_IDGenText59" text="Business Area" /></Column><Column id="_IDGenColumn40"><Text id="_IDGenText60" text="Profit Center" /></Column><Column id="_IDGenColumn41"><Text id="_IDGenText61" text="Functional Area" /></Column><Column id="_IDGenColumn42"><Text id="_IDGenText62" text="Supplementary Text" /></Column><Column id="_IDGenColumn43"><Text id="_IDGenText63" text="Actions" /></Column></columns><items><ColumnListItem id="_IDGenColumnListItem4"><cells><Text id="_IDGenText64" text="{projectId}" /><Text id="_IDGenText65" text="{projectDescription}" /><Text id="_IDGenText66" text="{companyCodeId}" /><Text id="_IDGenText67" text="{companyCodeDescription}" /><Text id="_IDGenText68" text="{validFrom}" /><Text id="_IDGenText69" text="{validTo}" /><Text id="_IDGenText70" text="{location}" /><Text id="_IDGenText71" text="{businessArea}" /><Text id="_IDGenText72" text="{profitCenter}" /><Text id="_IDGenText73" text="{functionalArea}" /><Text id="_IDGenText74" text="{supplementaryText}" /><HBox id="_IDGenHBox2"><Button id="_IDGenButton13" icon="sap-icon://information" tooltip="Details" press="onDetails" /><Button id="_IDGenButton14" icon="sap-icon://edit" tooltip="Edit" press="onEditProject" /><Button id="_IDGenButton15" icon="sap-icon://sys-add" tooltip="Add Building" press="onAddBuilding" /><Button id="_IDGenButton16" icon="sap-icon://delete" type="Reject" tooltip="Delete" press="onDelete" /></HBox></cells></ColumnListItem></items></Table></ScrollContainer></content></Page></mvc:View>\n',
	"dboperations/view/Reservations.view.xml":'<mvc:View\n    controllerName="dboperations.controller.Reservations"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns="sap.m"\n    displayBlock="true"><Page id="_IDGenPage1" title="Reservations"><headerContent><Button\n                id="btnAddReservation"\n                icon="sap-icon://add"\n                tooltip="Add"\n                text="New Reservation"\n                press="onAddReservation"\n            /></headerContent><content><ScrollContainer\n                horizontal="true"\n                vertical="false"\n                width="100%"\n                height="100%"\n                focusable="true"\n                class="noPaddingScroll"><Table\n                    id="reservationsTable"\n                    items="{reservations>/}"\n                    mode="SingleSelectMaster"\n                    width="120%"\n                    inset="false"\n                    class="noPaddingTable"><columns><Column><Text text="Reservation ID"/></Column><Column><Text text="Company Code"/></Column><Column><Text text="Old Reservation ID"/></Column><Column><Text text="EOI ID"/></Column><Column><Text text="Description"/></Column><Column><Text text="Sales Type"/></Column><Column><Text text="Valid From"/></Column><Column><Text text="Customer Type"/></Column><Column><Text text="Currency"/></Column><Column><Text text="After Sales"/></Column><Column><Text text="Status"/></Column><Column><Text text="Actions"/></Column></columns><items><ColumnListItem><cells><Text text="{reservations>reservationId}"/><Text text="{reservations>companyCodeId}"/><Text text="{reservations>oldReservationId}"/><Text text="{reservations>eoiId}"/><Text text="{reservations>description}"/><Text text="{reservations>salesType}"/><Text text="{reservations>validFrom}"/><Text text="{reservations>customerType}"/><Text text="{reservations>currency}"/><Text text="{reservations>afterSales}"/><Text text="{reservations>status}"/><HBox><Button icon="sap-icon://information" tooltip="Details" press="onShowReservationDetails"/><Button icon="sap-icon://edit" tooltip="Edit" press="onEditReservation"/><Button icon="sap-icon://delete" type="Reject" tooltip="Delete" press="onDeleteReservation"/></HBox></cells></ColumnListItem></items></Table></ScrollContainer></content></Page><Dialog id="reservationDialog" title="Add / Edit Reservation" stretchOnPhone="true"><content><VBox class="sapUiSmallMargin"><Label text="Company Code ID"/><Input value="{local>/companyCodeId}"/><Label text="Old Reservation ID"/><Input value="{local>/oldReservationId}"/><Label text="EOI ID"/><Input value="{local>/eoiId}"/><Label text="Sales Type"/><Input value="{local>/salesType}"/><Label text="Description"/><Input value="{local>/description}"/><Label text="Valid From"/><DatePicker value="{local>/validFrom}" displayFormat="yyyy-MM-dd" valueFormat="yyyy-MM-dd"/><Label text="Status"/><Input value="{local>/status}" placeholder="A / I"/><Label text="Customer Type"/><Input value="{local>/customerType}"/><Label text="Currency"/><Input value="{local>/currency}"/><Label text="After Sales"/><Input value="{local>/afterSales}"/><Label text="Project ID"/><Input value="{local>/project_projectId}"/><Label text="Building ID"/><Input value="{local>/building_buildingId}"/><Label text="Unit ID"/><Input value="{local>/unit_unitId}"/><Label text="BUA"/><Input value="{local>/bua}" type="Number"/><Label text="Phase"/><Input value="{local>/phase}"/><Label text="Price Plan Years"/><Input value="{local>/pricePlanYears}" type="Number"/><Label text="Payment Plan ID"/><Input value="{local>/paymentPlan_paymentPlanId}"/><Label text="Plan Years"/><Input value="{local>/planYears}" type="Number"/><Label text="Unit Price"/><Input value="{local>/unitPrice}" type="Number"/><Label text="Plan Currency"/><Input value="{local>/planCurrency}"/><Label text="Request Type"/><Input value="{local>/requestType}"/><Label text="Reason"/><Input value="{local>/reason}"/><Label text="Cancellation Date"/><DatePicker value="{local>/cancellationDate}" displayFormat="yyyy-MM-dd" valueFormat="yyyy-MM-dd"/><Label text="Cancellation Status"/><Input value="{local>/cancellationStatus}"/><Label text="Rejection Reason"/><Input value="{local>/rejectionReason}"/><Label text="Cancellation Fees"/><Input value="{local>/cancellationFees}" type="Number"/><Title text="Payments" level="H3"/><Toolbar><Button text="Add Row" icon="sap-icon://add" press="onAddPaymentRow"/><Button text="Delete Row" icon="sap-icon://delete" press="onDeletePaymentRow"/></Toolbar><Table id="paymentsTable" items="{path: \'local>/payments\'}" inset="false"><columns><Column><Text text="Receipt Type"/></Column><Column><Text text="Receipt Status"/></Column><Column><Text text="Payment Method"/></Column><Column><Text text="Amount"/></Column><Column><Text text="House Bank"/></Column><Column><Text text="Bank Account"/></Column><Column><Text text="Due Date"/></Column><Column><Text text="Transfer Number"/></Column><Column><Text text="Check Number"/></Column><Column><Text text="Customer Bank"/></Column><Column><Text text="Customer Bank Account"/></Column><Column><Text text="Branch"/></Column><Column><Text text="Collected Amount"/></Column><Column><Text text="AR Validated"/></Column><Column><Text text="Rejection Reason"/></Column></columns><items><ColumnListItem><cells><Input value="{local>receiptType}"/><Input value="{local>receiptStatus}"/><Input value="{local>paymentMethod}"/><Input value="{local>amount}" type="Number"/><Input value="{local>houseBank}"/><Input value="{local>bankAccount}"/><DatePicker value="{local>dueDate}" displayFormat="yyyy-MM-dd" valueFormat="yyyy-MM-dd"/><Input value="{local>transferNumber}"/><Input value="{local>checkNumber}"/><Input value="{local>customerBank}"/><Input value="{local>customerBankAccount}"/><Input value="{local>branch}"/><Input value="{local>collectedAmount}" type="Number"/><CheckBox selected="{local>arValidated}"/><Input value="{local>rejectionReason}"/></cells></ColumnListItem></items></Table><Title text="Partners" level="H3"/><Toolbar><Button text="Add Row" icon="sap-icon://add" press="onAddPartnerRow"/><Button text="Delete Row" icon="sap-icon://delete" press="onDeletePartnerRow"/></Toolbar><Table id="partnersTable" items="{path: \'local>/partners\'}" inset="false"><columns><Column><Text text="Customer Code"/></Column><Column><Text text="Customer Name"/></Column><Column><Text text="Customer Address"/></Column><Column><Text text="Valid From"/></Column></columns><items><ColumnListItem><cells><Input value="{local>customerCode}"/><Input value="{local>customerName}"/><Input value="{local>customerAddress}"/><DatePicker value="{local>validFrom}" displayFormat="yyyy-MM-dd" valueFormat="yyyy-MM-dd"/></cells></ColumnListItem></items></Table><Title text="Conditions" level="H3"/><Toolbar><Button text="Add Row" icon="sap-icon://add" press="onAddConditionRow"/><Button text="Delete Row" icon="sap-icon://delete" press="onDeleteConditionRow"/></Toolbar><Table id="conditionsTable" items="{path: \'local>/conditions\'}" inset="false"><columns><Column><Text text="Condition Type"/></Column><Column><Text text="Amount"/></Column><Column><Text text="Currency"/></Column><Column><Text text="Frequency"/></Column><Column><Text text="Valid From"/></Column><Column><Text text="Valid To"/></Column></columns><items><ColumnListItem><cells><Input value="{local>conditionType}"/><Input value="{local>amount}" type="Number"/><Input value="{local>currency}"/><Input value="{local>frequency}"/><DatePicker value="{local>validFrom}" displayFormat="yyyy-MM-dd" valueFormat="yyyy-MM-dd"/><DatePicker value="{local>validTo}" displayFormat="yyyy-MM-dd" valueFormat="yyyy-MM-dd"/></cells></ColumnListItem></items></Table></VBox></content><beginButton><Button text="Save" type="Emphasized" press="onSaveReservation"/></beginButton><endButton><Button text="Cancel" press="onCancelReservation"/></endButton></Dialog></mvc:View>\n',
	"dboperations/view/Units.view.xml":'<mvc:View\n    controllerName="dboperations.controller.Units"\n    xmlns="sap.m"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns:core="sap.ui.core"\n    xmlns:l="sap.ui.layout"\n    xmlns:f="sap.f"\n><Page\n        id="unitsPage"\n        title="Units"\n    ><headerContent><Button\n                id="btnAddUnit"\n                icon="sap-icon://add"\n                text="New Unit"\n                press="onNavigateToAddUnit"\n            /></headerContent><content><Panel\n                id="_IDGenPanel"\n                backgroundDesign="Transparent"\n                class="sapUiSmallMargin"\n            ><Panel\n                    id="_IDGenPanel1"\n                    expandable="true"\n                    expanded="true"\n                    headerText="Header Data"\n                ><l:Grid\n                        id="_IDGenGrid"\n                        class="sapUiSmallMarginTop sapUiSmallMarginBottom"\n                        vSpacing="1"\n                        hSpacing="1"\n                    ><Label\n                            id="_IDGenLabel19"\n                            text="Unit Type:"\n                            labelFor="unitTypeFilter"\n                        /><Select\n                            id="unitTypeFilter"\n                            items="{\n                                path: \'view>/UnitType\',\n                                templateShareable: false\n                            }"\n                        ><core:Item\n                                id="_IDGenItem"\n                                key="{view>type}"\n                                text="{view>type}"\n                            /></Select><Label\n                            id="_IDGenLabel20"\n                            text="Company Code:"\n                            labelFor="companyCodeFilter"\n                        /><Select\n                            id="companyCodeFilter"\n                            items="{\n                                path: \'companyCodesList>/\',\n                                templateShareable: false\n                            }"\n                            change="onCompanyCodeChange"\n                        ><core:Item\n                                id="_IDGenItem1"\n                                key="{companyCodesList>companyCodeId}"\n                                text="{companyCodesList>companyCodeId}"\n                            /></Select><Label\n                            id="_IDGenLabel21"\n                            text="Project ID:"\n                            labelFor="projectIdFilter"\n                        /><Select\n                            id="projectIdFilter"\n                            items="{\n                                path: \'projectsList>/\',\n                                templateShareable: false\n                            }"\n                        ><core:Item\n                                id="_IDGenItem2"\n                                key="{projectsList>projectId}"\n                                text="{projectsList>projectId}"\n                            /></Select><Label\n                            id="_IDGenLabel22"\n                            text="Lead ID:"\n                            labelFor="_IDGenInput6"\n                        /><Input\n                            id="_IDGenInput6"\n                            placeholder="e.g. L12345"\n                        /><Label\n                            id="_IDGenLabel23"\n                            text="From Floor:"\n                            labelFor="_IDGenInput17"\n                        /><Input\n                            id="_IDGenInput17"\n                            type="Number"\n                            placeholder="e.g. 1"\n                        /><Label\n                            id="_IDGenLabel24"\n                            text="To Floor:"\n                            labelFor="_IDGenInput18"\n                        /><Input\n                            id="_IDGenInput18"\n                            type="Number"\n                            placeholder="e.g. 10"\n                        /></l:Grid></Panel><Panel\n                    id="_IDGenPanel2"\n                    expandable="true"\n                    expanded="false"\n                    headerText="Measurement Criteria"\n                ><l:Grid\n                        id="_IDGenGrid1"\n                        class="sapUiSmallMarginTop sapUiSmallMarginBottom"\n                        vSpacing="1"\n                        hSpacing="1"\n                    ><Label\n                            id="_IDGenLabel25"\n                            text="Measurement ID:"\n                            labelFor="measurementFilter"\n                        /><Select\n                            id="measurementFilter"\n                            items="{\n                                path: \'measurementsList>/\',\n                                templateShareable: false\n                            }"\n                        ><core:Item\n                                id="_IDGenItem3"\n                                key="{measurementsList>code}"\n                                text="{measurementsList>code}"\n                            /></Select><Label\n                            id="_IDGenLabel26"\n                            text="From:"\n                            labelFor="_IDGenInput15"\n                        /><Input\n                            id="_IDGenInput15"\n                            type="Number"\n                            placeholder="Min value"\n                        /><Label\n                            id="_IDGenLabel27"\n                            text="To:"\n                            labelFor="_IDGenInput16"\n                        /><Input\n                            id="_IDGenInput16"\n                            type="Number"\n                            placeholder="Max value"\n                        /><Label\n                            id="_IDGenLabel28"\n                            text="UOM:"\n                            labelFor="_IDGenInput19"\n                        /><Input\n                            id="_IDGenInput19"\n                            placeholder="e.g. m², ft²"\n                        /></l:Grid></Panel><Panel\n                    id="_IDGenPanel3"\n                    expandable="true"\n                    expanded="false"\n                    headerText="Price Plan"\n                ><l:Grid\n                        id="_IDGenGrid2"\n                        defaultSpan="L6 M12 S12"\n                        class="sapUiSmallMarginTop sapUiSmallMarginBottom"\n                        vSpacing="1"\n                        hSpacing="1"\n                    ><Label\n                            id="_IDGenLabel29"\n                            text="Price Plan Years:"\n                            labelFor="_IDGenInput20"\n                        /><Input\n                            id="_IDGenInput20"\n                            type="Number"\n                            placeholder="e.g. 5yrs"\n                        /><Label\n                            id="_IDGenLabel30"\n                            text="Currency:"\n                            labelFor="_IDGenInput21"\n                        /><Input\n                            id="_IDGenInput21"\n                            placeholder="e.g. USD, EUR"\n                        /></l:Grid></Panel><Toolbar id="_IDGenToolbar2"><ToolbarSpacer id="_IDGenToolbarSpacer" /><Button\n                        id="_IDGenButton18"\n                        text="Reset"\n                        type="Transparent"\n                        press="onClearFilter"\n                    /><Button\n                        id="_IDGenButton19"\n                        text="Search"\n                        type="Emphasized"\n                        press="onFilterUnits"\n                    /></Toolbar></Panel><ScrollContainer\n                id="_IDGenScrollContainer1"\n                horizontal="true"\n                vertical="false"\n                height="100%"\n                width="100%"\n                focusable="true"\n            ><Table\n                    id="unitsTable"\n                    items="{ path: \'/Units\' }"\n                    width="150%"\n                    class="sapUiSmallMarginTop"\n                ><columns><Column id="_IDGenColumn44"><Text\n                                id="_IDGenText75"\n                                text="Company Code ID"\n                            /></Column><Column id="_IDGenColumn45"><Text\n                                id="_IDGenText76"\n                                text="Company Code Desc."\n                            /></Column><Column id="_IDGenColumn46"><Text\n                                id="_IDGenText77"\n                                text="Project ID"\n                            /></Column><Column id="_IDGenColumn47"><Text\n                                id="_IDGenText78"\n                                text="Project Desc."\n                            /></Column><Column id="_IDGenColumn48"><Text\n                                id="_IDGenText79"\n                                text="Building ID"\n                            /></Column><Column id="_IDGenColumn49"><Text\n                                id="_IDGenText80"\n                                text="Unit ID"\n                            /></Column><Column id="_IDGenColumn50"><Text\n                                id="_IDGenText81"\n                                text="Unit Desc."\n                            /></Column><Column id="_IDGenColumn51"><Text\n                                id="_IDGenText82"\n                                text="Unit Type"\n                            /></Column><Column id="_IDGenColumn52"><Text\n                                id="_IDGenText83"\n                                text="Usage Type"\n                            /></Column><Column id="_IDGenColumn53"><Text\n                                id="_IDGenText84"\n                                text="Unit Status"\n                            /></Column><Column id="_IDGenColumn54"><Text\n                                id="_IDGenText85"\n                                text="Floor"\n                            /></Column><Column id="_IDGenColumn55"><Text\n                                id="_IDGenText86"\n                                text="Zone"\n                            /></Column><Column id="_IDGenColumn56"><Text\n                                id="_IDGenText87"\n                                text="Sales Phase"\n                            /></Column><Column id="_IDGenColumn57"><Text\n                                id="_IDGenText88"\n                                text="Finishing Spex"\n                            /></Column><Column id="_IDGenColumn58"><Text\n                                id="_IDGenText89"\n                                text="Delivery Date"\n                            /></Column><Column id="_IDGenColumn59"><Text\n                                id="_IDGenText90"\n                                text="Profit Center"\n                            /></Column><Column id="_IDGenColumn60"><Text\n                                id="_IDGenText91"\n                                text="Functional Area"\n                            /></Column><Column id="_IDGenColumn61"><Text\n                                id="_IDGenText92"\n                                text="Suppl. Text"\n                            /></Column><Column id="_IDGenColumn62"><Text\n                                id="_IDGenText93"\n                                text="Built Up Area"\n                            /></Column><Column id="_IDGenColumn63"><Text\n                                id="_IDGenText94"\n                                text="Original Price"\n                            /></Column><Column id="_IDGenColumn64"><Text\n                                id="_IDGenText95"\n                                text="Actions"\n                            /></Column><Column\n                            id="_IDGenColumn68"\n                            width="120px"\n                        ><Text\n                                id="_IDGenText96"\n                                text="Reservation"\n                            /></Column></columns><items><ColumnListItem id="_IDGenColumnListItem5"><cells><Text\n                                    id="_IDGenText97"\n                                    text="{companyCodeId}"\n                                /><Text\n                                    id="_IDGenText98"\n                                    text="{companyCodeDescription}"\n                                /><Text\n                                    id="_IDGenText99"\n                                    text="{projectId}"\n                                /><Text\n                                    id="_IDGenText100"\n                                    text="{projectDescription}"\n                                /><Text\n                                    id="_IDGenText101"\n                                    text="{buildingId}"\n                                /><Text\n                                    id="_IDGenText102"\n                                    text="{unitId}"\n                                /><Text\n                                    id="_IDGenText103"\n                                    text="{unitDescription}"\n                                /><Text\n                                    id="_IDGenText104"\n                                    text="{unitTypeDescription}"\n                                /><Text\n                                    id="_IDGenText105"\n                                    text="{usageTypeDescription}"\n                                /><Text\n                                    id="_IDGenText106"\n                                    text="{unitStatusDescription}"\n                                /><Text\n                                    id="_IDGenText107"\n                                    text="{floorDescription}"\n                                /><Text\n                                    id="_IDGenText108"\n                                    text="{zone}"\n                                /><Text\n                                    id="_IDGenText109"\n                                    text="{salesPhase}"\n                                /><Text\n                                    id="_IDGenText110"\n                                    text="{finishingSpexDescription}"\n                                /><Text\n                                    id="_IDGenText111"\n                                    text="{unitDeliveryDate}"\n                                /><Text\n                                    id="_IDGenText112"\n                                    text="{profitCenter}"\n                                /><Text\n                                    id="_IDGenText113"\n                                    text="{functionalArea}"\n                                /><Text\n                                    id="_IDGenText114"\n                                    text="{supplementaryText}"\n                                /><Text\n                                    id="_IDGenText115"\n                                    text="{bua}"\n                                /><Text\n                                    id="_IDGenText119"\n                                    text="{originalPrice}"\n                                /><HBox\n                                    id="_IDGenHBox3"\n                                    wrap="Wrap"\n                                ><Button\n                                        id="_IDGenButton220"\n                                        icon="sap-icon://simulate"\n                                        press="onOpenPaymentSimulation"\n                                        tooltip="Simulatie"\n                                    /><Button\n                                        id="_IDGenButton21"\n                                        icon="sap-icon://information"\n                                        press="onDetails"\n                                    /><Button\n                                        id="_IDGenButton22"\n                                        icon="sap-icon://edit"\n                                        press="onEditUnit"\n                                    /></HBox><Button\n                                    id="_IDGenButton24"\n                                    text="Create Reservation"\n                                    icon="sap-icon://add-document"\n                                    press="onCreateReservation"\n                                    visible="{= ${unitStatusDescription} === \'Available\' }"\n                                /></cells></ColumnListItem></items></Table></ScrollContainer></content></Page></mvc:View>\n'
});
//# sourceMappingURL=Component-preload.js.map
