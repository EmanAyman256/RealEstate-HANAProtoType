sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/Dialog","sap/m/Input","sap/m/Button","sap/m/Label","sap/m/Text","sap/m/TextArea","sap/m/VBox","sap/m/DatePicker","sap/m/Table","sap/m/Column","sap/m/ColumnListItem","sap/ui/model/json/JSONModel","sap/m/Title","sap/m/IconTabBar","sap/m/IconTabFilter","sap/ui/layout/form/SimpleForm","sap/m/MessageToast","sap/ui/model/json/JSONModel"],(e,t,n,i,a,o,s,l,d,r,p,u,m,c,g,w,x,b,D)=>{"use strict";return e.extend("dboperations.controller.Buildings",{onInit(){this.getOwnerComponent().getRouter().getRoute("Buildings").attachPatternMatched(this._onRouteMatched,this);var e=new sap.ui.model.json.JSONModel({Buildings:[],Projects:[]});this.getView().setModel(e,"view");var e=new c;fetch("./odata/v4/real-estate/Buildings").then(e=>e.json()).then(t=>{e.setData({Buildings:t.value});this.getView().byId("buildingsTable").setModel(e)}).catch(e=>{console.error("Error fetching Buildings",e)});fetch("./odata/v4/real-estate/Projects").then(e=>e.json()).then(t=>{e.setData({Projects:t.value})}).catch(e=>{console.error("Error fetching Buildings",e)})},_onRouteMatched:function(){this._loadBuildings()},_loadBuildings:function(){var e=new sap.ui.model.json.JSONModel;fetch("./odata/v4/real-estate/Buildings").then(e=>e.json()).then(t=>{e.setData({Buildings:t.value});this.getView().byId("buildingsTable").setModel(e)}).catch(e=>{console.error("Error fetching Buildings ",e)})},_loadUnits:function(){const e=new c;fetch("./odata/v4/real-estate/Units?$expand=measurements,conditions").then(e=>{if(!e.ok)throw new Error("Failed to load Units");return e.json()}).then(t=>{e.setData({Units:t.value||[]});this.getView().byId("unitsTable").setModel(e)}).catch(e=>{console.error("Error loading Units:",e);t.error("Error loading Units: "+e.message)})},onStatusSelectionChange:function(e){const t=e.getSource().getSelectedKeys();const n=this.byId("unitsTable");const i=n.getBinding("items");if(!t.length){i.filter([]);return}const a=t.map(e=>new sap.ui.model.Filter("unitStatusDescription",sap.ui.model.FilterOperator.EQ,e));console.log(a);i.filter(new sap.ui.model.Filter({filters:a,and:false}))},onAddBuilding:function(){if(this._oAddBuildingDialog){this._oAddBuildingDialog.destroy();this._oAddBuildingDialog=null}var e=new sap.ui.model.json.JSONModel({buildingId:"",buildingDescription:"",buildingOldCode:"",projectId:"",projectDescription:"",companyCodeId:"",companyCodeDescription:"",validFrom:"",validTo:"",location:"",businessArea:"",profitCenter:"",functionalArea:""});var t=this;this._oAddBuildingDialog=new sap.m.Dialog({title:"Add New Building",contentWidth:"80%",content:new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:"Building ID"}),new sap.m.Input({value:"{/buildingId}",required:true}),new sap.m.Label({text:"Building Description"}),new sap.m.Input({value:"{/buildingDescription}",required:true}),new sap.m.Label({text:"Building Old Code"}),new sap.m.Input({value:"{/buildingOldCode}"}),new sap.m.Label({text:"Project ID"}),new sap.m.Input({value:"{/projectId}",required:true}),new sap.m.Label({text:"Project Description"}),new sap.m.Input({value:"{/projectDescription}",required:true}),new sap.m.Label({text:"Company Code"}),new sap.m.Input({value:"{/companyCodeId}",required:true}),new sap.m.Label({text:"Company Code Description"}),new sap.m.Input({value:"{/companyCodeDescription}",required:true}),new sap.m.Label({text:"Valid From"}),new sap.m.DatePicker({value:"{/validFrom}",required:true}),new sap.m.Label({text:"Valid To"}),new sap.m.DatePicker({value:"{/validTo}"}),new sap.m.Label({text:"Location"}),new sap.m.Input({value:"{/location}",required:true}),new sap.m.Label({text:"Business Area"}),new sap.m.Input({value:"{/businessArea}",required:true}),new sap.m.Label({text:"Profit Center"}),new sap.m.Input({value:"{/profitCenter}",required:true}),new sap.m.Label({text:"Functional Area"}),new sap.m.Input({value:"{/functionalArea}",required:true})]}),beginButton:new sap.m.Button({text:"Save",type:"Emphasized",press:function(){var e=t._oAddBuildingDialog.getModel().getData();if(e.validFrom){e.validFrom=new Date(e.validFrom).toISOString().split("T")[0]}if(e.validTo){e.validTo=new Date(e.validTo).toISOString().split("T")[0]}fetch("./odata/v4/real-estate/Buildings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>{if(!e.ok){throw new Error("Failed to create Building")}return e.json()}).then(e=>{sap.m.MessageToast.show("Building created!");var n=t.getView().byId("BuildingsTable");var i=n.getModel();var a=i.getProperty("/Buildings")||[];a.push(e);i.setProperty("/Buildings",a);t._oAddBuildingDialog.close()}).catch(e=>{sap.m.MessageBox.error("Error: "+e.message);console.log(e)})}}),endButton:new sap.m.Button({text:"Cancel",press:function(){t._oAddBuildingDialog.close()}})});this._oAddBuildingDialog.setModel(e);this.getView().addDependent(this._oAddBuildingDialog);this._oAddBuildingDialog.open()},onEdit:function(e){var t=e.getSource();var n=t.getParent().getParent().getBindingContext();if(!n){sap.m.MessageBox.warning("Error: Unable to retrieve row data");return}var i=n.getObject();var a=this.getView().byId("buildingsTable");var o=a.getModel();if(!this._oEditDialog){this._oEditBuildingModel=new sap.ui.model.json.JSONModel({buildingId:"",buildingDescription:"",buildingOldCode:"",projectId:"",projectDescription:"",companyCodeId:"",companyCodeDescription:"",validFrom:"",validTo:"",location:"",businessArea:"",profitCenter:"",functionalArea:""});this._oEditDialog=new sap.m.Dialog({title:"Edit Building",titleAlignment:"Center",contentWidth:"600px",content:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:"Building ID"}),new sap.m.Input({value:"{/buildingId}",editable:false}),new sap.m.Label({text:"Building Description"}),new sap.m.Input({value:"{/buildingDescription}"}),new sap.m.Label({text:"Building Old Code"}),new sap.m.Input({value:"{/buildingOldCode}"}),new sap.m.Label({text:"Project ID"}),new sap.m.Input({value:"{/projectId}"}),new sap.m.Label({text:"Project Description"}),new sap.m.Input({value:"{/projectDescription}"}),new sap.m.Label({text:"Company Code"}),new sap.m.Input({value:"{/companyCodeId}"}),new sap.m.Label({text:"Company Code Description"}),new sap.m.Input({value:"{/companyCodeDescription}"}),new sap.m.Label({text:"Valid From"}),new sap.m.DatePicker({value:"{/validFrom}"}),new sap.m.Label({text:"Valid To"}),new sap.m.DatePicker({value:"{/validTo}"}),new sap.m.Label({text:"Location"}),new sap.m.Input({value:"{/location}"}),new sap.m.Label({text:"Business Area"}),new sap.m.Input({value:"{/businessArea}"}),new sap.m.Label({text:"Profit Center"}),new sap.m.Input({value:"{/profitCenter}"}),new sap.m.Label({text:"Functional Area"}),new sap.m.Input({value:"{/functionalArea}"})]})],beginButton:new sap.m.Button({text:"Save",type:"Emphasized",press:()=>{var e=this._oEditBuildingModel.getData();if(e.validFrom)e.validFrom=new Date(e.validFrom).toISOString().split("T")[0];if(e.validTo)e.validTo=new Date(e.validTo).toISOString().split("T")[0];fetch(`./odata/v4/real-estate/Buildings(${e.buildingId})`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>{if(!e.ok)throw new Error("Failed to update Building");return e.json()}).then(e=>{var t=o.getProperty("/Buildings")||[];var n=t.findIndex(t=>t.buildingId===e.buildingId);if(n>-1){t[n]=e;o.setProperty("/Buildings",t)}sap.m.MessageToast.show("Building updated successfully!");this._oEditDialog.close()}).catch(e=>{sap.m.MessageBox.error("Error: "+e.message)})}}),endButton:new sap.m.Button({text:"Cancel",press:()=>this._oEditDialog.close()})});this._oEditDialog.setModel(this._oEditBuildingModel);this.getView().addDependent(this._oEditDialog)}this._oEditBuildingModel.setData(Object.assign({},i));this._oEditDialog.open()},onDelete:function(e){const n=e.getSource().getBindingContext();const i=n.getProperty("buildingId");t.confirm(`Delete Building ${i}?`,{actions:[t.Action.OK,t.Action.CANCEL],onClose:e=>{if(e===t.Action.OK){fetch(`./odata/v4/real-estate/Buildings('${encodeURIComponent(i)}')`,{method:"DELETE"}).then(e=>{if(e.ok){D.show("Deleted successfully!");this._loadBuildings()}else throw new Error("Delete failed")}).catch(e=>t.error(e.message))}}})},onNavigateToAddUnit:function(e){const t=e.getSource().getBindingContext();const n=t.getObject();const i={unitId:"",unitDescription:"",companyCodeId:"",companyCodeDescription:"",projectId:n.projectId,projectDescription:n.projectDescription,buildingId:n.buildingId,buildingDescription:n.buildingDescription,zone:"",salesPhase:"",unitDeliveryDate:"",supplementaryText:"",measurements:[],conditions:[]};const a=new sap.ui.model.json.JSONModel(i);if(this._oAddDialog){this._oAddDialog.destroy();this._oAddDialog=null}this._oAddDialog=new sap.m.Dialog({title:"Add Unit for "+i.buildingDescription,contentWidth:"80%",resizable:true,draggable:true,content:new sap.m.VBox({items:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:"Unit ID"}),new sap.m.Input({value:"{/unitId}",editable:"{= ${/unitId} === '' }",required:true}),new sap.m.Label({text:"Unit Description"}),new sap.m.Input({value:"{/unitDescription}",required:true}),new sap.m.Label({text:"Company Code ID"}),new sap.m.Input({value:"{/companyCodeId}",required:true}),new sap.m.Label({text:"Company Code Description"}),new sap.m.Input({value:"{/companyCodeDescription}",required:true}),new sap.m.Label({text:"Project ID"}),new sap.m.Input({value:"{/projectId}",editable:false,required:true}),new sap.m.Label({text:"Project Description"}),new sap.m.Input({value:"{/projectDescription}",editable:false,required:true}),new sap.m.Label({text:"Building ID"}),new sap.m.Input({value:"{/buildingId}",editable:false,required:true}),new sap.m.Label({text:"Zone"}),new sap.m.Input({value:"{/zone}"}),new sap.m.Label({text:"Sales Phase"}),new sap.m.Input({value:"{/salesPhase}"}),new sap.m.Label({text:"Delivery Date"}),new sap.m.DatePicker({value:"{/unitDeliveryDate}",valueFormat:"yyyy-MM-dd",displayFormat:"long"}),new sap.m.Label({text:"Supplementary Text"}),new sap.m.TextArea({value:"{/supplementaryText}",rows:3,width:"100%"})]}),new sap.m.Title({text:"Measurements",level:"H3",class:" sapUiMarginStart sapUiSmallMarginTop"}),new sap.m.Button({text:"Add Measurement",press:this.onAddMeasurementRow.bind(this)}),new sap.m.Table({id:"measurementsTable",items:"{/measurements}",columns:[new sap.m.Column({header:new sap.m.Label({text:"Code"})}),new sap.m.Column({header:new sap.m.Label({text:"Description"})}),new sap.m.Column({header:new sap.m.Label({text:"Quantity"})}),new sap.m.Column({header:new sap.m.Label({text:"UOM"})})],items:{path:"/measurements",template:new sap.m.ColumnListItem({cells:[new sap.m.Input({value:"{code}"}),new sap.m.Input({value:"{description}"}),new sap.m.Input({value:"{quantity}",type:"Number"}),new sap.m.Input({value:"{uom}"})]})}}),new sap.m.Title({text:"Conditions",level:"H3",class:"sapUiMarginStart sapUiSmallMarginTop"}),new sap.m.Button({text:"Add Condition",press:this.onAddConditionRow.bind(this)}),new sap.m.Table({id:"conditionsTable",items:"{/conditions}",columns:[new sap.m.Column({header:new sap.m.Label({text:"Code"})}),new sap.m.Column({header:new sap.m.Label({text:"Description"})}),new sap.m.Column({header:new sap.m.Label({text:"Amount"})}),new sap.m.Column({header:new sap.m.Label({text:"Currency"})})],items:{path:"/conditions",template:new sap.m.ColumnListItem({cells:[new sap.m.Input({value:"{code}"}),new sap.m.Input({value:"{description}"}),new sap.m.Input({value:"{amount}",type:"Number"}),new sap.m.Input({value:"{currency}"})]})}})]}),beginButton:new sap.m.Button({text:"Save",type:"Emphasized",press:this.onSaveUnit.bind(this)}),endButton:new sap.m.Button({text:"Cancel",press:function(){this._oAddDialog.close()}.bind(this)})});this._oAddDialog.setModel(a);this.getView().addDependent(this._oAddDialog);this._oAddDialog.open()},onAddMeasurementRow:function(){const e=this._oAddDialog.getModel();e.getProperty("/measurements").push({code:"",description:"",quantity:0,uom:""});e.refresh()},onAddConditionRow:function(){const e=this._oAddDialog.getModel();e.getProperty("/conditions").push({code:"",description:"",amount:0,currency:""});e.refresh()},_generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0,n=e==="x"?t:t&3|8;return n.toString(16)})},onSaveUnit:function(){const e=this._oAddDialog.getModel().getData();const n={unitId:e.unitId||Date.now().toString().slice(-8),unitDescription:e.unitDescription,companyCodeId:e.companyCodeId,companyCodeDescription:e.companyCodeDescription,projectId:e.projectId,projectDescription:e.projectDescription,buildingId:e.buildingId,zone:e.zone,salesPhase:e.salesPhase,unitDeliveryDate:e.unitDeliveryDate||null,supplementaryText:e.supplementaryText,profitCenter:e.profitCenter||0,functionalArea:e.functionalArea||0,measurements:e.measurements,conditions:e.conditions};const i=!!e.unitId;const a=i?"PATCH":"POST";const o=i?`./odata/v4/real-estate/Units(unitId='${encodeURIComponent(e.unitId)}')`:"./odata/v4/real-estate/Units";fetch(o,{method:a,headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(e=>{if(!e.ok)throw new Error(i?"Update failed":"Create failed")}).then(()=>{this._loadUnits();t.success(i?"Unit updated successfully!":"Unit created successfully!");this._oAddDialog.close()}).catch(e=>t.error(e.message))},onDetails:function(e){var t=e.getSource().getBindingContext();if(!t){return}var n=t.getObject();var i=new sap.ui.model.json.JSONModel({BuildingId:n.buildingId,BuildingDescription:n.buildingDescription,BuildingOldCode:n.buildingOldCode,ProjectId:n.projectId,ProjectDescription:n.projectDescription,CompanyCodeId:n.companyCodeId,CompanyCodeDescription:n.companyCodeDescription,validFrom:n.validFrom,validTo:n.validTo,location:n.location,businessArea:n.businessArea,profitCenter:n.profitCenter,functionalArea:n.functionalArea,supplementaryText:n.supplementaryText});if(!this._oDetailsDialog){this._oDetailsDialog=new sap.m.Dialog({title:"Building Details",contentWidth:"100%",resizable:true,draggable:true,content:[new sap.m.IconTabBar({expandable:true,items:[new sap.m.IconTabFilter({text:"General Data",icon:"sap-icon://building",content:[new sap.ui.layout.form.SimpleForm({editable:false,layout:"ResponsiveGridLayout",labelSpanL:3,columnsL:2,content:[new sap.m.Label({text:"Building ID (8 digits)"}),new sap.m.Text({text:"{/BuildingId}"}),new sap.m.Label({text:"Building Description"}),new sap.m.Text({text:"{/BuildingDescription}"}),new sap.m.Label({text:"Building Old Code"}),new sap.m.Text({text:"{/BuildingOldCode}"}),new sap.m.Label({text:"Project ID"}),new sap.m.Text({text:"{/ProjectId}"}),new sap.m.Label({text:"Project Description"}),new sap.m.Text({text:"{/ProjectDescription}"}),new sap.m.Label({text:"Company Code"}),new sap.m.Text({text:"{/CompanyCodeId}"}),new sap.m.Label({text:"Company Code Description"}),new sap.m.Text({text:"{/CompanyCodeDescription}"}),new sap.m.Label({text:"Valid From"}),new sap.m.Text({text:"{/validFrom}"}),new sap.m.Label({text:"Valid To"}),new sap.m.Text({text:"{/validTo}"}),new sap.m.Label({text:"Location"}),new sap.m.Text({text:"{/location}"})]})]}),new sap.m.IconTabFilter({text:"Posting Parameters",icon:"sap-icon://post",content:[new sap.ui.layout.form.SimpleForm({editable:false,layout:"ResponsiveGridLayout",labelSpanL:3,columnsL:2,content:[new sap.m.Label({text:"Business Area"}),new sap.m.Text({text:"{/businessArea}"}),new sap.m.Label({text:"Profit Center"}),new sap.m.Text({text:"{/profitCenter}"}),new sap.m.Label({text:"Functional Area"}),new sap.m.Text({text:"{/functionalArea}"})]})]}),new sap.m.IconTabFilter({text:"Supplementary Text",icon:"sap-icon://document-text",content:[new sap.ui.layout.form.SimpleForm({editable:false,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:"Supplementary Text"}),new sap.m.TextArea({value:"{/supplementaryText}",width:"100%",rows:6,editable:false,growing:true,growingMaxLines:10})]})]})]})],endButton:new sap.m.Button({text:"Close",type:"Emphasized",press:function(){this._oDetailsDialog.close()}.bind(this)})});this.getView().addDependent(this._oDetailsDialog)}this._oDetailsDialog.setModel(i);this._oDetailsDialog.open()}})});
//# sourceMappingURL=Buildings.controller.js.map