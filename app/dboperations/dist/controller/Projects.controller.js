sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/Dialog","sap/m/Input","sap/m/Button","sap/m/Label","sap/m/VBox","sap/ui/model/json/JSONModel"],function(e,t,a,o,n,i,r,s){"use strict";var d="";return e.extend("dboperations.controller.Projects",{onInit:function(){this.getOwnerComponent().getRouter().getRoute("Projects").attachPatternMatched(this._onRouteMatched,this);var e=new sap.ui.model.json.JSONModel({Projects:[]});this.getView().setModel(e,"view");var e=new s;fetch("/odata/v4/real-estate/Projects").then(e=>e.json()).then(t=>{e.setData({Projects:t.value});this.getView().byId("projectsTable").setModel(e)}).catch(e=>{console.error("Error fetching projects",e)})},_onRouteMatched:function(){this._loadProjects()},_loadProjects:function(){var e=new sap.ui.model.json.JSONModel;fetch("./odata/v4/real-estate/Projects",{method:"GET",headers:{"X-CSRF-Token":"Fetch"}}).then(e=>{d=e.headers.get("X-CSRF-Token");return e.json()}).then(t=>{e.setData({Projects:t.value});this.getView().byId("projectsTable").setModel(e)}).catch(e=>{console.error("Error fetching projects",e)})},onNavigateToAddProject:function(){if(!this._oAddDialog){var e=new sap.ui.model.json.JSONModel({projectId:"",projectDescription:"",companyCodeId:"",companyCodeDescription:"",validFrom:"",validTo:"",location:"",businessArea:"",profitCenter:"",functionalArea:"",supplementaryText:""});this._oAddDialog=new sap.m.Dialog({title:"Add New Project",content:new sap.ui.layout.form.SimpleForm({editable:true,content:[new sap.m.Label({text:"Project ID",required:true}),new sap.m.Input("projectIdInput",{value:"{/projectId}",tooltip:"Must be 8 characters or fewer"}),new sap.m.Label({text:"Description",required:true}),new sap.m.Input("projectDescInput",{value:"{/projectDescription}",tooltip:"Up to 60 characters"}),new sap.m.Label({text:"Company Code",required:true}),new sap.m.Input("companyCodeInput",{value:"{/companyCodeId}",tooltip:"Must be 4 characters"}),new sap.m.Label({text:"Company Code Description",required:true}),new sap.m.Input("companyCodeDescInput",{value:"{/companyCodeDescription}",tooltip:"Up to 60 characters"}),new sap.m.Label({text:"Valid From",required:true}),new sap.m.DatePicker("validFromInput",{value:"{/validFrom}",displayFormat:"long",valueFormat:"yyyy-MM-dd",placeholder:"Select a date"}),new sap.m.Label({text:"Valid To",required:true}),new sap.m.DatePicker("validToInput",{value:"{/validTo}",displayFormat:"long",valueFormat:"yyyy-MM-dd",placeholder:"Select a date"}),new sap.m.Label({text:"Location",required:true}),new sap.m.Input("locationInput",{value:"{/location}",tooltip:"Up to 40 characters"}),new sap.m.Label({text:"Business Area",required:true}),new sap.m.Input("businessAreaInput",{value:"{/businessArea}"}),new sap.m.Label({text:"Profit Center",required:true}),new sap.m.Input("profitCenterInput",{value:"{/profitCenter}"}),new sap.m.Label({text:"Functional Area",required:true}),new sap.m.Input("functionalAreaInput",{value:"{/functionalArea}"}),new sap.m.Label({text:"Supplementary Text",required:true}),new sap.m.Input("supplementaryTextInput",{value:"{/supplementaryText}"})]}),beginButton:new sap.m.Button({text:"Save",type:"Emphasized",press:function(){var e=this._oAddDialog.getModel().getData();var t=[{id:"projectIdInput",name:"Project ID"},{id:"projectDescInput",name:"Description"},{id:"companyCodeInput",name:"Company Code"},{id:"companyCodeDescInput",name:"Company Code Description"},{id:"validFromInput",name:"Valid From"},{id:"validToInput",name:"Valid To"},{id:"locationInput",name:"Location"},{id:"businessAreaInput",name:"Business Area"},{id:"profitCenterInput",name:"Profit Center"},{id:"functionalAreaInput",name:"Functional Area"},{id:"supplementaryTextInput",name:"Supplementary Text"}];var a=true;t.forEach(function(e){var t=sap.ui.getCore().byId(e.id);if(!t.getValue()){t.setValueState("Error");t.setValueStateText(e.name+" is required");a=false}else{t.setValueState("None")}});if(!a){sap.m.MessageBox.warning("Please fill all required fields before saving.");return}var o=sap.ui.getCore().byId("validFromInput").getDateValue();var n=sap.ui.getCore().byId("validToInput").getDateValue();if(o&&n&&n<o){sap.ui.getCore().byId("validToInput").setValueState("Error");sap.ui.getCore().byId("validToInput").setValueStateText("'Valid To' must be later than 'Valid From'");sap.m.MessageBox.error("'Valid To' date must be later than 'Valid From' date.");return}else{sap.ui.getCore().byId("validToInput").setValueState("None")}fetch("./odata/v4/real-estate/Projects",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":d},body:JSON.stringify(e)}).then(e=>{if(!e.ok){throw new Error("Failed to create project")}return e.text()}).then(()=>{sap.m.MessageToast.show("Project created");this._resetAddDialogFields();this._oAddDialog.close();this._loadProjects()}).catch(e=>console.error("Error during POST:",e))}.bind(this)}),endButton:new sap.m.Button({text:"Cancel",press:function(){this._resetAddDialogFields();this._oAddDialog.close();this._oAddDialog.destroy();this._oAddDialog=null}.bind(this)})});this._oAddDialog.setModel(e);this.getView().addDependent(this._oAddDialog)}this._resetAddDialogFields();this._oAddDialog.open()},_resetAddDialogFields:function(){var e=this._oAddDialog.getModel();e.setData({projectId:"",projectDescription:"",companyCodeId:"",companyCodeDescription:"",validFrom:"",validTo:"",location:"",businessArea:"",profitCenter:"",functionalArea:"",supplementaryText:""});["projectIdInput","projectDescInput","companyCodeInput","companyCodeDescInput","validFromInput","validToInput","locationInput"].forEach(function(e){var t=sap.ui.getCore().byId(e);if(t)t.setValueState("None")})},onDetails:function(e){var t=e.getSource().getBindingContext();if(!t){return}var a=t.getObject();var o=new sap.ui.model.json.JSONModel({ProjectId:a.projectId,Description:a.projectDescription,CompanyCode:a.companyCodeId,companyCodeDescription:a.companyCodeDescription,validFrom:a.validFrom,validTo:a.validTo,location:a.location,businessArea:a.businessArea,profitCenter:a.profitCenter,functionalArea:a.functionalArea,supplementaryText:a.supplementaryText});if(!this._oDetailsDialog){this._oDetailsDialog=new sap.m.Dialog({title:"Project Details",contentWidth:"100%",resizable:true,draggable:true,content:[new sap.m.IconTabBar({expandable:true,items:[new sap.m.IconTabFilter({text:"General Data",icon:"sap-icon://project-definition",content:[new sap.ui.layout.form.SimpleForm({editable:false,layout:"ResponsiveGridLayout",labelSpanL:3,columnsL:2,content:[new sap.m.Label({text:"Company Code ID"}),new sap.m.Text({text:"{/CompanyCode}"}),new sap.m.Label({text:"Company Code Description"}),new sap.m.Text({text:"{/companyCodeDescription}"}),new sap.m.Label({text:"Project ID"}),new sap.m.Text({text:"{/ProjectId}"}),new sap.m.Label({text:"Project Description"}),new sap.m.Text({text:"{/Description}"}),new sap.m.Label({text:"Valid From"}),new sap.m.Text({text:"{/validFrom}"}),new sap.m.Label({text:"Valid To"}),new sap.m.Text({text:"{/validTo}"}),new sap.m.Label({text:"Location"}),new sap.m.Text({text:"{/location}"})]})]}),new sap.m.IconTabFilter({text:"Posting Parameters",icon:"sap-icon://post",content:[new sap.ui.layout.form.SimpleForm({editable:false,layout:"ResponsiveGridLayout",labelSpanL:3,columnsL:2,content:[new sap.m.Label({text:"Business Area"}),new sap.m.Text({text:"{/businessArea}"}),new sap.m.Label({text:"Profit Center"}),new sap.m.Text({text:"{/profitCenter}"}),new sap.m.Label({text:"Functional Area"}),new sap.m.Text({text:"{/functionalArea}"})]})]}),new sap.m.IconTabFilter({text:"Supplementary Text",icon:"sap-icon://document-text",content:[new sap.ui.layout.form.SimpleForm({editable:false,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:"Supplementary Text"}),new sap.m.TextArea({value:"{/supplementaryText}",width:"100%",rows:6,editable:false,growing:true,growingMaxLines:10})]})]})]})],endButton:new sap.m.Button({text:"Close",type:"Emphasized",press:function(){this._oDetailsDialog.close();this._oDetailsDialog.destroy();this._oDetailsDialog=null}.bind(this)})});this.getView().addDependent(this._oDetailsDialog)}this._oDetailsDialog.setModel(o);this._oDetailsDialog.open()},onDelete:function(e){var a=e.getSource().getBindingContext();if(a){var o=a.getPath();var n=this.getView().byId("projectsTable").getModel();var i=n.getProperty(o);if(!i){sap.m.MessageBox.error("Could not find model data for deletion.");return}t.confirm("Are you sure you want to delete "+i.projectId+"?",{title:"Confirm Deletion",onClose:function(e){if(e===t.Action.OK){fetch(`./odata/v4/real-estate/Projects(projectId='${i.projectId}')`,{method:"DELETE"}).then(e=>{if(!e.ok){throw new Error("Failed to delete: "+e.statusText)}var t=n.getProperty("/Projects");var a=t.findIndex(e=>e.projectId===i.projectId);if(a>-1){t.splice(a,1);n.setProperty("/Projects",t)}sap.m.MessageToast.show("Project deleted successfully!")}).catch(e=>{console.error("Error deleting Project:",e);sap.m.MessageBox.error("Error: "+e.message)})}}})}},onEditProject:function(e){var t=e.getSource().getBindingContext();if(!t)return;var a=t.getObject();var o=new sap.ui.model.json.JSONModel(Object.assign({},a));if(!this._oEditDialog){this._oEditDialog=new sap.m.Dialog({title:"Edit Project",content:new sap.ui.layout.form.SimpleForm({editable:true,content:[new sap.m.Label({text:"Project ID"}),new sap.m.Input({value:"{/projectId}",editable:false}),new sap.m.Label({text:"Description",required:true}),new sap.m.Input("editProjectDescInput",{value:"{/projectDescription}"}),new sap.m.Label({text:"Company Code",required:true}),new sap.m.Input("editCompanyCodeInput",{value:"{/companyCodeId}"}),new sap.m.Label({text:"Company Code Description",required:true}),new sap.m.Input("editCompanyCodeDescInput",{value:"{/companyCodeDescription}"}),new sap.m.Label({text:"Valid From",required:true}),new sap.m.DatePicker("editValidFromInput",{value:"{/validFrom}",displayFormat:"long",valueFormat:"yyyy-MM-dd",placeholder:"Select a date"}),new sap.m.Label({text:"Valid To",required:true}),new sap.m.DatePicker("editValidToInput",{value:"{/validTo}",displayFormat:"long",valueFormat:"yyyy-MM-dd",placeholder:"Select a date"}),new sap.m.Label({text:"Location",required:true}),new sap.m.Input("editLocationInput",{value:"{/location}"}),new sap.m.Label({text:"Business Area",required:true}),new sap.m.Input("editBusinessAreaInput",{value:"{/businessArea}"}),new sap.m.Label({text:"Profit Center",required:true}),new sap.m.Input("editProfitCenterInput",{value:"{/profitCenter}"}),new sap.m.Label({text:"Functional Area",required:true}),new sap.m.Input("editFunctionalAreaInput",{value:"{/functionalArea}"}),new sap.m.Label({text:"Supplementary Text",required:true}),new sap.m.Input("editSupplementaryTextInput",{value:"{/supplementaryText}"})]}),beginButton:new sap.m.Button({text:"Save",type:"Emphasized",press:function(){var e=this._oEditDialog.getModel().getData();var t=[{id:"editProjectDescInput",name:"Description"},{id:"editCompanyCodeInput",name:"Company Code"},{id:"editCompanyCodeDescInput",name:"Company Code Description"},{id:"editValidFromInput",name:"Valid From"},{id:"editValidToInput",name:"Valid To"},{id:"editLocationInput",name:"Location"},{id:"editBusinessAreaInput",name:"Business Area"},{id:"editProfitCenterInput",name:"Profit Center"},{id:"editFunctionalAreaInput",name:"Functional Area"},{id:"editSupplementaryTextInput",name:"Supplementary Text"}];var a=true;t.forEach(function(e){var t=sap.ui.getCore().byId(e.id);if(!t.getValue()){t.setValueState("Error");t.setValueStateText(e.name+" is required");a=false}else{t.setValueState("None")}});if(!a){sap.m.MessageBox.warning("Please fill all required fields before saving.");return}var o=sap.ui.getCore().byId("editValidFromInput").getDateValue();var n=sap.ui.getCore().byId("editValidToInput").getDateValue();if(o&&n&&n<o){sap.ui.getCore().byId("editValidToInput").setValueState("Error");sap.ui.getCore().byId("editValidToInput").setValueStateText("'Valid To' must be later than 'Valid From'");sap.m.MessageBox.error("'Valid To' date must be later than 'Valid From' date.");return}else{sap.ui.getCore().byId("editValidToInput").setValueState("None")}fetch(`./odata/v4/real-estate/Projects(projectId='${e.projectId}')`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>{if(!e.ok)throw new Error("Update failed");return e.json()}).then(()=>{sap.m.MessageToast.show("Project updated successfully!");this._loadProjects();this._oEditDialog.close();this._oEditDialog.destroy();this._oEditDialog=null}).catch(e=>sap.m.MessageBox.error("Error: "+e.message))}.bind(this)}),endButton:new sap.m.Button({text:"Cancel",press:function(){this._oEditDialog.close();this._oEditDialog.destroy();this._oEditDialog=null}.bind(this)})});this.getView().addDependent(this._oEditDialog)}this._oEditDialog.setModel(o);this._oEditDialog.open()},onAddBuilding:function(e){var t=e.getSource().getBindingContext();if(!t){sap.m.MessageToast.show("No project selected.");return}var a=t.getObject();var o=new sap.ui.model.json.JSONModel({buildingId:"",buildingDescription:"",buildingOldCode:"",location:a.location||"",validFrom:"",validTo:"",companyCodeId:a.companyCodeId,companyCodeDescription:a.companyCodeDescription,projectId:a.projectId,projectDescription:a.projectDescription,businessArea:a.businessArea||"",profitCenter:a.profitCenter||"",functionalArea:a.functionalArea||""});if(!this._oAddBuildingDialog){this._oAddBuildingDialog=new sap.m.Dialog({title:"Add Building for "+a.projectDescription,contentWidth:"600px",content:new sap.ui.layout.form.SimpleForm({editable:true,content:[new sap.m.Label({text:"Building ID",required:true}),new sap.m.Input("buildingIdInput",{value:"{/buildingId}"}),new sap.m.Label({text:"Building Description",required:true}),new sap.m.Input("buildingDescInput",{value:"{/buildingDescription}"}),new sap.m.Label({text:"Old Building Code"}),new sap.m.Input({value:"{/buildingOldCode}"}),new sap.m.Label({text:"Location",required:true}),new sap.m.Input("buildingLocationInput",{value:"{/location}"}),new sap.m.Label({text:"Valid From",required:true}),new sap.m.DatePicker("buildingValidFromInput",{value:"{/validFrom}",displayFormat:"long",valueFormat:"yyyy-MM-dd",placeholder:"Select date",showClearIcon:true}),new sap.m.Label({text:"Valid To",required:true}),new sap.m.DatePicker("buildingValidToInput",{value:"{/validTo}",displayFormat:"long",valueFormat:"yyyy-MM-dd",placeholder:"Select date",showClearIcon:true}),new sap.m.Label({text:"Company Code ID"}),new sap.m.Text({text:"{/companyCodeId}"}),new sap.m.Label({text:"Company Code Description"}),new sap.m.Text({text:"{/companyCodeDescription}"}),new sap.m.Label({text:"Project ID"}),new sap.m.Text({text:"{/projectId}"}),new sap.m.Label({text:"Project Description"}),new sap.m.Text({text:"{/projectDescription}"}),new sap.m.Label({text:"Business Area",required:true}),new sap.m.Input("businessAreaInput",{value:"{/businessArea}"}),new sap.m.Label({text:"Profit Center",required:true}),new sap.m.Input("profitCenterInput",{value:"{/profitCenter}"}),new sap.m.Label({text:"Functional Area",required:true}),new sap.m.Input("functionalAreaInput",{value:"{/functionalArea}"})]}),beginButton:new sap.m.Button({text:"Save",type:"Emphasized",press:function(){var e=this._oAddBuildingDialog.getModel().getData();var t=[{id:"buildingIdInput",name:"Building ID"},{id:"buildingDescInput",name:"Building Description"},{id:"buildingLocationInput",name:"Location"},{id:"buildingValidFromInput",name:"Valid From"},{id:"buildingValidToInput",name:"Valid To"},{id:"businessAreaInput",name:"Business Area"},{id:"profitCenterInput",name:"Profit Center"},{id:"functionalAreaInput",name:"Functional Area"}];var o=true;t.forEach(function(e){var t=sap.ui.getCore().byId(e.id);if(!t.getValue()){t.setValueState("Error");t.setValueStateText(e.name+" is required");o=false}else{t.setValueState("None")}});if(!o){sap.m.MessageBox.warning("Please fill all required fields before saving.");return}var n=new Date(a.validFrom);var i=new Date(a.validTo);var r=sap.ui.getCore().byId("buildingValidFromInput").getDateValue();var s=sap.ui.getCore().byId("buildingValidToInput").getDateValue();if(r>s){sap.ui.getCore().byId("buildingValidToInput").setValueState("Error");sap.ui.getCore().byId("buildingValidToInput").setValueStateText("'Valid To' must be later than 'Valid From'");sap.m.MessageBox.error("Building 'Valid From' cannot be after 'Valid To'.");return}if(r<n){sap.m.MessageBox.error("Building 'Valid From' must be on or after the Project 'Valid From' ("+a.validFrom+").");return}if(s>i){sap.m.MessageBox.error("Building 'Valid To' must be on or before the Project 'Valid To' ("+a.validTo+").");return}fetch("./odata/v4/real-estate/Buildings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>{if(!e.ok)throw new Error("Failed to create building");return e.json()}).then(()=>{sap.m.MessageToast.show("Building added successfully!");this._oAddBuildingDialog.close();this._oAddBuildingDialog.destroy();this._oAddBuildingDialog=null}).catch(e=>{sap.m.MessageBox.error("Error: "+e.message)})}.bind(this)}),endButton:new sap.m.Button({text:"Cancel",press:function(){this._oAddBuildingDialog.close();this._oAddBuildingDialog.destroy();this._oAddBuildingDialog=null}.bind(this)})});this.getView().addDependent(this._oAddBuildingDialog)}this._oAddBuildingDialog.setModel(o);this._oAddBuildingDialog.open()}})});
//# sourceMappingURL=Projects.controller.js.map